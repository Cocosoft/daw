<!DOCTYPE html><html lang='en'><head><title>GridSound</title><meta charset='UTF-8'/><meta name='viewport' content='width=device-width, user-scalable=no'/><meta name='description' content='A free and Open-Source DAW (digital audio workstation)'/><meta name='google' content='notranslate'/><meta property='og:type' content='website'/><meta property='og:title' content='GridSound (an open-source digital audio workstation)'/><meta property='og:url' content='https://gridsound.github.io/'/><meta property='og:image' content='https://gridsound.github.io/assets/og-image.jpg'/><meta property='og:image:width' content='800'/><meta property='og:image:height' content='400'/><meta name='theme-color' content='#3a5158'/><link rel='manifest' href='manifest.json'/><link rel='shortcut icon' href='assets/favicon.png'/><style>.gsuiAudioBlock{--bd-width: 0px;--bd-radius: 4px;--bg: rgba( 0, 0, 0, .6 );--bg-head: rgba( 0, 0, 0, .3 );color:#cce;position:absolute;display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;top:0;height:100%;border-style:solid;border-width:var(--bd-width) 0;border-radius:var(--bd-radius);cursor:default;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;transition:.1s;transition-property:color}.gsuiAudioBlock.gsuiab-selected{color:#f99}.gsuiAudioBlock .gsuiab-bg{position:absolute;width:100%;height:100%;background-color:currentColor;filter:brightness(.15);opacity:.8}.gsuiAudioBlock .gsuiab-head{position:relative;overflow:hidden;z-index:1;padding:2px 4px;font-size:12px;font-weight:700;white-space:nowrap;text-overflow:ellipsis;text-shadow:0 0 3px rgba(0,0,0,.7);background-color:var(--bg-head)}.gsuiAudioBlock .gsuiab-name:empty:before{content:"Untitled";font-style:italic;opacity:.5}.gsuiAudioBlock .gsuiab-content{position:relative;overflow:hidden;flex:1}.gsuiAudioBlock .gsuiab-crop{position:absolute;z-index:2;top:0;width:50%;max-width:8px;height:100%;background-color:currentColor;opacity:0;transition:opacity .2s}.gsuiAudioBlock .gsuiab-crop.hover,.gsuiAudioBlock .gsuiab-crop:hover{opacity:.2}.gsuiAudioBlock .gsuiab-cropB{right:0}.gsui-nocrop .gsuiab-crop,.gsui-noleftcrop .gsuiab-cropA{display:none!important}.gsuiAudioBlock .gsuiab-cursor{position:absolute;height:100%;width:1px;background-color:#ff0;box-shadow:-2px 0 6px 3px rgba(255,255,0,.2);animation-name:gsuiab-cursor-frames;animation-fill-mode:forwards;animation-timing-function:linear}@keyframes gsuiab-cursor-frames{0%{opacity:1;left:0}95%{opacity:1}to{opacity:0;left:100%}}.gsuiAudioBlock[data-type=key] .gsuiab-bg{filter:brightness(.7);opacity:.6}.gsuiAudioBlock[data-type=key] .gsuiab-head{background-color:transparent}.gsuiAudioBlock svg{position:absolute;top:0;width:100%;height:100%;fill:currentColor;opacity:.3}.gs-row-tiny .gsuiAudioBlock .gsuiab-head{display:flex;align-items:center;padding-top:0;padding-bottom:0;height:100%;background-color:transparent}.gs-row-tiny .gsuiAudioBlock .gsuiab-bg{filter:brightness(.7);opacity:.6}.gs-row-tiny .gsuiAudioBlock .gsuiab-content{position:absolute;top:0;width:100%;height:100%}.gsuiBeatLines{fill:#000;color:#ff5}.gsuiBeatLines rect{fill:inherit}.gsuiBeatLines .gsui-step{opacity:.2}.gsuiBeatLines .gsui-beat{opacity:.5}.gsuiBeatLines .gsui-measure{opacity:.6}.gsuiBeatLines .gsui-currentTime{fill:currentColor;stroke:currentColor;stroke-opacity:.1;stroke-width:5px}.gsuiBeatLines .gsui-hlEnd,.gsuiBeatLines .gsui-hlStart{opacity:.25}.gsuiGridSamples{--timeline-height: 32px;--panel-min-width: 24px;--panel-max-width: 320px;--grid-bg: #3a5158;--panel-bg: #3a3a3a;--border-color: #111;position:relative;width:100%;height:100%;cursor:default;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.gsuiGridSamples .gsuigs-grid,.gsuiGridSamples .gsuigs-panel{position:absolute;overflow:hidden;top:var(--timeline-height);bottom:0}.gsuiGridSamples .gsuigs-grid{right:0;border-top:1px solid var(--border-color)}.gsuiGridSamples .gsuigs-panel{box-sizing:border-box;min-width:var(--panel-min-width);max-width:var(--panel-max-width);border:0 solid var(--border-color);border-width:1px 1px 0 0;background-color:var(--panel-bg)}.gsuiGridSamples .gsuigs-extend{position:absolute;z-index:1;top:0;right:0;width:6px;height:100%;transition:background-color .2s}.gsuiGridSamples .gsuigs-extend.gsui-hover,.gsuiGridSamples .gsuigs-extend:hover{background-color:rgba(128,128,128,.5)}.gsuiGridSamples .gsuiTimeLine{position:absolute;z-index:1;height:var(--timeline-height);top:0;right:0;border-left:1px solid var(--border-color)}.gsuiGridSamples .gsuiBeatLines{position:absolute;width:100%;height:100%;background-color:var(--grid-bg)}.gsuiGridSamples .gsuigs-content,.gsuiKeys{position:relative}.gsuiGridSamples .gsuigs-grid .gsuigs-content{position:absolute;right:0}.gsuiGridSamples .gsuigs-select{position:absolute;box-sizing:border-box;margin:-1px 0 0 -1px;border:2px solid #f55;border-radius:4px;background-color:rgba(216,26,26,.3);transition:.2s;transition-property:opacity,visibility}.gsuiGridSamples .gsuigs-select.hidden{opacity:0;visibility:hidden}.gsuiKeys{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.gsuiKey,.gsuiKey-row{position:relative;box-sizing:border-box;height:1em}.gsuiKey-row[data-key$="#"]{background-color:rgba(0,0,0,.1)}.gsuiKey-row[data-key$=c],.gsuiKey-row[data-key$=f]{border-bottom:1px solid rgba(0,0,0,.2)}.gsuiKey-row>div{position:absolute;top:0;bottom:0;width:100%}.gsuiKey{height:1.5em;background-image:linear-gradient(90deg,#888,#eee);cursor:default}.gsuiKey[data-key$="#"]{position:absolute;z-index:1;width:65%;height:1em;margin-top:-.5em;border-radius:0 .1em .1em 0;background-image:linear-gradient(90deg,#111,#444)}.gsuiKey[data-key=c]{background-image:linear-gradient(90deg,#888,#ccc)}.gsuiKey[data-key=c]:after{counter-increment:octave -1;content:"C" counter(octave);position:absolute;right:.25em;bottom:0;color:#000;font-size:calc(6px + .25em);font-family:monospace}.gsuiKey.gsui-active{background-image:linear-gradient(90deg,#353b52,#7886bd)}.gsuiKey[data-key=c],.gsuiKey[data-key=f]{border-bottom:1px solid rgba(0,0,0,.2)}.gsuiKey:last-child{border-bottom:0}.gsuiKey[data-key=a],.gsuiKey[data-key=d],.gsuiKey[data-key=g]{height:2em}:root{--gsuiPanels-bd: 1px solid #222;--gsuiPanels-extendSize: 5px;--gsuiPanels-extendColor: #888}.gsuiPanels-x,.gsuiPanels-y{display:flex}.gsuiPanels-y{flex-direction:column}.gsuiPanels-x>div:not(.gsuiPanels-extend),.gsuiPanels-y>div:not(.gsuiPanels-extend){position:relative;flex:1}.gsuiPanels-x>div,.gsuiPanels-y>div{box-sizing:border-box}.gsuiPanels-x>div+div:not(.gsuiPanels-extend){border-left:var(--gsuiPanels-bd)}.gsuiPanels-y>div+div:not(.gsuiPanels-extend){border-top:var(--gsuiPanels-bd)}.gsuiPanels-noselect{user-select:none;-ms-user-select:none;-moz-user-select:none;-webkit-user-select:none}.gsuiPanels-extend{position:absolute;z-index:999;top:0;left:0;width:100%;height:100%;transition:background-color .2s}.gsuiPanels-extend.gsui-hover,.gsuiPanels-extend:hover{background-color:var(--gsuiPanels-extendColor)}.gsuiPanels-x>div>.gsuiPanels-extend{width:var(--gsuiPanels-extendSize);margin-left:calc(var(--gsuiPanels-extendSize)/-2)}.gsuiPanels-y>div>.gsuiPanels-extend{height:var(--gsuiPanels-extendSize);margin-top:calc(var(--gsuiPanels-extendSize)/-2)}#gsuiPopup{--dur: .2s;--dark-bg: rgba( 0, 0, 0, .6 );--bg: #555;--btn-bg: #999;--btn-ok-bg: #67a;--padding: 10px;--min-width: 250px;--radius: 4px;--header-bg: #333;display:flex;align-items:center;justify-content:center;position:fixed;z-index:2147483647;left:0;right:0;top:0;bottom:0;color:#fff;background-color:var(--dark-bg);visibility:hidden;opacity:0;transition:var(--dur);transition-property:visibility,opacity}#gsuiPopup.gsui-show{visibility:visible;opacity:1}#gsuipp-window{overflow:hidden;min-width:var(--min-width);border-radius:var(--radius);font-family:sans-serif;background-color:var(--bg);box-shadow:0 0 50px #000}#gsuipp-window.gsui-nocancel #gsuipp-inpCancel,#gsuipp-window.gsui-notext #gsuipp-inpText,.gsuiSlider input,.gsuiSlider.gsui-circular .gsui-line,.gsuiSlider.gsui-linear svg{display:none}#gsuipp-head{background-color:var(--header-bg)}#gsuipp-body,#gsuipp-head{padding:var(--padding)}#gsuipp-cnt:not(:empty)+#gsuipp-msg,#gsuipp-cnt:not(:empty)~input{display:none}#gsuipp-inpText{border:0;border-radius:2px;box-sizing:border-box;margin-top:var(--padding);padding:.6em;width:100%;font-size:18px}#gsuipp-btns input{padding:.6em 1.25em;border:0;border-radius:2px;color:#fff;font-weight:700;background-color:var(--btn-bg);cursor:pointer}#gsuipp-btns{margin-top:var(--padding);text-align:center}#gsuipp-btns input+input{margin-left:var(--padding)}#gsuipp-btns #gsuipp-inpOk{background-color:var(--btn-ok-bg)}#gsuipp-window input[type=text]{color:#fff;background-color:rgba(255,255,255,.1)}:root{--gsuiSlider-lineColor: #fff;--gsuiSlider-lineBgColor: #000}.gsuiSlider{position:relative;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.gsuiSlider .gsui-eventCatcher{position:absolute;top:-10px;left:-10px;right:-10px;bottom:-10px;border-radius:9999px}.gsuiSlider.gsui-x .gsui-lineColor{height:100%!important;top:0!important}.gsuiSlider.gsui-y .gsui-lineColor{width:100%!important;left:0!important}.gsuiSlider.gsui-x .gsui-thumb{bottom:50%!important}.gsuiSlider.gsui-y .gsui-thumb{left:50%!important}.gsuiSlider .gsui-line{position:absolute;left:0;right:0;top:0;bottom:0;background-color:var(--gsuiSlider-lineBgColor)}.gsuiSlider .gsui-lineColor{position:absolute;background-color:var(--gsuiSlider-lineColor)}.gsuiSlider,.gsuiSlider svg{width:100%;height:100%}.gsuiSlider .gsui-svgLine,.gsuiSlider .gsui-svgLineColor{fill:none;transform-origin:center}.gsuiSlider .gsui-svgLine{stroke:var(--gsuiSlider-lineBgColor)}.gsuiSlider .gsui-svgLineColor{stroke:var(--gsuiSlider-lineColor)}.gsuiSpanEditable{--placeholder-opacity: .3;display:flex;align-items:center;overflow:hidden;transition-duration:.2s}.gsuiSpanEditable span{display:inline-block;width:100%;color:inherit;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;min-width:1em;opacity:1;transition:opacity;transition-duration:inherit}.gsuiSpanEditable input{display:none;box-sizing:border-box;width:100%;outline:0;border:0;font-size:1em;color:inherit;background:0 0}.gsuiSpanEditable.gsui-empty span{font-style:italic;opacity:var(--placeholder-opacity)}.gsuiSpanEditable.gsui-editing span{display:none}.gsuiSpanEditable.gsui-editing input{display:block}.gsuiTimeLine{--cursor-color: #fdfd70;--cursor-dur: .1s;--loop-color: #656586;--loop-brd-color: #fff;position:relative;overflow:hidden;font:14px monospace;color:#fff;background:#222;cursor:default;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.gsuiTimeLine .gsui-loopLine{position:absolute;z-index:1;width:100%;height:100%}.gsuiTimeLine .gsui-loop{position:absolute;z-index:1;top:0;height:22%}.gsuiTimeLine .gsui-loopBg{position:absolute;width:100%;height:100%;background:var(--loop-color);transition:filter .2s}.gsuiTimeLine .gsui-loopBg.gsui-hover,.gsuiTimeLine .gsui-loopBg:hover{filter:brightness(1.2)}.gsuiTimeLine .gsui-loopExt{position:absolute;z-index:2;width:25%;min-width:5px;max-width:10px;height:250%}.gsuiTimeLine .gsui-loopA{left:-5px}.gsuiTimeLine .gsui-loopB{right:-5px}.gsuiTimeLine .gsui-loopBrd{position:absolute;z-index:0;width:2px;height:100%;background:var(--loop-color);transition:.2s;transition-property:height,background,z-index}.gsuiTimeLine .gsui-loopBrdA{left:-1px}.gsuiTimeLine .gsui-loopBrdB{right:-1px}.gsuiTimeLine .gsui-loopA:hover~.gsui-loopBrdA,.gsuiTimeLine .gsui-loopB:hover~.gsui-loopBrdB,.gsuiTimeLine .gsui-loopBrd.gsui-hover{z-index:1;height:150%;background:var(--loop-brd-color)}.gsuiTimeLine .gsui-currentTime{position:absolute;z-index:1;bottom:0;width:100%;height:50%}.gsuiTimeLine .gsui-cursorLine{position:absolute;bottom:0;width:100%;height:1px;color:var(--cursor-color);opacity:0;transition:.2s;transition-property:opacity,background}.gsuiTimeLine .gsui-currentTime:hover .gsui-cursorLine{opacity:.8}.gsuiTimeLine .gsui-cursor{position:absolute;margin-left:-10px;bottom:1px;transition:left}.gsuiTimeLine .gsui-trans{transition-duration:var(--cursor-dur)}.gsuiTimeLine .gsui-cursor polygon{fill:var(--cursor-color);stroke:var(--cursor-color);stroke-width:4;stroke-linejoin:round}.gsuiTimeLine .gsui-beat,.gsuiTimeLine .gsui-measure,.gsuiTimeLine .gsui-step{position:absolute;display:flex;top:0;bottom:0;width:4em;margin-left:-2em;align-items:center;justify-content:center}.gsuiTimeLine .gsui-measure{font-weight:700}.gsuiTimeLine .gsui-step{opacity:.2}.gsuiTimeLine .gsui-beat,.gsuiTimeLine.gsui-measure .gsui-measure{opacity:.5}.gsuiTimeLine.gsui-beat .gsui-step,.gsuiTimeLine.gsui-measure .gsui-beat,.gsuiTimeLine.gsui-measure .gsui-step{opacity:0}.gsuiToggle{--radius: 8px;--border: 1px solid rgba( 255, 255, 255, .25 );--color: #222;--color-on: #87bd42;--boxshadow: 0 2px 1px rgba( 0, 0, 0, .3 );--boxshadow-on: 0 0 10px #87bd42;--dur: .2s;position:relative;font-size:var(--radius);cursor:pointer}.gsuiToggle .gsui-circle{position:absolute;box-sizing:border-box;width:1em;height:1em;top:50%;left:50%;margin:-.5em 0 0 -.5em;border-radius:50%;border:var(--border);box-shadow:var(--boxshadow);background:var(--color);transition:var(--dur);transition-property:background,box-shadow}.gsuiToggle .gsui-on{box-shadow:var(--boxshadow-on);background:var(--color-on)}.gsuiTrack,.gsuiTrack-row{--head-bg: #444;--head-bg-mute: #393939;--body-bg-mute: rgba( 0, 0, 0, .25 );--text-color: #eee;--border-top-color: rgba( 255, 255, 255, .07 );--border-bottom-color: rgba( 0, 0, 0, .4 );box-sizing:border-box;display:flex;height:1em;border:0 solid;border-width:1px 0;border-top-color:var(--border-top-color);border-bottom-color:var(--border-bottom-color);background-color:var(--head-bg);transition:background-color .2s}.gsuiTrack-row{position:relative;display:block;background-color:transparent}.gsuiTrack-row>div{position:absolute;top:0;bottom:0;width:100%}.gsuiTrack .gsuiToggle{--radius: 6px;min-width:24px}.gsuiTrack .gsuiSpanEditable{flex:1;padding-right:10px;font-size:14px;color:var(--text-color)}.gsuiTrack.gsui-mute{background-color:var(--head-bg-mute)}.gsuiTrack-row.gsui-mute{background-color:var(--body-bg-mute)}.gsuiTrack.gsui-mute .gsuiSpanEditable{opacity:.5}.gsuiTrackList{height:100%;background:#333}@font-face{font-family:"Inconsolata";src:url(assets/inconsolata-regular.ttf)}@font-face{font-family:"Oswald";src:url(assets/oswald-regular.ttf)}@font-face{font-family:"FontAwesome";src:url(assets/fontawesome-solid-900.woff) format("woff")}@font-face{font-family:"FontAwesomeBrands";src:url(assets/fontawesome-brands-900.woff) format("woff")}.icon{position:relative;display:inline-block;font-family:"FontAwesome";font-weight:400;font-style:normal;text-align:center;text-indent:0;width:1.25em}.ico-brand{font-family:"FontAwesomeBrands"}.icon:after{position:absolute;left:10px;top:-3px;font-size:8px}.ico--plus:after{content:"\f067"}.ico--minus:after{content:"\f068"}.ico-times:before{content:"\f2d3"}.ico-play:before{content:"\f04b"}.ico-pause:before{content:"\f04c"}.ico-stop:before{content:"\f04d"}.ico-undo:before{content:"\f2ea"}.ico-redo:before{content:"\f2f9"}.ico-mute:before{content:"\f026"}.ico-unmute:before{content:"\f028"}.ico-name:before{content:"\f040"}.ico-paint:before{content:"\f1fc"}.ico-clock:before{content:"\f017"}.ico-move:before{content:"\f0b2"}.ico-crop:before{content:"\f125"}.ico-history:before{content:"\f1da"}.ico-pattern:before{content:"\f38a"}.ico-new:before{content:"\f067"}.ico-clone:before{content:"\f24d"}.ico-remove:before{content:"\f1f8"}.ico-erase:before{content:"\f12d"}.ico-toggle-off:before{content:"\f204"}.ico-toggle-on:before{content:"\f205"}.ico-add:before{content:"\f067"}.ico-selection:before{content:"\f245"}.ico-keyboard:before{content:"\f11c"}.ico-arrows-v:before{content:"\f338"}.ico-tint:before{content:"\f043"}.ico-cmd:before{content:"⌘";font-family:sans-serif}.ico-chrome:before{content:"\f268"}.ico-edge:before{content:"\f282"}.ico-firefox:before{content:"\f269"}.ico-iexplorer:before{content:"\f26b"}.ico-opera:before{content:"\f26a"}.ico-safari:before{content:"\f267"}.ico-patreon:before{content:"\f3d9"}.ico-facebook:before{content:"\f09a"}.ico-github:before{content:"\f09b"}.ico-twitter:before{content:"\f099"}.ico-youtube:before{content:"\f167"}.ico-pattern{transform:scale(-1,1)}body,html{height:100%;margin:0;overflow:hidden;font-family:sans-serif;background-color:#555}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background-color:#555}::-webkit-scrollbar-thumb{background-color:#888}a{color:inherit;text-decoration:none}#app{--app-bg: #555;--gsuiPanels-bd: 2px solid #222;--gsuiPanels-extendSize: 4px;--small-bd-radius: 2px;--ctrl-height: 44px;--ctrl-padding: 4px;--col1-low: #345;--col1-middle: #67a;--col1-high: #bbf;--col2-middle: #d44;--monospace: "Inconsolata", "consolas", monospace;width:100%;height:100%;overflow:hidden;background-color:var(--app-bg);user-select:none;-ms-user-select:none;-moz-user-select:none;-webkit-user-select:none}.popup{width:500px}.popup fieldset{border:2px solid #444;border-radius:4px;margin-bottom:10px}.popup legend{font-size:11px;font-weight:700;opacity:.5}.popup .param{display:flex;align-items:center}.popup .param+.param{margin-top:5px}.popup .param-title{flex:1}.popup .param-values{flex:1;font-family:var(--monospace)}.popup [type=radio]:checked+label{font-weight:700}.popup input{border-radius:2px;border:0;color:inherit;font-size:inherit}.popup input::placeholder{color:#aaa;font-style:italic}.popup input[type=file],.popup input[type=number],.popup input[type=text],.popup input[type=url]{width:150px;padding:.2em .5em;font-family:inherit;background:rgba(255,255,255,.1)}.popup input[type=file]{width:200px}#settingsPopupContent fieldset:nth-child(2) .param-values{display:flex;align-items:center}#settingsPopupContent .btn{padding:.2em;margin-left:10px;border:0;border-radius:2px;font-size:inherit;background-color:rgba(255,255,255,.1)}#settingsPopupContent .btn:hover{background-color:rgba(255,255,255,.2)}.shortcuts{padding:.3em .5em;margin:7px;border-radius:4px;font-weight:700;font-size:14px;line-height:2em;background-color:#444;box-shadow:0 3px 0 0 rgba(0,0,0,.4);color:#fff}.shortcuts .icon{width:auto}.absoluteMenu{position:absolute;z-index:2;border:2px solid #111;border-radius:4px;background-color:#333;transition:.2s;transition-property:opacity,visibility}.absoluteMenu.hidden{opacity:0;visibility:hidden}.absoluteMenu a{display:block;white-space:nowrap;font-size:13px;line-height:2em;padding:0 .5em;color:#ddd;cursor:default;transition:.2s;transition-property:color,background-color}.absoluteMenu a:hover{color:#fff;background-color:#222}#pan-leftside{min-width:250px;max-width:400px;width:300px;flex:none}#pan-maingrid,#pan-pianoroll,#pan-synth,.panel-left{display:flex;flex-direction:column}.panel-menu,.panel-title{box-sizing:border-box;padding:4px 10px;font-size:13px;border-bottom:1px solid #111}.panel-title{display:flex;align-items:center;min-height:24px;color:#222;font-weight:700;background-color:#666}.panel-title .icon{margin-right:4px}.panel-menu{color:#ddd;background-color:#505050}.panel-btn{padding:4px;font-size:14px;border-radius:2px;transition:background .2s}.panel-btn+.panel-btn{margin-left:.5em}.panel-btn:hover{background-color:rgba(0,0,0,.2)}.panel-body{flex:1;overflow:auto;background-color:#555}#pan-maingrid{min-height:150px;height:215px;flex:none}#keysGridWrap,#mainGridWrap,#synthOscs{flex:1}#mainGridWrap .gsuiTrack-row>div{top:-1px}.gsuiGridSamples{background-color:#2f2f2f}.gsuiBeatLines{filter:brightness(.9);transition:filter .2s}.focus .gsuiBeatLines{filter:brightness(1.1)}#pan-cmps{min-height:114px;height:200px;flex:none;position:relative}#pan-cmps .panel-title{display:flex;align-items:baseline;height:var(--ctrl-height);padding-top:0;padding-bottom:0;color:#fff;font-weight:400;cursor:default;background-color:#444}#title:before{display:block;margin-top:3px;content:"GridSound";font-family:"Oswald";font-size:28px}#appGainWrap{width:4px;height:35px;align-self:flex-end;margin:0 0 4px auto;--gsuiSlider-lineColor: #ff9;--gsuiSlider-lineBgColor: #222}#cmpMenu{left:100%;margin-left:5px}#pan-cmps .panel-btn,.action{box-sizing:border-box;align-items:center}#pan-cmps .panel-btn{display:inline-flex;padding:0 6px;border:1px solid rgba(255,255,153,.2);border-radius:8px;transition-property:background-color;font-size:11px;color:#ff9;height:24px;transition:.5s}#pan-cmps .panel-btn::before{margin-right:4px;font-family:"FontAwesome"}#pan-cmps .panel-btn:hover{color:#505050;background-color:#ff9}#pan-cmps #newComposition{border-style:dashed}#newComposition::before{content:"\f067"}#openComposition::before{content:"\f019"}#pan-history{min-height:57px;height:65px;flex:none}.action{display:flex;cursor:default;height:28px;padding-right:.4em;color:#bbb;font-size:13px;font-family:var(--monospace);background-color:#333;transition:background-color .2s}.action+.action{border-top:1px solid #222}.action:hover{background-color:#444}.action:before{content:"";display:block;width:4px;height:100%;background-color:var(--col1-middle);transition:inherit}.action.undone:before{background-color:#000}.actionIcon{margin:0 .4em}.actionText{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition-property:opacity;transition-duration:inherit}.action.undone .actionText{opacity:.5}#patterns{position:relative}#patterns .gsuiAudioBlock{position:relative;width:100%;height:64px;color:#bbb;--bd-radius: 0}#patterns .gsuiAudioBlock.selected{color:var(--col1-high)}#patterns .gsuiAudioBlock.selected .gsuiab-head:before{content:"\f07c";font-family:"FontAwesome";font-weight:400;margin-right:.5em}.pan-synth-pianoroll .pan-menu{position:relative;display:flex;align-items:center;padding:4px 6px;font-size:12px;color:#ddd;border-bottom:1px solid #111;background-color:#444}.pan-synth-pianoroll .pan-menu::before{font-style:italic;font-weight:700;font-size:11px;text-shadow:1px 1px 0 #000;opacity:.35}.pan-synth-pianoroll .pan-name{margin-left:.75em;padding:4px 8px;border-radius:4px;font-family:var(--monospace);cursor:default;transition:filter .2s}.pan-synth-pianoroll .pan-name:empty:before{content:"Untitled";font-style:italic}.pan-synth-pianoroll .pan-name:hover{color:#fff;filter:brightness(1.1)}#pan-synth{min-width:280px;max-width:400px;width:350px;flex:none}#pan-synth .pan-menu::before{content:"Synthesizer\A0:"}#synthName{background-color:#696}#synthOscs{overflow:auto;counter-reset:count-osc}#synthOscsHead{display:flex;justify-content:space-between;padding:4px 12px 4px 8px;font-size:11px;font-family:"inconsolata";color:#aaa;border-bottom:1px solid #111;background-color:#444}#synthOscsHead div{width:40px;margin-left:14px;text-align:center;text-transform:capitalize}#synthOscsHead div:first-child{width:auto;opacity:.5;margin-left:0;text-align:left}#synthOscsHeadCurve{flex:1}#synthOscAdd{display:block;margin:10px;padding:1em;border-radius:4px;font-size:12px;font-weight:700;color:var(--app-bg);text-align:center;background-color:rgba(255,255,255,.4);opacity:.3;transition:opacity .2s}#synthOscAdd:hover{opacity:.6}#pan-pianoroll .pan-menu::before{content:"Pattern\A0:"}#pianorollName,.cmp{background-color:var(--col1-middle)}.cmp{box-sizing:border-box;display:flex;color:#bbb;font-size:12px;cursor:pointer;filter:brightness(.9)}.cmp+.cmp{border-top:1px solid rgba(0,0,0,.2)}.cmp.loaded{filter:none}.cmp .save{display:flex;overflow:hidden;align-items:center;justify-content:center;width:0;background-color:var(--col2-middle)}.cmp.notSaved .save{min-width:30px}.cmp .save:before{content:"\f0a0";font:20px "FontAwesome";color:#ddd}.cmp .info{flex:1;padding:4px;overflow:hidden;transition:padding-left .2s}.cmp .info:hover{padding-left:8px}.cmp .menu{display:flex;align-items:center;justify-content:center;min-width:20px}.cmp .menu:before{content:"\f142";font:18px "FontAwesome"}.cmp .menu:hover{color:#fff}.cmp .name{overflow:hidden;color:#ddd;font-size:13px;font-weight:700;white-space:nowrap;text-overflow:ellipsis}.cmp.notSaved .name:before{content:"*"}.cmp .name:empty:after{font-style:italic;content:"Untitled"}.cmp .bpm{margin-right:1em}.cmp .bpm:before,.cmp .duration:before{font-family:"FontAwesome";margin-right:.4em}.cmp .bpm:before{content:"\f001"}.cmp .duration:before{content:"\f017"}#controls,#version,.ctrl-item{display:flex;align-items:center}#version{margin-left:.8em;font-family:"Inconsolata";font-style:italic;opacity:.5;transition:.2s;transition-property:opacity,text-shadow}#version:hover{opacity:.8;text-shadow:0 0 10px}#version.ko{color:#f94}#version.ok{color:#8fb}#version.ko,#version.ok{font-weight:700;font-style:normal;opacity:1}#version.ko::after{content:"\f071"}#version.ok::after{content:"\f00c"}#version::after{font-size:11px;font-weight:400;font-family:"FontAwesome";margin-left:4px}#controls,.ctrl-item{box-sizing:border-box}#controls{height:var(--ctrl-height);padding:var(--ctrl-padding);border-bottom:1px solid #000;background-color:#444}.ctrl-item{justify-content:center;color:#ddd;height:100%;border-radius:var(--small-bd-radius);cursor:default;transition:filter .1s}.ctrl-item+.ctrl-item{margin-left:6px}.ctrl-item:hover{filter:brightness(1.2)}.ctrl-btn{font-size:14px;border:1px solid rgba(0,0,0,.7);min-width:calc(var(--ctrl-height) - 2*var(--ctrl-padding))}.ctrl-btn:active{padding-top:4px;box-shadow:inset 0 3px 0 rgba(0,0,0,.25)}#togglePlay{flex-direction:column;justify-content:space-between;min-width:8px;height:100%}#togglePlay::after,#togglePlay::before{box-sizing:border-box;content:"";width:100%;height:40%;border:1px solid rgba(0,0,0,.7);border-radius:2px;background-color:var(--col1-low)}#togglePlay.after::after,#togglePlay:not(.after)::before{background-color:var(--col1-middle)}#play{background-color:var(--col1-middle)}#stop{background-color:#888}#bpm,#clock{font-size:30px;font-family:var(--monospace);padding:0 .3em;border:3px solid rgba(0,0,0,.3);background-color:#222;filter:none}#bpmText:before{content:"bpm";font-size:calc(9px + .1em);margin-left:.5em;opacity:.5}#clock{align-items:baseline;line-height:1em}#clockSec:before{content:":"}#clockMs:before{content:"."}#clockMs{font-size:.5em}#settings{min-width:46px;font-family:"FontAwesome";background-color:var(--col2-middle)}#settings:before{content:"\f001";margin-right:.4em}#settings:after{content:"\f013"}#shortcuts{border:0;font-size:21px;margin-left:auto;background-color:rgba(255,255,255,.1)}#patreon{border:2px solid #f6685275;color:#f66852;font-size:20px}.synthOsc{display:flex;justify-content:space-between;position:relative;border-bottom:1px solid #111;padding:8px 12px 8px 8px;color:#ddd;background-color:#3a3a3a}.synthOsc-order{display:flex;align-items:center}.synthOsc-order::before{counter-increment:count-osc;content:counter(count-osc);font-size:11px;font-weight:700;opacity:.2}.synthOsc-attr{position:relative;width:40px;margin-left:14px}.synthOsc-sliderWrap{position:relative;width:100%;height:40px;--gsuiSlider-lineBgColor: #555}.synthOsc-sliderWrap .gsuiSlider{margin:auto}.synthOsc-detune{--gsuiSlider-lineColor: #f9f}.synthOsc-gain{--gsuiSlider-lineColor: #ff9}.synthOsc-sliderValue{position:absolute;display:flex;align-items:center;justify-content:center;top:0;width:100%;height:100%;font:10px "inconsolata";color:var(--gsuiSlider-lineColor)}.synthOsc-curve{flex:1;position:relative}.synthOsc-curve .gsuiWave{width:100%;height:100%}.synthOsc-curve .gsuiWave polyline{stroke:#555;stroke-width:2px;fill:none}.synthOsc-curveValue{position:absolute;display:flex;height:100%;left:6px;top:0;align-items:center;text-transform:capitalize;text-align:center;text-shadow:0 0 2px #000;font:12px "inconsolata";opacity:.8}.synthOsc-remove{position:absolute;top:0;right:0;width:auto;opacity:.1;font-size:12px;transition:opacity .2s}.synthOsc:only-child .synthOsc-remove{display:none}.synthOsc-remove:hover{opacity:.8}
</style></head><body><noscript>GridSound needs JavaScript to run</noscript><div id="app" class="gsuiPanels-x"><div class="gsuiPanels-y" id="pan-leftside"><div class="panel-left" id="pan-cmps"></div><div class="panel-left" id="pan-history"></div><div class="panel-left" id="pan-patterns"></div></div><div class="gsuiPanels-y" id="pan-rightside"><div id="pan-maingrid"></div><div class="gsuiPanels-x"><!-- <div class="pan-synth-pianoroll" id="pan-synth"></div> --><div class="pan-synth-pianoroll" id="pan-pianoroll"></div></div></div></div><div data-panel="pan-cmps"><div class="panel-title"><div id="title"></div><a tabindex="1" id="version" aria-label="Read the changelog"href="https://github.com/gridsound/daw/wiki/changelog" target="_blank" rel="noopener"title="Click to see the changelog"></a><div id="appGainWrap" title="Main app volume (this parameter will not affect the rendering)"></div></div><div class="panel-menu"><a href id="newComposition" class="panel-btn" title="Create a new composition (Alt + N)">New</a><a href id="openComposition" class="panel-btn" title="Open a composition (Alt + O)">Open</a></div><div id="cmps" class="panel-body"></div><div id="cmpMenu" class="absoluteMenu hidden"><a href id="exportCompositionJSON">Export to JSON</a><a href id="exportCompositionWAV">Export to WAV</a><a href id="deleteComposition">Delete</a></div></div><div data-panel="pan-history"><div class="panel-title"><span class="icon ico-history"></span><span>History</span></div><div class="panel-menu"><a id="undo" class="icon ico-undo panel-btn" title="Undo the previous action (Alt + Z)"></a><a id="redo" class="icon ico-redo panel-btn" title="Redo the next action (Alt + Shift + Z)"></a></div><div id="history" class="panel-body"></div></div><div data-panel="pan-patterns"><div class="panel-title"><span class="icon ico-pattern"></span><span>Patterns</span></div><div class="panel-menu"><a id="patNew" class="icon ico-new panel-btn" title="Create a new pattern"></a><a id="patClone" class="icon ico-clone panel-btn" title="Clone the selected pattern"></a><a id="patRemove" class="icon ico-remove panel-btn" title="Delete the selected pattern"></a></div><div id="patterns" class="panel-body gsui-nocrop"></div></div><div data-panel="pan-maingrid"><div id="controls"><a tabindex="2" href id="togglePlay" aria-label="Switch grid focus" class="ctrl-item"></a><a tabindex="3" href id="play" aria-label="Play" class="ctrl-item ctrl-btn icon ico-play"></a><a tabindex="4" href id="stop" aria-label="Stop" class="ctrl-item ctrl-btn icon ico-stop"></a><div id="clock" class="ctrl-item"><div id="clockMin"></div><div id="clockSec"></div><div id="clockMs"></div></div><div id="bpm" class="ctrl-item"><span id="bpmNumber"></span><span id="bpmText"></span></div><a tabindex="5" href id="settings" aria-label="Settings" class="ctrl-item ctrl-btn"></a><a tabindex="6" href id="shortcuts" aria-label="Shortcuts" class="ctrl-item ctrl-btn icon ico-keyboard"></a><a tabindex="7" id="patreon" aria-label="Patreon" class="ctrl-item ctrl-btn icon ico-brand ico-patreon"href="https://www.patreon.com/gridsound" target="_blank" rel="noopener"title="Visit our Patreon page"></a></div><div id="mainGridWrap"></div></div><div data-panel="pan-synth"><div class="pan-menu"><div class="pan-name" id="synthName"></div></div><div id="synthOscsHead"><div>#</div><div id="synthOscsHeadCurve">curve</div><div>detune</div><div>pan</div><div>gain</div></div><div id="synthOscs"><div id="synthOscsList"></div><a href id="synthOscAdd"><i class="icon ico-add"></i><span> New oscillator</span></a></div></div><div data-panel="pan-pianoroll"><div class="pan-menu"><div class="pan-name" id="pianorollName"></div></div><div id="keysGridWrap"></div></div><div class="popup" id="openPopupContent"><fieldset><legend>Open and load a new composition</legend><div class="param"><div class="param-title">With an URL</div><div class="param-values"><input type="url" placeholder="http://"/></div></div><div class="param"><div class="param-title">With a local file<br/><small>(Please notice that you can also drop a file into the app)</small></div><div class="param-values"><input type="file"/></div></div></fieldset></div><div class="popup" id="settingsPopupContent"><fieldset><legend>GridSound's DAW settings</legend><div class="param"><div class="param-title">Clock display</div><div class="param-values"><input id="radioClSec" name="clock" type="radio"/> <label for="radioClSec">min:sec.ms</label><br/><input id="radioClBeat" name="clock" type="radio"/> <label for="radioClBeat">beats:steps.milisteps</label></div></div></fieldset><fieldset><legend>Composition settings</legend><div class="param"><div class="param-title">Title</div><div class="param-values"><input type="text" placeholder="untitled"/></div></div><div class="param"><div class="param-title">BPM</div><div class="param-values"><input type="number" min="1" max="999"/><span id="bpmTap" class="btn icon ico-tint"></span></div></div><div class="param"><div class="param-title">Beats per measure</div><div class="param-values"><input type="number" min="1" max="16"/></div></div><div class="param"><div class="param-title">Steps per beat</div><div class="param-values"><input type="number" min="1" max="16"/></div></div></fieldset></div><div class="popup" id="shortcutsPopupContent"><fieldset><legend>Keyboard</legend><div class="param"><div class="param-title">Undo</div><div class="param-values"><span class="shortcuts">alt</span>+<span class="shortcuts">Z</span></div></div><div class="param"><div class="param-title">Redo</div><div class="param-values"><span class="shortcuts">alt</span>+<span class="shortcuts">shift</span>+<span class="shortcuts">Z</span></div></div><div class="param"><div class="param-title">Select all</div><div class="param-values"><span class="shortcuts">alt</span>+<span class="shortcuts">A</span></div></div><div class="param"><div class="param-title">Deselect</div><div class="param-values"><span class="shortcuts">alt</span>+<span class="shortcuts">D</span></div></div><div class="param"><div class="param-title">New composition</div><div class="param-values"><span class="shortcuts">alt</span>+<span class="shortcuts">N</span></div></div></fieldset><fieldset><legend>Mouse (panel / grid)</legend><div class="param"><div class="param-title">Scroll up / down</div><div class="param-values"><span class="shortcuts">scroll <i class="icon ico-arrows-v"></i></span></div></div><div class="param"><div class="param-title">Scroll left / right</div><div class="param-values"><span class="shortcuts">shift</span>+<span class="shortcuts">scroll <i class="icon ico-arrows-v"></i></span></div></div><div class="param"><div class="param-title">Zoom in / out</div><div class="param-values"><span class="shortcuts">ctrl</span>or<span class="shortcuts"><i class="icon ico-cmd"></i></span>+<span class="shortcuts">scroll <i class="icon ico-arrows-v"></i></span></div></div></fieldset></div><div id="synthOsc" class="synthOsc"><div class="synthOsc-order"></div><div class="synthOsc-attr synthOsc-curve"><div class="synthOsc-curveValue"></div></div><div class="synthOsc-attr synthOsc-detune"><div class="synthOsc-sliderValue"></div><div class="synthOsc-sliderWrap"></div></div><div class="synthOsc-attr synthOsc-pan"><div class="synthOsc-sliderValue"></div><div class="synthOsc-sliderWrap"></div></div><div class="synthOsc-attr synthOsc-gain"><div class="synthOsc-sliderValue"></div><div class="synthOsc-sliderWrap"></div></div><a href class="synthOsc-remove icon ico-times" title="Remove the oscillator"></a></div><template id="gsuiAudioBlock"><div class="gsuiAudioBlock"><div class="gsuiab-bg"></div><div class="gsuiab-head"><span class="gsuiab-name"></span></div><div class="gsuiab-content"></div><div class="gsuiab-crop gsuiab-cropA"></div><div class="gsuiab-crop gsuiab-cropB"></div></div></template><template id="gsuiGridSamples"><div class="gsuiGridSamples" tabindex="-1"><div class="gsuigs-panel"><div class="gsuigs-extend"></div><div class="gsuigs-content"></div></div><div class="gsuigs-grid"><div class="gsuigs-content"></div><div class="gsuigs-select hidden"></div></div></div></template><template id="gsuiKeys-octave"><div class="gsuiKey" data-key="b" ><div data-key="b"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="a#"><div data-key="a#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="a" ><div data-key="a"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="g#"><div data-key="g#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="g" ><div data-key="g"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="f#"><div data-key="f#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="f" ><div data-key="f"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="e" ><div data-key="e"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="d#"><div data-key="d#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="d" ><div data-key="d"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="c#"><div data-key="c#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="c" ><div data-key="c"  class="gsui-row gsuiKey-row"><div></div></div></div></template><div id="gsuiPopup"><div id="gsuipp-window" tabindex="0"><div id="gsuipp-head"></div><form id="gsuipp-body"><div id="gsuipp-cnt"></div><div id="gsuipp-msg"></div><input type="text" id="gsuipp-inpText"/><div id="gsuipp-btns"><input type="button" id="gsuipp-inpCancel" value="Cancel"/><input type="submit" id="gsuipp-inpOk" value="Ok"/></div></form></div></div><template id="gsuiSlider"><div class="gsuiSlider"><input type="range"/><div class="gsui-line"><div class="gsui-lineColor"></div></div><svg><circle class="gsui-svgLine"/><circle class="gsui-svgLineColor"/></svg><div class="gsui-eventCatcher"></div></div></template><template id="gsuiTimeLine"><div class="gsuiTimeLine"><div class="gsui-loopLine"></div><div class="gsui-loop"><div class="gsui-loopExt gsui-loopA"></div><div class="gsui-loopExt gsui-loopB"></div><div class="gsui-loopBrd gsui-loopBrdA"></div><div class="gsui-loopBrd gsui-loopBrdB"></div><div class="gsui-loopBg"></div></div><svg class="gsui-cursor" width="20" height="10"><polygon points="2,2 10,8 18,2"/></svg><div class="gsui-currentTime"><div class="gsui-cursorLine"></div></div></div></template><template id="gsuiToggle"><div class="gsuiToggle"><div class="gsui-circle"></div></div></template><template id="gsuiTrack"><div class="gsuiTrack"><div class="gsui-row gsuiTrack-row"><div></div></div></div></template><template id="gsuiTrackList"><div class="gsuiTrackList"></div></template><template id="gsuiSpanEditable"><div class="gsuiSpanEditable"><span></span><input type="text"/></div></template><script>"use strict";function gsuiAudioBlock(){var e=this._clone();e.gsuiAudioBlock=this,e.querySelectorAll("*").forEach(function(e){e.gsuiAudioBlock=this},this),this.rootElement=e,this._elName=e.querySelector(".gsuiab-name"),this._elCnt=e.querySelector(".gsuiab-content"),this._elCropA=e.querySelector(".gsuiab-cropA"),this._elCropB=e.querySelector(".gsuiab-cropB"),this._elCropA.onmousedown=this._elCropB.onmousedown=this._evmdCrop.bind(this),e.onmousedown=this._evmdRoot.bind(this),this.selected=!1}function gsuiBeatLines(e){this.rootElement=e=e||document.createElementNS(SVGURL,"svg"),e.setAttribute("preserveAspectRatio","none"),e.classList.add("gsuiBeatLines"),this.elTime=this._newRect(),this._elLoopA=this._newRect(),this._elLoopB=this._newRect(),this.elTime.setAttribute("class","gsui-currentTime"),this._elLoopA.setAttribute("class","gsui-hlStart"),this._elLoopB.setAttribute("class","gsui-hlEnd"),this._elLoopA.setAttribute("x",0),this._elLoopB.setAttribute("width","10000%"),this._offset=0,this._pxPerBeat=32,this._beatsPerMeasure=this._stepsPerBeat=4,this.steps=[],this.currentTime(0),this.loop(!1)}function gsuiGridSamples(){var e=this._clone();this.rootElement=e,this._onMac=navigator.platform.startsWith("Mac"),this._onFirefox=navigator.userAgent.includes("Firefox"),this._elPanel=e.querySelector(".gsuigs-panel"),this._elGrid=e.querySelector(".gsuigs-grid"),this._elPanelExt=this._elPanel.querySelector(".gsuigs-extend"),this._elPanelCnt=this._elPanel.querySelector(".gsuigs-content"),this._elGridCnt=this._elGrid.querySelector(".gsuigs-content"),this._elSelection=this._elGrid.querySelector(".gsuigs-select"),this.uiTimeLine=new gsuiTimeLine,this.uiBeatLines=new gsuiBeatLines,e.prepend(this.uiTimeLine.rootElement),this._elGrid.prepend(this.uiBeatLines.rootElement),this.rows=this._elGridCnt.childNodes,this._rowsById={},e.oncontextmenu=function(){return!1},e.onkeydown=this._evkdRoot.bind(this),this._elPanelExt.onmousedown=this._evmdPanelEx.bind(this),this._elGrid.onmousedown=this._evmdGrid.bind(this),this._elGrid.onwheel=this._evowGrid.bind(this),this._elPanel.onwheel=this._evowPanel.bind(this),this.uiTimeLine.onchangeCurrentTime=this._evocCurrentTime.bind(this),this.uiTimeLine.oninputLoop=this._evoiLoop.bind(this),this.uiTimeLine.onchangeLoop=this._evocLoop.bind(this),this._panelMaxWidth=1/0,this._panelMinWidth=this._contentY=this._timeOffset=0,this._pxPerBeat=80,this._fontSizeTiny=48,this._bcInit(),this.panelWidth(100)}function gsuiKeys(){var e=document.createElement("div");this._init(),this.rootElement=e,this.rowElements=[],this._nlKeys=e.childNodes,this._nbOct=0,e.className="gsuiKeys",e.onmousedown=this._evmdRoot.bind(this)}function gsuiPanels(e){this.rootElement=e,this.init(e),gsuiPanels.bodyEventsInit&&gsuiPanels.bodyEventsInit()}function gsuiRectMatrix(){var e=document.createElementNS(SVGURL,"svg");this.rootElement=e,e.setAttribute("preserveAspectRatio","none"),e.classList.add("gsuiRectMatrix")}function gsuiSlider(){var e=this._clone();this.rootElement=e,this._elInput=e.querySelector("input"),this._elLine=e.querySelector(".gsui-line"),this._elLineColor=e.querySelector(".gsui-lineColor"),this._elSvg=e.querySelector("svg"),this._elSvgLine=e.querySelector(".gsui-svgLine"),this._elSvgLineColor=e.querySelector(".gsui-svgLineColor"),e.onwheel=this._wheel.bind(this),e.onmousedown=this._mousedown.bind(this)}function gsuiSpanEditable(){this.rootElement=this._clone(),this.span=this.rootElement.querySelector("span"),this.input=this.rootElement.querySelector("input"),this.rootElement.ondblclick=this._dblclick.bind(this),this.input.onblur=this._blur.bind(this),this.input.onkeydown=this._keydown.bind(this),this.setPlaceholder(""),this.setValue("")}function gsuiTimeLine(){var e=this._clone(),t=e.querySelector(".gsui-currentTime"),i=e.querySelector(".gsui-loopBg");this.rootElement=e,this._elTime=e.querySelector(".gsui-cursor"),this._elTimeLine=e.querySelector(".gsui-cursorLine"),this._elLoop=e.querySelector(".gsui-loop"),this._elLoopBgCL=i.classList,this._elLoopBrdACL=e.querySelector(".gsui-loopBrdA").classList,this._elLoopBrdBCL=e.querySelector(".gsui-loopBrdB").classList,this._offset=0,this._pxPerBeat=32,this._beatsPerMeasure=this._stepsPerBeat=4,this._steps=[],this.stepRound=1,this.currentTime(0),this.loop(0,0),t.onmousedown=this._mousedownTime.bind(this),t.onmousemove=this._mousemoveTime.bind(this),i.onmousedown=this._mousedownLoop.bind(this,"ab"),e.querySelector(".gsui-loopA").onmousedown=this._mousedownLoop.bind(this,"a"),e.querySelector(".gsui-loopB").onmousedown=this._mousedownLoop.bind(this,"b"),e.querySelector(".gsui-loopLine").onmousedown=this._mousedownLoopLine.bind(this)}function gsuiToggle(){var e=this._clone();e.querySelector("input");this.rootElement=e,this._circCL=e.querySelector(".gsui-circle").classList,this.checked=!1,e.oncontextmenu=function(){return!1},e.onmousedown=this._mousedown.bind(this)}function gsuiTrack(){var e=this._clone();this.rootElement=e,this.rowElement=e.querySelector(".gsui-row"),this.rowElement.remove(),this.uiToggle=new gsuiToggle,this.uiSpan=new gsuiSpanEditable,e.append(this.uiToggle.rootElement),e.append(this.uiSpan.rootElement),this.data={},this.uiToggle.onchange=this._evocToggle.bind(this),this.uiSpan.onchange=this._evocSpan.bind(this),this.toggle(!0)}function gsuiTrackList(){var e=this._clone();this.data={},this.rootElement=e,this._uiTracks={}}function gsuiWave(e){this.rootElement=e||document.createElementNS(SVGURL,"svg"),this.rootElement.setAttribute("preserveAspectRatio","none"),this.rootElement.classList.add("gsuiWave"),this.polyline=this.rootElement.querySelector("polyline"),this.polyline||(this.polyline=document.createElementNS(SVGURL,"polyline"),this.rootElement.appendChild(this.polyline)),this.type="sine",this.frequency=1,this.attack=this.amplitude=0}function gswaScheduler(){}gsuiAudioBlock.typeToCmp={buffer:"gsuiWaveform",keys:"gsuiRectMatrix"},gsuiAudioBlock.prototype={setResolution(e,t){this.resW=e,this.resH=t,this._uiContentCmp&&this._uiContentCmp.setResolution(e,t)},name(e){this._elName.textContent=e},select(e){this.rootElement.classList.toggle("gsuiab-selected",this.selected=!!e)},when(e){this.rootElement.style.left=e+"em"},whenOffset(e){this._elCnt.style.left=parseFloat(this._elCnt.style.left||0)-e+parseFloat(this.rootElement.style.left||0)+"em",this.when(e)},duration(e){this.rootElement.style.width=this.width=e+"em"},contentWidthFixed(){this._elCnt.style.width=this.width},contentWidthExtendable(){this._elCnt.style.width="100%"},datatype(e){e!==this._datatype&&(this._datatype=this.rootElement.dataset.type=e,this._uiContentCmp&&(this._uiContentCmp.remove(),delete this._uiContentCmp))},updateData(e,t,i){var s=this._uiContentCmp;this._dataDur=e.duration,this._elCnt.style.left=0,s||(this._uiContentCmp=s=new window[gsuiAudioBlock.typeToCmp[this._datatype]],this._elCnt.append(s.rootElement),this.resW?this.setResolution(this.resW,this.resH):this.setResolution(s.rootElement.getBoundingClientRect().width,32)),s.render(e,t,i)},start(e){var t=document.createElement("div");this.stop(),t.className="gsuiab-cursor",t.style.animationDuration=60*this._dataDur/(e||60)+"s",this._elCursor=t,this._elCnt.append(t)},stop(){this._elCursor&&(this._elCursor.remove(),delete this._elCursor)},_clone(){var e=document.createElement("div");return gsuiAudioBlock.template=gsuiAudioBlock.template||this._init(),e.appendChild(document.importNode(gsuiAudioBlock.template.content,!0)),e.removeChild(e.querySelector("*"))},_init:()=>(document.body.addEventListener("mousemove",function(e){gsuiAudioBlock._focused&&gsuiAudioBlock._focused._evmmBody(e)}),document.body.addEventListener("mouseup",function(e){gsuiAudioBlock._focused&&gsuiAudioBlock._focused._evmuBody(e)}),document.getElementById("gsuiAudioBlock")),_evmdRoot(e){0===e.button&&(this._isDragging=!0),this.onmousedown&&!1!==this.onmousedown(this,e)&&(gsuiAudioBlock._focused=this)},_evmmBody(e){gsuiAudioBlock._focused&&(this._elCropping?this.onmousemoveCrop&&this.onmousemoveCrop(this,+this._cropSide,e):this._isDragging&&this.onmousemove&&this.onmousemove(this,e))},_evmuBody(e){gsuiAudioBlock._focused&&(this._elCropping?(this._elCropping.classList.remove("hover"),this.onmouseupCrop&&this.onmouseupCrop(this,+this._cropSide,e),delete this._elCropping):this._isDragging&&(this.onmouseup&&this.onmouseup(this,e),delete this._isDragging),delete gsuiAudioBlock._focused)},_evmdCrop(e){0===e.button&&(e.stopPropagation(),this._elCropping=e.target,this._cropSide=e.target===this._elCropB,e.target.classList.add("hover"),this.onmousedownCrop&&this.onmousedownCrop(this,+this._cropSide,e),gsuiAudioBlock._focused=this)}},window.SVGURL="http://www.w3.org/2000/svg",gsuiBeatLines.prototype={resized(){var e=this.rootElement;this.width=e.getBoundingClientRect().width,e.setAttribute("viewBox","0 0 "+this.width+" 1")},currentTime(e){this._currentTime=e,this._timeUpdate()},offset(e,t){this._offset=Math.max(0,e),this._pxPerBeat=Math.max(0,t),this._render()},timeSignature(e,t){this._beatsPerMeasure=Math.max(1,~~e),this._stepsPerBeat=Math.min(Math.max(1,~~t),16),this._render()},loop(e,t){(this._loop=!1!==e)&&(this._loopA=e,this._loopB=t,this._updateLoop()),this._elLoopA.style.display=this._elLoopB.style.display=this._loop?"block":"none"},render(){this._render()},_render(){for(var e,t,i=this.steps,s=this._pxPerBeat,o=this._stepsPerBeat,n=o*this._beatsPerMeasure,a=s/o,r=1/o,l=0,c=Math.ceil(this.width/a),u=1+~~(this._offset*o),h=-this._offset%r+r;i.length<c;)i.push(this._newRect());for(;l<c;++l)e="gsui-"+(u%n?u%o?"step":"beat":"measure"),(t=i[l]).style.display="block",t.setAttribute("x",h*s+"px"),t.setAttribute("class",e),t.setAttribute("width","gsui-measure"!==e?"1px":"2px"),++u,h+=r;for(;(t=i[l++])&&"none"!==t.style.display;)t.style.display="none";this._timeUpdate(),this._loop&&this._updateLoop()},_newRect(){var e=document.createElementNS(SVGURL,"rect");return e.setAttribute("y",0),e.setAttribute("height","1px"),e.setAttribute("width","1px"),e.style.display="none",this.rootElement.prepend(e),e},_timeUpdate(){var e=this._currentTime-this._offset;this.elTime.style.display=e>0?"block":"none",this.elTime.setAttribute("x",e*this._pxPerBeat+"px")},_updateLoop(){this._elLoopA.setAttribute("width",Math.max(0,this._loopA-this._offset)*this._pxPerBeat+"px"),this._elLoopB.setAttribute("x",(this._loopB-this._offset)*this._pxPerBeat+"px")}},gsuiGridSamples.prototype={empty(){this.uiTrackList&&(this.uiTrackList.empty(),this._rowsById={}),this._bcEmpty()},change(e){e.tracks?(this.uiTrackList.change(e.tracks),this.uiTrackList.newRowElements.forEach(this._rowInit,this)):this._bcChange(e)},resized(){var e=getComputedStyle(this._elPanel);this.width=this.rootElement.clientWidth,this._panelMinWidth=parseFloat(e.minWidth),this._panelMaxWidth=parseFloat(e.maxWidth)||this.width,this._resizeGrid(),this._updateGrid()},setFontSize(e){var t=this._fontSize;(e=~~Math.min(Math.max(16,e),256))!==t&&(this._fontSize=e,this.rootElement.style.fontSize=e+"px",e<this._fontSizeTiny!=t<this._fontSizeTiny&&this.rows.forEach(this._rowUpdateSizeClass,this))},offset(e,t){this._timeOffset=e,this._pxPerBeat=t||this._pxPerBeat,this._updateGrid(!!t)},timeSignature(e,t){this.uiTimeLine.timeSignature(e,t),this.uiBeatLines.timeSignature(e,t)},currentTime(e){this.uiTimeLine.currentTime(e),this.uiBeatLines.currentTime(e)},loop(e,t){this.uiTimeLine.loop(e,t),this.uiBeatLines.loop(e,t)},panelWidth(e){e=Math.max(this._panelMinWidth,Math.min(e,this._panelMaxWidth)),this._timeOffset>0&&(this._timeOffset+=(e-this._panelWidth)/this._pxPerBeat),this._panelWidth=e,this._updatePanelSize()},contentY(e){var t=(this.uiTrackList||this.uiKeys).rootElement.clientHeight;t=Math.max(0,t-this._elGrid.clientHeight)/this._fontSize,this._contentY=e=Math.min(Math.max(0,e),t),this._elGridCnt.style.marginTop=this._elPanelCnt.style.marginTop=-e+"em"},scrollToSamples(){var e=this._elGridCnt.querySelector(".gsuiAudioBlock");e&&this.contentY((e.getBoundingClientRect().top-this._elGridCnt.getBoundingClientRect().top)/this._fontSize-3)},loadKeys(e,t){this._loadPanelCmp("uiKeys","uiTrackList"),this._elGridCnt.classList.add("gsui-noleftcrop"),this.uiKeys.octaves(e,t),this.uiKeys.newRowElements.forEach(this._rowInit,this)},loadTrackList(){this._loadPanelCmp("uiTrackList","uiKeys"),this._elGridCnt.classList.remove("gsui-noleftcrop"),this.uiTrackList.onchange=(e=>this.onchange({tracks:e}))},_clone(){var e=document.createElement("div");return gsuiGridSamples.template=gsuiGridSamples.template||this._init(),e.appendChild(document.importNode(gsuiGridSamples.template.content,!0)),e.removeChild(e.querySelector("*"))},_init:()=>(document.body.addEventListener("mousemove",function(e){gsuiGridSamples._focused&&gsuiGridSamples._focused._evmmRoot(e)}),document.body.addEventListener("mouseup",function(e){gsuiGridSamples._focused&&gsuiGridSamples._focused._evmuRoot(e)}),document.getElementById("gsuiGridSamples")),_callOnchange(e){for(var t in e){this.onchange(e);break}},_loadPanelCmp(e,t){var i=this[e],s=this[t];s?(s.remove(),this.setFontSize(this._fontSize*("uiKeys"===e?.5:2)),delete this[t]):this.setFontSize("uiKeys"===e?20:40),i||(this[e]=i="uiKeys"===e?new gsuiKeys:new gsuiTrackList,this._elPanelCnt.prepend(i.rootElement))},_resizeGrid(){this.uiTimeLine.resized(),this.uiBeatLines.resized()},_deltaY(e,t,i){return this._onMac?e:e>0?t:i||-t},_contentScroll(e){var t,i=this._pxPerBeat;Math.abs(e.deltaY)>Math.abs(e.deltaX)?this.contentY(this._contentY+this._deltaY(e.deltaY,20,-20)/this._fontSize):(t=e.deltaX/i*2,this.offset(Math.max(0,this._timeOffset+t)))},_getMouseBeat(e){return this._elGridCntBCR=this._elGridCnt.getBoundingClientRect(),this.uiTimeLine._round((e-this._elGridCntBCR.left)/this._pxPerBeat)},_updateGrid(e){var t=this._pxPerBeat;this.uiTimeLine.offset(this._timeOffset,t),this.uiBeatLines.offset(this._timeOffset,t),this._timeOffset=this.uiTimeLine._offset,this._pxPerBeat=t=this.uiTimeLine._pxPerBeat,this._elGridCnt.style.left=-this._timeOffset*t+"px",e&&this.rows.forEach(this._rowUpdateFontSize,this)},_updatePanelSize(){this._elPanel.style.width=this._elGrid.style.left=this._panelWidth+"px",this.uiTimeLine.rootElement.style.left=this._panelWidth-1+"px",this._resizeGrid(),this._updateGrid()},_findTrack(e){var t=~~((e-this._elGridCntBCR.top)/this._fontSize);return this.rows[Math.max(0,Math.min(t,this.rows.length-1))]},_rowInit(e,t){var i=this.uiKeys;i&&(e.dataset.octave=i._octStart+i._nbOct-1-~~(t/12)),e.onmousedown=this._evmdRow.bind(this,e),this._rowsById[e.dataset.track]=e,this._rowUpdateFontSize(e),this._rowUpdateSizeClass(e),this._elGridCnt.append(e)},_rowUpdateFontSize(e){e.firstChild.style.fontSize=this._pxPerBeat+"px"},_rowUpdateSizeClass(e){e.classList.toggle("gs-row-tiny",this._fontSize<this._fontSizeTiny)},_rowByValue(e){var t=this.uiKeys;return t?this.rows[t.rowElements.length-1-t.keyToIndex(e)]:this._rowsById[e]},_rowIndexByData(e){return e.track?this._rowIndexByElement(this._rowsById[e.track]):this.uiKeys.rowElements.length-this.uiKeys.keyToIndex(e.key)-1},_rowIndexByElement(e){return e.dataset.rowid?+e.dataset.rowid:Array.from(this.rows).indexOf(e)},_evocCurrentTime(e){this.uiBeatLines.currentTime(e),this.onchangeCurrentTime&&this.onchangeCurrentTime(e)},_evoiLoop(e,t,i){this.uiBeatLines.loop(e&&t,i),this.oninputLoop&&this.oninputLoop(e,t,i)},_evocLoop(e,t,i){this.onchangeLoop&&this.onchangeLoop(e,t,i)},_evmdGrid(e){this._mdPageX=e.pageX,this._mdPageY=e.pageY,this._mdBeat=this._getMouseBeat(e.pageX),gsuiGridSamples._focused=this,e.shiftKey?this._selectionIsStarting=!0:e.altKey&&(this._gridDragging=!0,this._mouseOffset=this._timeOffset,this._mouseContentY=this._contentY)},_evmdPanelEx(e){this._rootLeft=this.rootElement.getBoundingClientRect().left,this._panelResizing=this._elPanelExt.clientWidth-e.layerX,this._elPanelExt.classList.add("gsui-hover"),gsuiGridSamples._focused=this},_evmdRow(e,t){if(!(this._bcClicked||t.shiftKey||t.ctrlKey||t.altKey))if(2===t.button)this._deletionStarted();else if(0===t.button&&this.uiKeys){var i=gsuiGridSamples.getNewId(),s=this._bcUnselectAll(),o={key:e.dataset.key+e.dataset.octave,when:this._getMouseBeat(t.pageX),offset:0,duration:this._bcLastDur||1};s[i]=o,this._bcCreate(i,o),this.onchange(s)}},_evowGrid(e){if(e.shiftKey||e.ctrlKey||e.metaKey){var t,i,s=this._metaKeyOnMac(e)||this._onPinchAndZoom(e),o=this._pxPerBeat;if(s)t=e.pageX-this._elGrid.getBoundingClientRect().left,o*=this._onMac&&!this._onFirefox?e.deltaY>0?.975:1.025:e.deltaY>0?.9:1.1,o=Math.min(Math.max(8,o),512),i=t/this._pxPerBeat*(o-this._pxPerBeat)/o;else{if(!e.shiftKey)return!1;i=this._deltaY(e.deltaY,20,-20)/o}this.offset(Math.max(0,this._timeOffset+i),s?o:void 0)}else this._contentScroll(e);return!1},_evowPanel(e){if(e.ctrlKey||this._metaKeyOnMac(e)){var t=e.pageY-this._elPanel.getBoundingClientRect().top,i=this._fontSize,s=i*(e.deltaY>0?.9:1.1);this.setFontSize(s),s=this._fontSize,this.contentY(this._contentY+t/i*(s-i)/s)}else e.shiftKey||this._contentScroll(e);return!1},_evmmRoot(e){var t=e.pageX-this._mdPageX,i=e.pageY-this._mdPageY;this._gridDragging?(this.offset(this._mouseOffset-t/this._pxPerBeat),this.contentY(this._mouseContentY-i/this._fontSize)):null!=this._panelResizing?this.panelWidth(e.pageX-this._rootLeft+this._panelResizing):this._deletionObj?this._deletionPush(e.target.gsuiAudioBlock&&e.target.gsuiAudioBlock.id):this._selectionIsStarted?this._selectionStarted(e):this._selectionIsStarting&&this._selectionStarting(e,t,i)},_evmuRoot(){this._selectionEnd(),this._deletionEnd(),this._elPanelExt.classList.remove("gsui-hover"),delete this._bcClicked,delete this._gridDragging,delete this._panelResizing,delete gsuiGridSamples._focused},_evkdRoot(e){switch(e.code){case"KeyA":e.altKey&&this._callOnchange(this._bcSelectAll());break;case"KeyD":if(e.altKey)return this._callOnchange(this._bcUnselectAll()),!1;break;case"Delete":this._deletionObj={};for(var t in this._bcSelected)this._deletionPush(t);this._deletionEnd()}},_metaKeyOnMac(e){return this._onMac&&e.metaKey},_onPinchAndZoom:e=>e.ctrlKey&&Math.abs(e.deltaY)>Math.abs(e.deltaX)},Object.assign(gsuiGridSamples.prototype,{_bcInit(){this._bcAll={},this._bcSelected={},this._bcLastDur=1},_bcEmpty(){for(var e in this._bcAll)this._bcAll[e].rootElement.remove(),delete this._bcAll[e],delete this._bcSelected[e]},_bcChange(e){for(var t in e)e[t]?this._bcAll[t]?this._bcUpdate(t,e[t]):this._bcCreate(t,e[t]):this._bcDelete(t)},_bcCreate(e,t){var i=new gsuiAudioBlock;return this._bcAll[e]=i,i.id=e,i.data=t,t.key?(i.datatype("key"),i.name(t.key)):i.datatype("keys"),i.onmousedown=this._bcBodyDown.bind(this),i.onmousemove=this._bcBodyMove.bind(this),i.onmouseup=this._bcBodyUp.bind(this),i.onmousedownCrop=this._bcCropDown.bind(this),i.onmousemoveCrop=this._bcCropMove.bind(this),i.onmouseupCrop=this._bcCropUp.bind(this),this.__bcUpdate(e,t),this.fnSampleCreate&&this.fnSampleCreate(e,i),this.fnSampleUpdate&&this.fnSampleUpdate(e,i),i},_bcUpdate(e,t){var i=this.__bcUpdate(e,t);this.fnSampleUpdate&&this.fnSampleUpdate(e,i)},__bcUpdate(e,t){var i=this._bcAll[e];return"when"in t&&i.when(t.when),"selected"in t&&this._bcSelect(e,t.selected),"duration"in t&&(this._bcLastDur=t.duration,i.duration(t.duration),i.contentWidthFixed(),i.setResolution(t.duration*this._pxPerBeat,this._fontSize)),("key"in t||"track"in t)&&("key"in t&&i.name(t.key),this._rowByValue(t.key||t.track).firstChild.append(i.rootElement)),i},_bcDelete(e){var t=this._bcAll[e];t&&(t.rootElement.remove(),delete this._bcAll[e],delete this._bcSelected[e],this.fnSampleDelete&&this.fnSampleDelete(e,t))},_bcForEach(e,t){if(e.data.selected)for(var i in this._bcSelected)t(this._bcSelected[i]);else t(e)},_bcSelect(e,t){var i=this._bcAll[e];i.select(t),t?this._bcSelected[e]=i:delete this._bcSelected[e]},_bcSelectAll(){return Object.keys(this._bcAll).reduce((e,t)=>(this._bcAll[t].data.selected||(this._bcSelect(t,!0),e[t]={selected:!0}),e),{})},_bcUnselectAll(){return Object.keys(this._bcSelected).reduce((e,t)=>(this._bcSelect(t,!1),e[t]={selected:!1},e),{})},_bcCropDown(e,t,i){var s,o=e.data.when,n=e.data.offset,a=e.data.duration,r=this._bcSelected,l=1/this.uiTimeLine._stepsPerBeat;if(e.data.selected)for(s in r)o=Math.min(o,r[s].data.when),n=Math.min(n,r[s].data.offset),a=Math.min(a,r[s].data.duration);this._cropPageX=i.pageX,this._cropWhenMin=o,this._cropOffMin=n,this._cropDurMin=a>l?a-l:0,this._cropWhenRel=this._cropOffRel=this._cropDurRel=0},_bcCropMove(e,t,i){var s,o,n,a=this.uiTimeLine._round((i.pageX-this._cropPageX)/this._pxPerBeat);1===t?(s=o=0,n=a>=0?a:Math.max(-this._cropDurMin,a)):a<0?(n=-(o=s=Math.max(-this._cropWhenMin,a)),s+=(a=Math.max(-this._cropOffMin,o))-o,n-=a-o,o=a):o=s=-(n=Math.max(-this._cropDurMin,-a)),this._cropWhenRel=s,this._cropOffRel=o,this._cropDurRel=n,this._bcForEach(e,this.__bcCropMove.bind(this,t,s,n))},__bcCropMove(e,t,i,s){e||s.whenOffset(s.data.when+t),s.duration(s.data.duration+i)},_bcCropUp(e){if(delete this._cropPageX,Math.abs(this._cropWhenRel)>1e-4||Math.abs(this._cropDurRel)>1e-4){var t={};this._bcForEach(e,this.__bcCropUp.bind(this,t,this._cropWhenRel,this._cropOffRel,this._cropDurRel)),this.onchange(t)}},__bcCropUp(e,t,i,s,o){var n={};Math.abs(t)>1e-4&&(n.when=o.data.when+t,n.offset=o.data.offset+i),Math.abs(s)>1e-4&&(n.duration=o.data.duration+s,o.data.durationEdited||(n.durationEdited=!0)),e[o.id]=n},_bcBodyDown(e,t){var i,s,o,n,a,r=this._bcSelected,l=e.id;if(this._bcClicked=e,2===t.button)return this._deletionStarted(l),!1;if(t.shiftKey)return i=!r[l],this._bcSelect(l,i),this.onchange({[l]:{selected:i}}),!1;if(t.altKey)return!1;if(this._movePageX=t.pageX,this._moveTrack=n=o=this._rowIndexByData(e.data),s=e.data.when,e.data.selected)for(l in r)e=r[l],a=this._rowIndexByData(e.data),s=Math.min(s,e.data.when),o=Math.min(o,a),n=Math.max(n,a);this._moveWhenMin=s,this._moveTrackMin=o,this._moveTrackMax=this.rows.length-n-1,this._moveWhenRel=this._moveTrackRel=0},_bcBodyMove(e,t){var i=this.uiTimeLine._round((t.pageX-this._movePageX)/this._pxPerBeat),s=this._findTrack(t.pageY),o=this._rowIndexByElement(s)-this._moveTrack;i<0&&(i=Math.max(-this._moveWhenMin,i)),o<0?o=Math.max(-this._moveTrackMin,o):o>0&&(o=Math.min(this._moveTrackMax,o)),this._moveWhenRel=i,this._moveTrackRel=o,this._bcForEach(e,this.__bcBodyMove.bind(this,i,o))},__bcBodyMove(e,t,i){i.when(i.data.when+e),i._gsuigsTrackRel!==t&&(i._gsuigsTrackRel=t,this.rows[this._rowIndexByData(i.data)+t].firstChild.append(i.rootElement))},_bcBodyUp(e,t){if(delete this._movePageX,this._moveTrackRel||Math.abs(this._moveWhenRel)>1e-4){var i={};this._bcForEach(e,this.__bcBodyUp.bind(this,i,this._moveWhenRel,this._moveTrackRel)),this.onchange(i)}},__bcBodyUp(e,t,i,s){var o,n={};i&&((o=s.rootElement.parentNode.parentNode.dataset).track?n.track=o.track:n.key=o.key+o.octave),Math.abs(t)>1e-4&&(n.when=s.data.when+t),e[s.id]=n}}),Object.assign(gsuiGridSamples.prototype,{_deletionStarted(e){this._deletionObj=e?{}:this._bcUnselectAll(),e&&this._deletionPush(e)},_deletionPush(e){e&&(this._deletionObj[e]=null,this._bcDelete(e))},_deletionEnd(){this._callOnchange(this._deletionObj),delete this._deletionObj}}),Object.assign(gsuiGridSamples.prototype,{_selectionStarting(e,t,i){Math.max(Math.abs(t),Math.abs(i))>6&&(this._mdTrack=this._mmTrack=this._findTrack(e.pageY),this._selectionCalc(e.pageX),this._elSelection.classList.remove("hidden"),this._selectionIsStarted=!0,delete this._selectionIsStarting)},_selectionStarted(e){this._mmTrack=this._findTrack(e.pageY),this._selectionCalc(e.pageX)},_selectionCalc(e){var t=this._mdTrack,i=this._mmTrack,s=this._getMouseBeat(e),o=this._mdBeat;2&t.compareDocumentPosition(i)&&(t=i,i=this._mdTrack),this._selectionDraw(t,i,Math.min(s,o),Math.max(s,o))},_selectionDraw(e,t,i,s){if(e!==this._selectionTrkA||t!==this._selectionTrkB||i!==this._selectionBeatA||s!==this._selectionBeatB){var o=this._elSelection.style,n=e.getBoundingClientRect().top;this._selectionBeatA=i,this._selectionBeatB=s,this._selectionTrkA=e,this._selectionTrkB=t,o.left=(i-this._timeOffset)*this._pxPerBeat+"px",o.width=(s-i)*this._pxPerBeat+"px",o.top=n-this._elGridCntBCR.top-this._contentY*this._fontSize+"px",o.height=t.getBoundingClientRect().bottom-n+"px",this._selectionSelect()}},_selectionSelect(e,t,i,s){var o,n,a,r,l=this._selectionTrkA,c=this._selectionTrkB,u=this._selectionBeatA,h=this._selectionBeatB,d=this._bcAll,p=this._bcSelected;this._selectionList=[];for(o in d)n=d[o],p[o]||((a=u<n.data.when+n.data.duration&&n.data.when<h)&&(a=2&(r=n.rootElement.compareDocumentPosition(l))||8&r)&&(a=4&(r=n.rootElement.compareDocumentPosition(c))||8&r),a&&this._selectionList.push(n),n.select(a))},_selectionEnd(){this._selectionIsStarted&&(this._elSelection.classList.add("hidden"),delete this._selectionTrkA,delete this._selectionTrkB,delete this._selectionIsStarted,this._selectionList.length>0&&this.onchange(this._selectionList.reduce((e,t)=>(this._bcSelected[t.id]=t,e[t.id]={selected:!0},e),{}))),delete this._selectionIsStarting}}),gsuiKeys.keyIds={b:11,"a#":10,a:9,"g#":8,g:7,"f#":6,f:5,e:4,"d#":3,d:2,"c#":1,c:0},gsuiKeys.prototype={remove(){this.rootElement.remove(),this.rowElements.forEach(function(e){e.remove()}),this.rowElements.length=0},octaves(e,t){var i,s=this.rootElement,o=t-this._nbOct;if((o||this._octStart!==e)&&(this._octStart=e,s.style.counterReset="octave "+(e+t)),o){if(o>0){for(;o-- >0;)s.append(document.importNode(gsuiKeys.octaveTemplate.content,!0));i=12*this._nbOct,this.newRowElements=s.querySelectorAll(".gsui-row"),this.newRowElements.forEach(function(e){e.remove(),e.dataset.rowid=i++}),Array.prototype.push.apply(this.rowElements,this.newRowElements)}else for(o*=12;o<0;++o)s.lastChild.remove(),this.rowElements[this.rowElements.length-1].remove(),this.rowElements.pop();this._nbOct=t}},keyToIndex(e){var t=e.substr(0,"#"!==e[1]?1:2);return 12*e.substr(t.length)+gsuiKeys.keyIds[t]-12*this._octStart},_init(){gsuiKeys.octaveTemplate||(gsuiKeys.octaveTemplate=document.getElementById("gsuiKeys-octave"),document.body.addEventListener("mousemove",function(e){gsuiKeys._focused&&gsuiKeys._focused._evmmRoot(e)}),document.body.addEventListener("mouseup",function(e){gsuiKeys._focused&&gsuiKeys._focused._evmuRoot(e)}))},_isBlack:e=>1===e||3===e||5===e||8===e||10===e,_keydown(e){var t=this._nlKeys[e];t&&(this._keyup(),this._keyInd=e,this._elKey=t,this._octNum=this._octStart+this._nbOct-1-~~(e/12),t.classList.add("gsui-active"),this.onkeydown&&this.onkeydown(t.dataset.key,this._octNum,this._gain))},_keyup(){this._elKey&&(this._elKey.classList.remove("gsui-active"),this.onkeyup&&this.onkeyup(this._elKey.dataset.key,this._octNum,this._gain))},_evmdRoot(e){if(this._nbOct){var t=this.rootElement.childNodes[1].getBoundingClientRect();this._rootTop=this.rootElement.getBoundingClientRect().top,this._blackKeyR=t.right,this._blackKeyH=t.height,this._gain=Math.min(e.layerX/(e.target.clientWidth-1),1),gsuiKeys._focused=this,this._evmmRoot(e)}},_evmuRoot(e){this._keyup(),delete this._elKey,delete this._keyInd,delete gsuiKeys._focused},_evmmRoot(e){var t=(e.clientY-this._rootTop)/this._blackKeyH,i=~~t;e.clientX>this._blackKeyR&&this._isBlack(~~(i%12))&&(i+=t-i<.5?-1:1),this._keyInd!==i&&this._keydown(i)}},gsuiPanels.bodyEventsInit=function(){document.body.addEventListener("mousemove",function(e){gsuiPanels._focused&&gsuiPanels._focused._onmousemove(e)}),document.body.addEventListener("mouseup",function(e){gsuiPanels._focused&&gsuiPanels._focused._onmouseup(e)}),delete gsuiPanels.bodyEventsInit},gsuiPanels.prototype={init(e){e.style.overflow="hidden",e.querySelectorAll(".gsuiPanels-extend").forEach(e=>e.remove()),e.classList.contains("gsuiPanels-x")?this._convertFlex("width",e):e.classList.contains("gsuiPanels-y")&&this._convertFlex("height",e),e.querySelectorAll(".gsuiPanels-x").forEach(this._convertFlex.bind(this,"width")),e.querySelectorAll(".gsuiPanels-y").forEach(this._convertFlex.bind(this,"height")),e.querySelectorAll(".gsuiPanels-x > div + div").forEach(this._addExtend.bind(this,"width")),e.querySelectorAll(".gsuiPanels-y > div + div").forEach(this._addExtend.bind(this,"height"))},_convertFlex(e,t){var i=Array.from(t.children),s=t.getBoundingClientRect()[e],o=i.map(t=>t.getBoundingClientRect()[e]);i.forEach(function(t,i){t.style[e]=o[i]/s*100+"%",t.style.flex="none"}),i[i.length-1].style.flex=1},_addExtend(e,t){var i=document.createElement("div"),s=t.parentNode,o=Array.from(s.children),n=o.filter(function(e){return!e.classList.contains("gsuiPanels-extend")&&t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING}).reverse(),a=o.filter(function(e){return!e.classList.contains("gsuiPanels-extend")&&(t===e||t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)});i.className="gsuiPanels-extend",i.onmousedown=this._onmousedownExtend.bind(this,e,i,n,a),t.append(i)},_incrSizePans(e,t,i){var s=this._parentSize;return i.reduce(function(t,i){if(Math.abs(t)>.1){var o=getComputedStyle(i),n=i.getBoundingClientRect()[e],a=parseFloat(o["min-"+e])||10,r=parseFloat(o["max-"+e])||1/0,l=Math.max(a,Math.min(n+t,r));Math.abs(l-n)>=.1&&(i.style.flex="none",i.style[e]=l/s*100+"%",t-=l-n,i.onresizing&&i.onresizing(i))}return t},t)},_onmouseup(){this._extend.classList.remove("gsui-hover"),this.rootElement.classList.remove("gsuiPanels-noselect"),this._panAfter[this._panAfter.length-1].style.flex=1,delete gsuiPanels._focused},_onmousemove(e){var t=this._dir,i=("width"===t?e.pageX:e.pageY)-this._pageN;i-=this._incrSizePans(t,i,this._panBefore),Math.abs(i)>.1&&this._incrSizePans(t,-i,this._panAfter),this._pageN+=i},_onmousedownExtend(e,t,i,s,o){gsuiPanels._focused=this,t.classList.add("gsui-hover"),this.rootElement.classList.add("gsuiPanels-noselect"),this._dir=e,this._extend=t,this._pageN="width"===e?o.pageX:o.pageY,this._panBefore=i,this._panAfter=s,this._parent=t.parentNode.parentNode,this._parentSize=this._parent.getBoundingClientRect()[e]}},window.gsuiPopup={alert:(e,t)=>(gsuiPopup._init(),gsuiPopup._emptyCnt(),gsuiPopup._open("alert",e,t)),confirm:(e,t)=>(gsuiPopup._init(),gsuiPopup._emptyCnt(),gsuiPopup._open("confirm",e,t)),prompt:(e,t,i)=>(gsuiPopup._init(),gsuiPopup._emptyCnt(),gsuiPopup._open("prompt",e,t,i)),custom(e,t,i){var s;return gsuiPopup._init(),gsuiPopup._emptyCnt(),gsuiPopup._fnSubmit=i,s=gsuiPopup.elCnt,t.length?s.append.apply(s,t):s.append(t),gsuiPopup._open("custom",e)},close(){gsuiPopup.isOpen&&gsuiPopup.elCancel.click()},_emptyCnt(){for(var e=gsuiPopup.elCnt;e.firstChild;)e.firstChild.remove()},_init(){var e,t=gsuiPopup;t._ready||(e=t.elRoot=document.getElementById("gsuiPopup"),t.elWindow=e.querySelector("#gsuipp-window"),t.elHeader=e.querySelector("#gsuipp-head"),t.elCnt=e.querySelector("#gsuipp-cnt"),t.elMsg=e.querySelector("#gsuipp-msg"),t.elText=e.querySelector("#gsuipp-inpText"),t.elCancel=e.querySelector("#gsuipp-inpCancel"),t.elOk=e.querySelector("#gsuipp-inpOk"),t.elForm=e.querySelector("form"),e.onclick=t.elCancel.onclick=t._cancelClick,t.elForm.onsubmit=t._submit,t.elText.onkeypress=t.elText.onkeydown=t.elText.onkeyup=t.elWindow.onclick=function(e){e.stopPropagation()},t.elWindow.onkeydown=function(e){27===e.keyCode&&t._cancelClick(),e.stopPropagation()},t._ready=!0)},_open(e,t,i,s){var o=gsuiPopup;return o.isOpen=!0,o.elHeader.textContent=t,o.elMsg.innerHTML=i||"",o.elText.value=arguments.length>3?s:"",o.elWindow.dataset.gsuiType=o.type=e,o.elWindow.classList.toggle("gsui-nocancel","prompt"!==e&&"confirm"!==e),o.elWindow.classList.toggle("gsui-notext","prompt"!==e),o.elRoot.classList.add("gsui-show"),setTimeout(function(){"prompt"===e?o.elText.select():o.elOk.focus()},250),new Promise(function(e){o.resolve=e}).then(function(e){return o.isOpen=!1,o.elRoot.classList.remove("gsui-show"),e})},_cancelClick(){gsuiPopup.resolve("confirm"!==gsuiPopup.type&&("prompt"===gsuiPopup.type?null:void 0))},_submit:e=>("custom"===gsuiPopup.type&&gsuiPopup._fnSubmit&&gsuiPopup._fnSubmit(e),gsuiPopup.resolve("confirm"===gsuiPopup.type||("prompt"===gsuiPopup.type?gsuiPopup.elText.value:void 0)),!1)},window.SVGURL="http://www.w3.org/2000/svg",gsuiRectMatrix.prototype={remove(){this.empty(),this.rootElement.remove()},empty(){for(var e=this.rootElement;e.childNodes.length;)e.lastChild.remove()},setResolution(e,t){this.width=e,this.height=t,this.rootElement.setAttribute("viewBox","0 0 "+e+" "+t)},render(e,t,i){var s,o,n,a,r=this.width,l=this.height/e.nbRows,c=this.rootElement;t=t||0,i=i||e.duration,a=r/i,this.empty(),e.samples.forEach(function(e){o=(e.when-t)*a,n=e.duration*a,o+n>0&&o<r&&((s=document.createElementNS(SVGURL,"rect")).setAttribute("x",o+"px"),s.setAttribute("width",n+"px"),s.setAttribute("y",e.row*l+"px"),s.setAttribute("height",l+"px"),c.append(s))})}},gsuiSlider.prototype={options(e){var t=this._elInput,i=this.rootElement.classList;this._circ="circular"===e.type,this._axeX="linear-x"===e.type,this._options=e=Object.assign({},e),e.step=Math.max(0,e.step)||(e.max-e.min)/10,e.scrollStep=Math.max(e.step,e.scrollStep||e.step),e.startFrom=Math.max(e.min,Math.min(e.startFrom||0,e.max)),t.min=e.min,t.max=e.max,t.step=e.step,t.value=e.value,this._circ?(i.remove("gsui-linear","gsui-x","gsui-y"),i.add("gsui-circular")):(i.remove("gsui-circular","gsui-x","gsui-y"),i.add("gsui-linear",this._axeX?"gsui-x":"gsui-y")),this._updateVal()},setValue(e,t){var i=this._elInput,s=i.value;i.value=e,i.value!==s&&(this._updateVal(),t&&this.oninput&&this.oninput(+i.value))},resized(){var e=this.rootElement.getBoundingClientRect();this.resize(e.width,e.height)},resize(e,t){if(this.rootElement.style.width=e+"px",this.rootElement.style.height=t+"px",e!==this.width||t!==this.height){this._axeX;var i=Math.min(e,t),s=i/2,o=~~(i/10),n=~~((i-o)/2);this.width=e,this.height=t,this._circ&&(this._elSvg.setAttribute("viewBox","0 0 "+i+" "+i),this._elSvgLine.setAttribute("cx",s),this._elSvgLine.setAttribute("cy",s),this._elSvgLine.setAttribute("r",n),this._elSvgLineColor.setAttribute("cx",s),this._elSvgLineColor.setAttribute("cy",s),this._elSvgLineColor.setAttribute("r",n),this._elSvgLine.style.strokeWidth=this._elSvgLineColor.style.strokeWidth=o,this._svgLineLen=2*n*Math.PI),this._updateVal()}},_clone(){var e=document.createElement("div");return gsuiSlider.template=gsuiSlider.template||this._init(),e.appendChild(document.importNode(gsuiSlider.template.content,!0)),e.removeChild(e.querySelector("*"))},_init:()=>(document.body.addEventListener("mousemove",function(e){gsuiSlider._focused&&gsuiSlider._focused._mousemove(e)}),document.body.addEventListener("mouseup",function(e){gsuiSlider._focused&&gsuiSlider._focused._mouseup(e)}),document.getElementById("gsuiSlider")),_updateVal(){if(this.value=+this._elInput.value,this.rootElement.parentNode){var e,t=this._options,i=t.max-t.min,s=(this.value-t.min)/i,o=(t.startFrom-t.min)/i,n=Math.abs(s-o),a=Math.min(s,o);this._circ?((e=this._elSvgLineColor.style).strokeDasharray=n*this._svgLineLen+", 999999",e.transform="rotate("+(90+360*a)+"deg)"):(e=this._elLineColor.style,this._axeX?(e.left=100*a+"%",e.width=100*n+"%"):(e.bottom=100*a+"%",e.height=100*n+"%"))}},_wheel(e){var t=e.deltaY>0?-1:1;return this.setValue(+this._elInput.value+this._options.scrollStep*t,!0),!1},_mousedown(e){var t=this._options,i=this._elLine.getBoundingClientRect(),s=this._circ?this._svgLineLen:this._axeX?i.width:i.height;this._prval=this._elInput.value,this._pxval=(t.max-t.min)/s,this._pxmoved=0,gsuiSlider._focused=this,this.rootElement.requestPointerLock()},_mouseup(e){document.exitPointerLock(),delete gsuiSlider._focused,this._prval!==this._elInput.value&&this.onchange&&this.onchange(+this._elInput.value)},_mousemove(e){var t=this._options,i=this._circ||!this._axeX?-e.movementY:e.movementX,s=(t.max-t.min)/5,o=+this._prval+(this._pxmoved+i)*this._pxval;t.min-s<o&&o<t.max+s&&(this._pxmoved+=i),this.setValue(o,!0)}},gsuiSpanEditable.prototype={setValue(e,t){(e=e?e.trim():"")!==this.value&&(this.value=e,this.rootElement.classList.toggle("gsui-empty",!e),this.span.textContent=e||this.placeholder,t&&this.onchange&&this.onchange(e))},setPlaceholder(e){this.placeholder=e.trim(),this.value||(this.span.textContent=this.placeholder)},_clone(){var e=document.createElement("div"),t=gsuiSpanEditable.template;return gsuiSpanEditable.template=t=t||document.getElementById("gsuiSpanEditable"),e.appendChild(document.importNode(t.content,!0)),e.removeChild(e.querySelector("*"))},_dblclick(e){this.input.value=this.value,this.rootElement.classList.add("gsui-editing"),this.input.focus(),this.input.select()},_blur(e){this._esc||(this.setValue(e.target.value,!0),this.rootElement.classList.remove("gsui-editing")),this._esc=!1},_keydown(e){e.stopPropagation(),13!==e.keyCode&&27!==e.keyCode||(this._esc=27===e.keyCode,this._esc||this.setValue(e.target.value,!0),this.rootElement.classList.remove("gsui-editing"))}},gsuiTimeLine.prototype={resized(){var e=this.rootElement.getBoundingClientRect();this.width=e.width,this.height=e.height},currentTime(e,t){this._currentTime=e,this._updateTime(t),t&&this.onchangeCurrentTime&&this.onchangeCurrentTime(e)},offset(e,t){this._offset=Math.max(0,+e||0),this._pxPerBeat=+t,this._render()},timeSignature(e,t){this._beatsPerMeasure=Math.max(1,~~e),this._stepsPerBeat=Math.min(Math.max(1,~~t),16),this._render()},loop(e,t,i){var s,o,n,a=this._loop;!1===e?this._loop=e:(this._loopA=Math.max(0,Math.min(e,t)),this._loopB=Math.max(0,e,t)),o=this._round(this._loopA),n=this._round(this._loopB),this._loop=n-o>1/this._stepsPerBeat/8,i?this.oninputLoop&&(a&&this._loop&&(s=this._serialAB(o,n)),a===this._loop&&this._loopSerialInp===s||(this._loopSerialInp=s,this.oninputLoop(this._loop,o,n))):(this._loopWas=this._loop,this._loopSerial=this._serialAB(this._loopAWas=o,this._loopBWas=n)),this._updateLoop()},_clone(){var e=document.createElement("div");return gsuiTimeLine.template=gsuiTimeLine.template||this._init(),e.appendChild(document.importNode(gsuiTimeLine.template.content,!0)),e.removeChild(e.querySelector("*"))},_init:()=>(document.body.addEventListener("mousemove",function(e){gsuiTimeLine._focused&&gsuiTimeLine._focused._mousemove(e)}),document.body.addEventListener("mouseup",function(e){gsuiTimeLine._focused&&gsuiTimeLine._focused._mouseup(e)}),document.getElementById("gsuiTimeLine")),_round(e){if(this.stepRound){var t=1/this._stepsPerBeat*this.stepRound;e=Math.round(e/t)*t}return e},_layerX(e){return e.pageX-this.rootElement.getBoundingClientRect().left},_serialAB:(e,t)=>e.toFixed(4)+" "+t.toFixed(4),_mousemove(e){if(this._lock){var t=this._lockA,i=this._lockB,s=this._loopA,o=this._loopB,n=e.movementX/this._pxPerBeat;t||i?(t?s+=n:o+=n,s>o&&(this._lockA=i,this._lockB=t,this._elLoopBrdACL.toggle("gsui-hover",i),this._elLoopBrdBCL.toggle("gsui-hover",t))):(s+n<0&&(n=-s),s+=n,o+=n),this.loop(s,o,!0)}},_mouseup(e){var t,i=this._loop,s=this._round(this._loopA),o=this._round(this._loopB);this._loopA=s,this._loopB=o,this._lock=this._lockA=this._lockB=!1,this._elLoopBgCL.remove("gsui-hover"),this._elLoopBrdACL.remove("gsui-hover"),this._elLoopBrdBCL.remove("gsui-hover"),delete gsuiTimeLine._focused,this.onchangeLoop&&(i?(t=this._serialAB(s,o),this._loopWas===this._loop&&this._loopSerial===t||(this._loopSerial=t,this.onchangeLoop(this._loopWas=i,this._loopAWas=s,this._loopBWas=o))):this._loopWas&&this.onchangeLoop(this._loopWas=i,this._loopAWas,this._loopBWas))},_mousedownTime(e){this.currentTime(this._round(this._offset+this._layerX(e)/this._pxPerBeat),!0)},_mousemoveTime(e){var t=this._layerX(e)/this.width*100;this._elTimeLine.style.backgroundImage="linear-gradient(90deg,transparent "+(t-15)+"%,currentColor "+t+"%,transparent "+(t+15)+"%)"},_mousedownLoop(e){this._lock=!0,this._lockA="a"===e,this._lockB="b"===e,this._elLoopBgCL.toggle("gsui-hover","ab"===e),this._elLoopBrdACL.toggle("gsui-hover",this._lockA),this._elLoopBrdBCL.toggle("gsui-hover",this._lockB),gsuiTimeLine._focused=this},_mousedownLoopLine(e){var t=Date.now(),i=this._offset+this._layerX(e)/this._pxPerBeat;!this._loopClick||t-this._loopClick>500?this._loopClick=t:(this.loop(!1,0,!0),this.loop(i,i,!0),this._mousedownLoop("b"))},_updateTime(e){this._elTime.classList.toggle("gsui-trans",!!e),this._elTime.style.left=(this._currentTime-this._offset)*this._pxPerBeat+"px"},_updateLoop(){var e=this._elLoop.style;if(this._loop){var t=this._pxPerBeat,i=this._offset,s=this._round(this._loopA),o=this._round(this._loopB);e.left=(s-i)*t+"px",e.right=this.width-(o-i)*t+"px"}e.display=this._loop?"block":"none"},_render(){var e,t,i=this.rootElement.classList,s=this._steps,o=this._pxPerBeat,n=this._stepsPerBeat,a=n*this._beatsPerMeasure,r=o/n,l=1/n,c=0,u=Math.ceil(this.width/r+2),h=(this.width,~~(this._offset*n)),d=-this._offset%l;for(i.remove("gsui-step","gsui-beat","gsui-measure"),i.add("gsui-"+(o>24?o>72?"step":"beat":"measure"));s.length<u;)t=document.createElement("div"),s.push(t);for(;c<u;++c)e=h%n,(t=s[c]).style.left=d*o+"px",t.className="gsui-"+(h%a?e?"step":"beat":"measure"),t.textContent="gsui-step"!==t.className?~~(1+h/n):".",t.parentNode||this.rootElement.append(t),++h,d+=l;for(;c<s.length&&(t=s[c]).parentNode;++c)t.remove();this._updateTime(),this._updateLoop()}},gsuiToggle.prototype={check(){this._set(!0)},uncheck(){this._set(!1)},toggle(e){this._set(arguments.length?!!e:!this.checked)},_clone(){var e=document.createElement("div");return gsuiToggle.template=gsuiToggle.template||document.getElementById("gsuiToggle"),e.appendChild(document.importNode(gsuiToggle.template.content,!0)),e.removeChild(e.querySelector("*"))},_set(e,t){e!==this.checked&&(this.checked=e,this._circCL.toggle("gsui-on",e),t&&this.onchange&&this.onchange(e))},_mousedown(e){0===e.button?this._set(!this.checked,!0):2===e.button&&this.onmousedownright&&this.onmousedownright()}},gsuiTrack.prototype={remove(){this.rootElement.remove(),this.rowElement.remove()},change(e){"toggle"in e&&this.toggle(e.toggle),"name"in e&&this.name(e.name)},toggle(e){this._evocToggle(e,!1)},name(e){this._evocSpan(e,!1)},setPlaceholder(e){this.uiSpan.setPlaceholder(e)},_clone(){var e=document.createElement("div");return gsuiTrack.template=gsuiTrack.template||document.getElementById("gsuiTrack"),e.appendChild(document.importNode(gsuiTrack.template.content,!0)),e.removeChild(e.querySelector("*"))},_evocToggle(e,t){this.rootElement.classList.toggle("gsui-mute",!e),this.rowElement.classList.toggle("gsui-mute",!e),!1===t?this.uiToggle.toggle(e):this.onchange({toggle:e}),this.data.toggle=e},_evocSpan(e,t){!1===t?this.uiSpan.setValue(e):this.onchange({name:e}),this.data.name=e}},gsuiTrackList.prototype={remove(){this.empty(),this.rootElement.remove()},empty(){for(var e in this._uiTracks)this._delTrack(e)},change(e){var t,i=[];this.newRowElements=[];for(t in e)i.push({id:t,obj:e[t]});i.sort(function(e,t){return e.obj.order>t.obj.order}),i.forEach(function({id:e,obj:t}){t?(this.data[e]||this._newTrack(e),this._uiTracks[e].change(t)):this._delTrack(e)},this)},_clone(){var e=document.createElement("div");return gsuiTrackList.template||this._init(),e.appendChild(document.importNode(gsuiTrackList.template.content,!0)),e.removeChild(e.querySelector("*"))},_init(){gsuiTrackList.template=document.getElementById("gsuiTrackList")},_newTrack(e){var t=new gsuiTrack;t.uiToggle.onmousedownright=this._muteAll.bind(this,e),t.onchange=this._evocTrack.bind(this,e),t.setPlaceholder("Track "+(this.rootElement.childNodes.length+1)),t.rootElement.dataset.track=t.rowElement.dataset.track=e,this.data[e]=t.data,this._uiTracks[e]=t,this.rootElement.append(t.rootElement),this.newRowElements.push(t.rowElement)},_delTrack(e){this._uiTracks[e].remove(),delete this._uiTracks[e],delete this.data[e]},_evocTrack(e,t){this.onchange({[e]:t})},_muteAll(e){var t,i,s={},o=this._uiTracks,n=o[e],a=!0;for(e in o)if((t=o[e]).data.toggle&&t!==n){a=!1;break}for(e in o)t=o[e],(i=a||t===n)!==t.data.toggle&&(t.toggle(i),s[e]={toggle:i});this.onchange(s)}},window.SVGURL="http://www.w3.org/2000/svg",gsuiWave.sine=function(e){return Math.sin(e)},gsuiWave.square=function(e){return Math.sin(e)>0?1:-1},gsuiWave.sawtooth=function(e){return 2*((e/=2*Math.PI)-Math.floor(e+.5))},gsuiWave.triangle=function(e){return 2*Math.abs(gsuiWave.sawtooth(e+Math.PI/2))-1},gsuiWave.prototype={setResolution(e,t){this.width=e,this.height=t,this.rootElement.setAttribute("viewBox","0 0 "+e+" "+t)},draw(){for(var e=0,t=this.width,i=this.height/2,s=-this.amplitude*i,o=t*this.attack,n=2*Math.PI/t*this.frequency,a=gsuiWave[this.type],r=new Float32Array(2*t);e<t;++e)r[2*e]=e,r[2*e+1]=i+a(e*n)*s*(e<o?e/o:1);this.polyline.setAttribute("points",r.join(" "))}},function(){function e(e,t){for(var i=0,s=0,o=e.length+t.length,n=new Float32Array(o);i<o;)n[i++]=e[s],n[i++]=t[s++];return n}function t(e,t,i){for(var s=0;s<i.length;++s)e.setUint8(t+s,i.charCodeAt(s))}function i(e,t,i){for(var s,o=0;o<i.length;++o,t+=2)s=Math.max(-1,Math.min(i[o],1)),e.setInt16(t,s<0?32768*s:32767*s,!0)}function s(e,t,i){for(var s=0;s<i.length;++s,t+=4)e.setFloat32(t,i[s],!0)}window.gswaEncodeWAV=function(o,n){var a=o.numberOfChannels,r=o.sampleRate,l=n&&n.float32?3:1,c=3===l?32:16,u=c/8,h=a*u,d=2===a?e(o.getChannelData(0),o.getChannelData(1)):o.getChannelData(0),p=d.length*u,m=new ArrayBuffer(44+p),g=new DataView(m);return t(g,0,"RIFF"),g.setUint32(4,36+p,!0),t(g,8,"WAVE"),t(g,12,"fmt "),g.setUint32(16,16,!0),g.setUint16(20,l,!0),g.setUint16(22,a,!0),g.setUint32(24,r,!0),g.setUint32(28,r*h,!0),g.setUint16(32,h,!0),g.setUint16(34,c,!0),t(g,36,"data"),g.setUint32(40,p,!0),(1===l?i:s)(g,44,d),m}}(),gswaScheduler.prototype={setContext(e){this.ctx=e},setBPM(e){this.bps=e/60,this._updateDur()},setData(e){this.data=e,this._updateDur()},currentTime(){var e=this._currentTime();return this._loop&&e>this._loopB*this.bps?this._loopA*this.bps+(e-this._loopB*this.bps)%(this._loopDur*this.bps):e},stop(){this.started&&(this._loop?clearInterval(this._timeID):clearTimeout(this._timeID),delete this._loop,this.onstop&&this._smps.forEach(this.onstop),this._onended())},startBeat(e,t,i,s,o){return this.start(this.ctx.currentTime+(null==e?0:e/this.bps),null==t?0:t/this.bps,null==i?null:i/this.bps,null==s?null:s/this.bps,null==o?null:o/this.bps)},start(e,t,i,s,o){if(e=e||this.ctx.currentTime,t=t||0,i=Number.isFinite(i)?i:this.duration-t,this.started=!0,this._startedWhen=e,this._startedOffset=t,this._loop=Number.isFinite(s),this._loop){var n=o-s;this._loopA=s,this._loopDur=n,this._loopB=o,this._whenLoopStop=o-this._startedOffset+this._startedWhen,this._scheduleLoop(s,n),this._timeID=setInterval(this._scheduleLoop.bind(this,s,n),1e3),i=o-t}else this._timeID=setTimeout(this._onended.bind(this),1e3*i);this._start(e,t,i)},_start(e,t,i){this._smps=[],this.data.forEach(s=>{var o=this._sWhn(s)-t,n=this._sOff(s),a=this._sDur(s),r=o+a;o<0&&(n-=o,a+=o,o=0),r>i&&(a-=r-i),a>0&&(this._smps.push(s),this.onstart(s,e+o,n,a))})},_currentTime(){return this.started?(this.ctx.currentTime-this._startedWhen+this._startedOffset)*this.bps:0},_updateDur(){this.duration=this.data.reduce((e,t)=>Math.max(e,this._sWhn(t)+this._sDur(t)),0)},_scheduleLoop(e,t){for(;this._whenLoopStop<this.ctx.currentTime+2;)this._start(this._whenLoopStop,e,t),this._whenLoopStop+=t},_sWhn(e){return"whenBeat"in e?e.whenBeat/this.bps:e.when},_sOff(e){return"offsetBeat"in e?e.offsetBeat/this.bps:e.offset||0},_sDur(e){return"durationBeat"in e?e.durationBeat/this.bps:e.duration},_onended(){delete this.started,delete this._smps,this.onended&&this.onended(this.data)}},window.gswaSynth=function(){this.data={},this.simplePlayStack=[],this._currId=0},gswaSynth.prototype={setContext(e){this.ctx=e},connect(e){this.connectedTo=e;for(var t in this.nodeStack)this.nodeStack[t].connect(e)},disconnect(){this.connectedTo=null;for(var e in this.nodeStack)this.nodeStack[e].disconnect()},simpleStart(e){var t,i,s;for(i in this.data.oscillators)t=this.data.oscillators[i],(s=this._newOscNode(e,t.type,t.detune,t.gain))&&(this.simplePlayStack.push(s),s.start(0))},start(e,t,i,s){var o,n,a;for(n in this.data.oscillators)o=this.data.oscillators[n],(a=this._newOscNode(e,o.type,o.detune,o.gain))&&(a._when=t,a._duration=s,a._key=e,o.nodeStack[this._currId]=a,a.onended=this._removeOscNode.bind(this,o,this._currId),++this._currId,++o.nodeStackLength,a.start(t||0),arguments.length>3&&a.stop(t+s))},stop(){var e,t,i,s=this.data.oscillators;this.simplePlayStack.forEach(function(e){e.stop()}),this.simplePlayStack.length=0;for(t in s){e=s[t].nodeStack;for(i in e)e[i].stop()}},change(e){var t,i,s=this.data;for(t in s.oscillators){i=s[t];break}for(t in e.oscillators){var o=e.oscillators[t];i&&t in s.oscillators?o?this._updateOscillator(o,s.oscillators[t]):this._deleteOscillator(o,s.oscillators[t]):this._createOscillator(i,o,t)}},_newOscNode(e,t,i,s){var o=this.ctx.createOscillator();return o.frequency.value=gswaSynth.keyToHz[e],o.type=t,o.detune.value=i,o.connect(s),s.connect(this.connectedTo),o},_removeOscNode(e,t){delete e.nodeStack[t],--e.nodeStackLength},_createOscillator(e,t,i){var s,o;if(t&&("oscillators"in this.data||(this.data.oscillators={}),s=this.data.oscillators[i]={type:t.type,detune:t.detune,gain:this.ctx.createGain(),nodeStack:{},nodeStackLength:0},t.gainValue&&(s.gain.gain.value=s.gainValue=t.gainValue),e&&0!=e.nodeStackLength))for(nodeId in e.nodeStack)oscNodeSrc=e.nodeStack[nodeId],o=this._newOscNode(oscNodeSrc.key,e.type,e.detune,s.gain),s.nodeStack.push(o),s.nodeStackLength++,s.onended=this._removeOscNode.bind(this,o,i),s._when=oscNodeSrc._when,s._duration=oscNodeSrc._duration,o.start(s._when),oscNode.stop(s._when+s._duration)},_updateOscillator(e,t){t.type=e.type,t.detune=e.detune,t.gainValue=t.gain.gain.value=e.gainValue;for(nodeId in t.nodeStack)t.nodeStack[nodeId].type=t.type,t.nodeStack[nodeId].detune.value=t.detune},_deleteOscillator(e){for(nodeId in e.nodeStack)e.nodeStack[nodeId].stop();e=void 0}},gswaSynth.keyToHz={A0:27.5,"A#0":29.1353,B0:30.8677,C1:32.7032,"C#1":34.6479,D1:36.7081,"D#1":38.8909,E1:41.2035,F1:43.6536,"F#1":46.2493,G1:48.9995,"G#1":51.913,A1:55,"A#1":58.2705,B1:61.7354,C2:65.4064,"C#2":69.2957,D2:73.4162,"D#2":77.7817,E2:82.4069,F2:87.3071,"F#2":92.4986,G2:97.9989,"G#2":103.826,A2:110,"A#2":116.541,B2:123.471,C3:130.813,"C#3":138.591,D3:146.832,"D#3":155.563,E3:164.814,F3:174.614,"F#3":184.997,G3:195.998,"G#3":207.652,A3:220,"A#3":233.082,B3:246.942,C4:261.626,"C#4":277.183,D4:293.665,"D#4":311.127,E4:329.628,F4:349.228,"F#4":369.994,G4:391.995,"G#4":415.305,A4:440,"A#4":466.164,B4:493.883,C5:523.251,"C#5":554.365,D5:587.33,"D#5":622.254,"F#5":739.989,E5:659.255,F5:698.456,G5:783.991,"G#5":830.609,A5:880,"A#5":932.328,B5:987.767,C6:1046.5,"C#6":1108.73,D6:1174.66,"D#6":1244.51,E6:1318.51,F6:1396.91,"F#6":1479.98,G6:1567.98,"G#6":1661.22,A6:1760,"A#6":1864.66,B6:1975.53,C7:2093,"C#7":2217.46,D7:2349.32,"D#7":2489.02,E7:2637.02,F7:2793.83,"F#7":2959.96,G7:3135.96,"G#7":3322.44,A7:3520,"A#7":3729.31,B7:3951.07,C8:4186.01},window.common={},window.gs={},window.wa={},window.ui={},window.dom={},window.env={version:"0.11.0",def_appGain:1,def_bpm:120,def_beatsPerMeasure:4,def_stepsPerBeat:4,def_nbTracks:21,sampleRate:44100,clockSteps:!1,audioFileExt:["mp3","wav","ogg"]},common.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},common.smallId_i=0,common.smallId=function(){var e="i"+common.smallId_i.toString(16);return++common.smallId_i,e},common.smallIdParse=function(e){return parseInt(e.substr(1),16)},common.trim2=function(e){return e.trim().replace(/\s+/g," ")},common.nameUnique=function(e,t){var i,s,o;return e=common.trim2(e),t.indexOf(e)>-1?(/\(\d+\)$/.test(e)&&(e=e.substr(0,e.lastIndexOf("(")).trim()),i=new RegExp("^"+e+" \\((\\d+)\\)$"),o=t.reduce(function(e,t){return(s=i.exec(t))?Math.max(e,+s[1]):e},1),`${e} (${o+1})`):e},common.time={beatToMin:(e,t)=>~~(e/t),beatToSec:(e,t)=>common.time._padZero(60*e/t%60),beatToBeat:e=>""+~~(e+1),beatToStep:(e,t)=>common.time._padZero(e%1*t+1),beatToMStep:(e,t)=>common.time._getMil(e%1*t),secToMin:e=>""+~~(e/60),secToSec:e=>common.time._padZero(e%60),secToMs:e=>common.time._getMil(e),_getMil:e=>((e=~~(1e3*e%1e3))<10?"00":e<100?"0":"")+e,_padZero:e=>(e<10?"0":"")+~~e},common.composeUndo=function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){var i,s={};for(i in t)e[i]!==t[i]&&(s[i]=common.composeUndo(e[i],t[i]));return s}return e},common.assignDeep=function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){var i,s;for(i in t)null!=(s=common.assignDeep(e[i],t[i]))?e[i]=s:delete e[i];return e}return t},gs.init=function(){gs.history=[],gs.historyInd=0,gs.currCmp=null,gs.currCmpSaved=!0,gs.controls.init(),gs.localStorage.getAll().forEach(function(e){ui.cmps.push(e.id),ui.cmps.update(e.id,e)})},gs.undo=function(){if(gs.historyInd>0){var e=gs.history[--gs.historyInd],t=gs.history[gs.historyInd-1];gs.currCmpSaved=!!(t?t.saved:!gs.historyActionSaved&&(gs.currCmp.savedAt||localStorage[gs.currCmp.id])),gs.changeComposition(e.undo),ui.history.undo(e),ui.cmps.saved(gs.currCmpSaved)}},gs.redo=function(){if(gs.historyInd<gs.history.length){var e=gs.history[gs.historyInd++];gs.currCmpSaved=!!e.saved,gs.changeComposition(e.redo),ui.history.redo(e),ui.cmps.saved(gs.currCmpSaved)}},gs.localStorage={put(e,t){localStorage[e]=JSON.stringify(t)},delete(e){delete localStorage[e]},get(e){try{var t=JSON.parse(localStorage[e]);return e===t.id&&t.stepsPerBeat?t:null}catch(e){return null}},getAll(){var e,t,i=[];for(e in localStorage)(t=gs.localStorage.get(e))&&i.push(t);return i.sort(function(e,t){return e.savedAt<t.savedAt}),i}},gs.changeSettings=function(e){"clockSteps"in e&&(env.clockSteps=e.clockSteps,ui.controls.switchClock())},gs.loadComposition=function(e){return gs.unloadComposition().then(function(){var t,i=gs.localStorage.get(e.id);common.smallId_i=gs.getMaxCompositionInnerId(e)+1,gs.currCmp=e,gs.currCmpSaved=!(!e.savedAt||!i||i.savedAt!==e.savedAt),null!=e.savedAt&&i||(ui.cmps.push(e.id),ui.cmps.update(e.id,e));for(t in e.patterns)ui.patterns.change(t,e.patterns[t]),gs.updatePatternContent(t);ui.controls.currentTime("main",0),ui.controls.currentTime("pattern",0),ui.controls.bpm(e.bpm),ui.mainGrid.empty(),ui.mainGridSamples.timeSignature(e.beatsPerMeasure,e.stepsPerBeat),ui.keysGridSamples.timeSignature(e.beatsPerMeasure,e.stepsPerBeat),ui.mainGrid.change(e),ui.cmps.load(e.id),ui.cmps.saved(!gs.isCompositionNeedSave()),e.patternOpened&&gs.openPattern(e.patternOpened)},function(){})},gs.loadNewComposition=function(){for(var e=0,t={};e<env.def_nbTracks;++e)t[common.smallId()]={order:e,toggle:!0,name:""};return gs.loadComposition({id:common.uuid(),bpm:env.def_bpm,stepsPerBeat:env.def_stepsPerBeat,beatsPerMeasure:env.def_beatsPerMeasure,name:"",duration:0,tracks:t,patterns:{},blocks:{},keys:{}}).then(function(){gs.openPattern(gs.newPattern(!1))},console.log.bind(console)),!1},gs.loadCompositionById=function(e){var t=gs.localStorage.get(e);return t?gs.loadComposition(t):gs.loadNewComposition(),!1},gs.loadCompositionByBlob=function(e){return new Promise(function(t,i){var s,o=new FileReader;o.onload=function(){try{s=JSON.parse(o.result)}catch(e){return void i()}gs.loadComposition(s).then(t,i)},o.readAsText(e)})},gs.loadCompositionByURL=function(e){return fetch(e).then(e=>e.json()).then(gs.loadComposition,console.log.bind(console))},gs.exportCompositionToJSON=function(e){var t='\t"keys": {',i=JSON.stringify(e,null,"\t").split(t),s=i[0],o=i[1];return gs._blobDL&&URL.revokeObjectURL(gs._blobDL),s=s.replace(/\n\t{3}/g," "),s=s.replace(/\n\t{2}}/g," }"),o=o.replace(/\n\t{4}/g," "),o=o.replace(/\n\t{3}}/g," }"),gs._blobDL=URL.createObjectURL(new Blob([s+t+o]))},gs.exportCurrentCompositionToWAV=function(){gs.currCmp;return gs._blobDL&&URL.revokeObjectURL(gs._blobDL),wa.toggleRender(!0),wa.grids.play("main",0),wa.ctx.startRendering().then(function(e){return wa.toggleRender(!1),gs._blobDL=URL.createObjectURL(new Blob([gswaEncodeWAV(e,{float32:!0})]))}).catch(console.error.bind(console))},gs.getMaxCompositionInnerId=function(e){var t=Object.keys(e.keys);return Object.keys(e.patterns).concat(t,t.reduce(function(t,i){return t.concat(Object.keys(e.keys[i]))},[]),Object.keys(e.blocks),Object.keys(e.tracks)).reduce(function(e,t){return Math.max(e,common.smallIdParse(t))},0)},gs.pushCompositionChange=function(e){var t={redo:e,undo:common.composeUndo(gs.currCmp,e)};gs.historyInd<gs.history.length&&(gs.history.length=gs.historyInd,ui.history.cut(gs.historyInd)),gs.historyInd=gs.history.push(t),gs.currCmpSaved=!1,gs.changeComposition(e),ui.history.push(t),ui.cmps.saved(!1)},gs.changeComposition=function(e){var t,i,s,o,n=gs.currCmp,a=0,r=n.duration,l=e.beatsPerMeasure,c=e.stepsPerBeat;common.assignDeep(n,e),ui.mainGrid.change(e);for(i in e.patterns)ui.patterns.change(i,e.patterns[i]),wa.patterns.change(i,e.patterns[i]);for(t in e.keys)for(i in n.patterns)if(n.patterns[i].keys===t){gs.updatePatternContent(i),i===n.patternOpened&&ui.keysGridSamples.change(e.keys[t]);break}if(e.bpm&&ui.controls.bpm(e.bpm),l||c){ui.mainGridSamples.timeSignature(n.beatsPerMeasure,n.stepsPerBeat),ui.keysGridSamples.timeSignature(n.beatsPerMeasure,n.stepsPerBeat);for(i in n.patterns)gs.updatePatternContent(i)}for(s in n.blocks)o=n.blocks[s],a=Math.max(a,o.when+o.duration);n.duration=a,(null!=e.name||e.bpm||Math.ceil(a)!==Math.ceil(r))&&ui.cmps.update(n.id,n),wa.grids.replay()},gs.unloadComposition=function(){return new Promise(function(e,t){gs.currCmp?gs.currCmpSaved||!gs.history.length?gs._unloadCmp(!0,e,t):gsuiPopup.confirm("Warning","Are you sure you want to discard the unsaved change ?").then(function(i){gs._unloadCmp(i,e,t)}):e()})},gs._unloadCmp=function(e,t,i){var s,o=gs.currCmp;e&&(gs.currCmpSaved=!0,(s=gs.localStorage.get(o.id))?(ui.cmps.saved(!0),ui.cmps.update(o.id,s)):ui.cmps.remove(o.id)),gs.currCmpSaved?(gs.historyInd=0,gs.history.length=0,ui.history.cut(0),ui.controls.currentTime("main",0),ui.controls.currentTime("pattern",0),ui.cmps.unload(),ui.mainGrid.empty(),ui.patterns.empty(),ui.pattern.empty(),gs.currCmp=null,t()):i()},gs.deleteComposition=function(e){var t,i=e===gs.currCmp.id;gs.localStorage.delete(e),ui.cmps.remove(e),i&&(gs.currCmpSaved=!0,(t=gs.localStorage.getAll()[0])?gs.loadCompositionById(t.id):gs.loadNewComposition())},gs.isCompositionNeedSave=function(){return!gs.currCmpSaved&&(gs.currCmp.savedAt||gs.history.length)},gs.saveCurrentComposition=function(){return gs.currCmpSaved?Promise.resolve():new Promise(function(e,t){var i=gs.currCmp;i.savedAt=~~(Date.now()/1e3),gs.localStorage.put(i.id,i),gs.historyActionSaved&&delete gs.historyActionSaved.saved,(gs.historyActionSaved=gs.history[gs.historyInd-1])&&(gs.historyActionSaved.saved=!0),gs.currCmpSaved=!0,ui.cmps.saved(!0),e()})},gs.controls={init(){gs.controls.status="stopped",gs.controls.times={main:0,pattern:0},gs.controls.loopA={},gs.controls.loopB={},gs.controls._grid="main"},currentTime(e,t){if(null==t)return gs.controls.times[e];gs.controls.times[e]=t,ui.controls.currentTime(e,t),wa.grids.replay(t)},loop(e,t,i,s){gs.controls.loopA[e]=t?i:null,gs.controls.loopB[e]=t?s:null,ui.controls.loop(e,t,i,s),wa.grids.replay()},play(){"playing"!==gs.controls.status&&(gs.controls.status="playing",wa.grids.play(gs.controls._grid,gs.controls.times[gs.controls._grid]),ui.controls.play(),gs.controls._loopOn())},pause(){"playing"===gs.controls.status&&(gs.controls.status="paused",gs.controls.times[gs.controls._grid]=wa.grids.currentTime(),wa.grids.stop(),ui.controls.pause(),gs.controls._loopOff())},stop(){if("stopped"===gs.controls.status)gs.controls.currentTime(gs.controls._grid,0);else switch(gs.controls.status="stopped",wa.grids.stop(),ui.controls.stop(),gs.controls._loopOff(),gs.controls.currentTime(gs.controls._grid,gs.controls.loopA[gs.controls._grid]||0),document.activeElement){case ui.mainGridSamples.rootElement:gs.controls.focusOn("main");break;case ui.keysGridSamples.rootElement:gs.controls.focusOn("pattern")}},focusOn(e){e!==gs.controls._grid&&("playing"===gs.controls.status&&(gs.controls.times[gs.controls._grid]=wa.grids.currentTime()),gs.controls._grid=e,ui.controls.focusOn(e),ui.controls.clock(gs.controls.currentTime(e)),wa.grids.replay(gs.controls.times[e]))},askFocusOn(e){"playing"!==gs.controls.status&&gs.controls._grid!==e&&gs.controls.focusOn(e)},_loopOn(){gs.controls._loop()},_loopOff(){cancelAnimationFrame(gs.controls._frameId)},_loop(){ui.controls.currentTime(gs.controls._grid,wa.grids.currentTime()),gs.controls._frameId=requestAnimationFrame(gs.controls._loop)}},gs.newPattern=function(e){var t=common.smallId(),i=common.smallId();return(!1===e?gs.changeComposition:gs.pushCompositionChange)({keys:{[t]:{}},patterns:{[i]:{name:gs.namePattern("pat"),type:"keys",keys:t,duration:gs.currCmp.beatsPerMeasure}}}),i},gs.openPattern=function(e){var t=gs.currCmp,i=t.patterns[e];t.patternOpened=e,gs.controls.focusOn("pattern"),wa.grids.replay(),ui.patterns.select(e),ui.pattern.name(i.name),ui.pattern.load(t.keys[i.keys])},gs.clonePattern=function(e){var t={},i=common.smallId(),s=gs.currCmp,o=s.patterns[e],n=s.keys[o.keys];Object.keys(n).forEach(function(e){t[common.smallId()]=Object.assign({},n[e])}),gs.pushCompositionChange({keys:{[i]:t},patterns:{[common.smallId()]:{type:"keys",keys:i,name:gs.namePattern(o.name),duration:o.duration}}})},gs.removePattern=function(e){var t,i,s=gs.currCmp.blocks,o={},n={keys:{[gs.currCmp.patterns[e].keys]:null},patterns:{[e]:null}};for(t in s)s[t].pattern===e&&(o[t]=null,i=!0);i&&(n.blocks=o),gs.pushCompositionChange(n)},gs.namePattern=function(e){var t=gs.currCmp.patterns,i=Object.keys(t).map(function(e){return t[e].name});return common.nameUnique(e,i)},gs.dropPattern=function(e,t,i){var s=gs.currCmp;gs.pushCompositionChange({blocks:{[common.smallId()]:{pattern:e,track:t,when:i,offset:0,duration:s.patterns[e].duration}}})},gs.updatePatternContent=function(e){var t,i,s,o=gs.currCmp.patterns[e],n=ui.keysToRects(gs.currCmp.keys[o.keys]),a=n.duration;if(o.duration!==a){o.duration=a,t=gs.currCmp.blocks;for(s in t)(i=t[s]).pattern!==e||i.durationEdited||(i.duration=a)}ui.patterns.updateContent(e,n)},gs.addAudioFiles=function(e){console.log("addAudioFiles(), files: ",e),e.forEach(function(e){})},wa.init=function(){gswaSynth.assignDeep=common.assignDeep,wa.ctx=new AudioContext,wa.synth=new gswaSynth,wa.destination.init(wa.ctx),wa.patterns.init(),wa.synth.setContext(wa.ctx),wa.synth.connect(wa.ctx.destination),wa.synth.change({oscillators:{osc1:{type:"sine",detune:0}}})},wa.blocksToScheduleData=function(e){var t,i=gs.currCmp,s=i.tracks;return Object.keys(e).reduce(function(o,n){return(n=e[n]).track&&!s[n.track].toggle||(t=i.patterns[n.pattern],o.push({keys:gs.currCmp.keys[t.keys],whenBeat:n.when,offsetBeat:n.offset,durationBeat:n.duration})),o},[])},wa.destination={init(e){this._ctx=e,this._appGain=e.createGain(),this._appGain.gain.value=env.def_appGain,this._appGain.connect(e.destination)},get(){return wa.ctx===this._ctx?this._appGain:wa.ctx.destination},gain(e){this._appGain.gain.value=e}},wa.grids={currentTime(){if(wa._scheduler)return wa._scheduler.currentTime()},stop(){wa._synth&&(delete wa._scheduler.onended,wa._scheduler.stop(),wa._synth.stop(),delete wa._synth,delete wa._scheduler)},replay(e){"playing"===gs.controls.status&&(e=null!=e?e:wa.grids.currentTime(),wa.grids.stop(),wa.grids.play(gs.controls._grid,e))},play(e,t){var i=gs.currCmp,s=new gswaSynth,o=new gswaScheduler;wa._synth=s,wa._scheduler=o,o.onstart=wa.grids._onstartBlock,o.onstop=wa.grids._onstopBlock,o.onended=wa.grids._onendedBlocks,o.setContext(wa.ctx),s.setContext(wa.ctx),s.connect(wa.destination.get()),s.change({oscillators:{osc1:{type:"sine",detune:0}}}),o.setData("main"===e?wa.blocksToScheduleData(i.blocks):wa.blocksToScheduleData({_:{pattern:i.patternOpened,when:0,offset:0,duration:i.patterns[i.patternOpened].duration}})),o.setBPM(i.bpm),wa.rendering?o.startBeat(0):o.startBeat(0,t,null,gs.controls.loopA[e],gs.controls.loopB[e]),o.setBPM(i.bpm)},_onstartKey(e,t,i,s){wa._synth.start(e.key,t,i,s)},_onstartBlock(e,t,i,s){var o=new gswaScheduler;e.scheduler=o,o.onstart=wa.grids._onstartKey,o.setContext(wa.ctx),o.setData(wa.keysToScheduleData(e.keys)),o.setBPM(gs.currCmp.bpm),o.start(t,i,s)},_onstopBlock(e){e.scheduler.stop()},_onendedBlocks(e){gs.controls.stop()}},wa.keysToScheduleData=function(e){return Object.keys(e).map(function(t){return t=e[t],{key:t.key.toUpperCase(),whenBeat:t.when,offsetBeat:t.offset,durationBeat:t.duration}})},wa.patterns={init(){wa.patterns.list={}},change(e,t){t?wa.patterns.list[e]?wa.patterns._update(e,t):wa.patterns._add(e,t):wa.patterns._remove(e)},stop(){wa.synth.stop()},play(e){var t,i,s=gs.currCmp,o=s.keys[s.patterns[e].keys],n=s.bpm/60;for(t in o)i=o[t],wa.synth.start(i.key.toUpperCase(),wa.ctx.currentTime+i.when/n,0,i.duration/n)},_add(e,t){},_update(e,t){},_remove(e){}},wa.toggleRender=function(e){if(e){var t=gs.currCmp;wa.rendering=!0,wa._savedCtx=wa.ctx,wa.ctx=new OfflineAudioContext(2,~~Math.max(t.duration/(t.bpm/60)*env.sampleRate,100),env.sampleRate)}else wa.ctx=wa._savedCtx,delete wa._savedCtx,delete wa.rendering},ui.init=function(){var e;new gsuiPanels(document.querySelector("#app"));gsuiGridSamples.getNewId=common.smallId,document.querySelectorAll("div[data-panel]").forEach(function(t){(e=document.getElementById(t.dataset.panel))&&e.append.apply(e,t.children)}),document.querySelectorAll("[id]").forEach(function(e){dom[e.id]=e}),dom.version.textContent=env.version,dom["pan-rightside"].onresizing=function(){ui.mainGridSamples.resized(),ui.keysGridSamples.resized()},dom["pan-pianoroll"].onresizing=function(){ui.keysGridSamples.resized()},ui.cmps.init(),ui.history.init(),ui.patterns.init(),ui.controls.init(),ui.mainGrid.init(),ui.synth.init(),ui.pattern.init(),ui.openPopup.init(),ui.settingsPopup.init(),ui.shortcutsPopup.init(),ui.windowEvents(),window.onresize()},ui.keysToRects=function(e){var t,i,s,o,n=1/0,a=-1/0,r=0,l=[],c=gs.currCmp;for(t in e)i=e[t],s=ui.keysGridSamples.uiKeys.keyToIndex(i.key),n=Math.min(n,s),a=Math.max(a,s),r=Math.max(r,i.when+i.duration),l.push({row:s,when:i.when,duration:i.duration});return n-=n%12,a+=11-a%12,o=a-n,l.forEach(function(e){e.row=o-(e.row-n)}),{nbRows:o+1,samples:l,duration:Math.max(1,Math.ceil(r/c.beatsPerMeasure))*c.beatsPerMeasure}},ui.windowEvents=function(){window.onresize=function(){dom["pan-rightside"].onresizing()},window.onbeforeunload=function(){if(gs.isCompositionNeedSave())return"Data unsaved"},window.onkeydown=function(e){var t=!0;if(e.altKey)switch(e.keyCode){case 79:ui.openPopup.show();break;case 83:gs.saveCurrentComposition();break;case 90:e.shiftKey?gs.redo():gs.undo();break;case 78:gs.loadNewComposition();break;default:t=!1}else switch(e.keyCode){case 32:"playing"===gs.controls.status?gs.controls.stop():gs.controls.play();break;default:t=!1}t&&e.preventDefault()},document.body.onclick=function(e){ui.cmps._hideMenu()},document.body.ondrop=function(e){var t,i=Array.from(e.dataTransfer.files).filter(function(e){var i=e.name.substr(e.name.lastIndexOf(".")+1).toLowerCase();return"gs"!==i&&"txt"!==i&&"json"!==i||(t=e),env.audioFileExt.indexOf(i)>-1});return t?gs.loadCompositionByBlob(t).then(gs.addAudioFiles.bind(null,i),function(){}):gs.addAudioFiles(i),!1},document.body.ondragover=function(){return!1}},ui.history={init(){dom.undo.onclick=gs.undo,dom.redo.onclick=gs.redo},undo(e){e._html.classList.add("undone")},redo(e){e._html.classList.remove("undone")},cut(e){for(var t=dom.history.childNodes;e<t.length;)t[t.length-1].remove()},push(e){var t=document.createElement("div"),i=document.createElement("span"),s=document.createElement("span"),o=ui.history._nameAction(e);e._html=t,t.className="action",i.className="actionIcon icon ico-"+o.i,s.className="actionText",s.textContent=o.t,t.append(i,s),t.onclick=ui.history._onclick,dom.history.append(t),dom.history.scrollTop=1e7},_onclick(e){var t=e.target,i=t.classList.contains("action")?t:t.parentNode,s=Array.from(dom.history.childNodes).lastIndexOf(i)-gs.historyInd+1;if(s<0)for(;s++<0;)gs.undo();else if(s>0)for(;s-- >0;)gs.redo()},_nameAction(e){var t=gs.currCmp,i=e.redo,s=e.undo;return ui.history.__pattern(t,i,s)||ui.history.__tracks(t,i,s)||ui.history.__blocks(t,i,s)||ui.history.__keys(t,i,s)||(null!=i.name?{i:"name",t:`Name: "${i.name}"`}:i.bpm?{i:"clock",t:`BPM: ${i.bpm}`}:i.beatsPerMeasure||i.stepsPerBeat?{i:"clock",t:`Time signature: ${t.beatsPerMeasure}/${t.stepsPerBeat}`}:{i:"",t:""})},__blocks(e,t,i){var s,o,n,a=t.blocks;for(s in a){if(n=Object.keys(a),o=" "+n.length+" block"+(n.length>1?"s":""),!(a=a[s]))return{i:"erase",t:"Remove"+o};if(!i.blocks[s])return{i:"paint",t:"Add"+o};if("duration"in a)return{i:"crop",t:"Crop"+o};if("when"in a||"track"in a)return{i:"move",t:"Move"+o};if("selected"in a)return a.selected?{i:"selection ico--plus",t:"Select"+o}:{i:"selection ico--minus",t:"Unselect"+o}}},__tracks(e,t,i){var s,o=0,n=t.tracks;if(n){for(s in n){if(n[s].name)return{i:"name",t:`Name track: "${i.tracks[s].name}" -> "${n[s].name}"`};if(o++)break}return o>1?{i:"unmute",t:`Un/mute several tracks`}:{i:n[s].toggle?"unmute":"mute",t:(n[s].toggle?"Unmute":"Mute")+` "${e.tracks[s].name}" track`}}},__pattern(e,t,i){var s,o,n;for(s in t.patterns){if(o=t.patterns[s],n=i.patterns[s],!o||!n)return o?{i:"add",t:`New pattern "${o.name}"`}:{i:"remove",t:`Remove pattern "${n.name}"`};if("name"in o)return{i:"name",t:`${n.name}: rename to "${o.name}"`}}},__keys(e,t,i){var s,o,n,a,r,l;for(o in t.keys){s=t.keys[o];for(n in s)return a=Object.keys(s),l=e.patterns[e.patternOpened].name+": ",r=" "+a.length+" key"+(a.length>1?"s":""),!(s=s[n])&&{i:"erase",t:l+"remove"+r}||!i.keys[o][n]&&{i:"paint",t:l+"add"+r}||"duration"in s&&{i:"crop",t:l+"crop"+r}||("when"in s||"key"in s)&&{i:"move",t:l+"move"+r}||"selected"in s&&(s.selected?{i:"selection ico--plus",t:l+"select"+r}:{i:"selection ico--minus",t:l+"unselect"+r})}}},ui.controls={init(){var e=new gsuiSlider;dom.togglePlay.onclick=ui.controls._onclickTogglePlay,dom.play.onclick=ui.controls._onclickPlay,dom.stop.onclick=ui.controls._onclickStop,e.oninput=(e=>wa.destination.gain(e*e)),e.options({type:"linear-y",min:0,max:1.5,step:.01,scrollStep:.1,value:1,startFrom:0}),dom.appGainWrap.append(e.rootElement),e.resized()},focusOn(e){dom.togglePlay.classList.toggle("after","main"!==e),dom.mainGridWrap.classList.toggle("focus","main"===e),dom.keysGridWrap.classList.toggle("focus","pattern"===e),("main"===e?ui.mainGridSamples:ui.keysGridSamples).rootElement.focus()},play(){dom.play.classList.add("ico-pause")},pause(){dom.play.classList.remove("ico-pause")},stop(){ui.controls.pause()},bpm(e){dom.bpmNumber.textContent=e},currentTime(e,t){gs.controls._grid===e&&ui.controls.clock(t),"main"===e?ui.mainGridSamples.currentTime(t):ui.keysGridSamples.currentTime(t)},loop(e,t,i,s){"main"===e?ui.mainGridSamples.loop(t&&i,s):ui.keysGridSamples.loop(t&&i,s)},switchClock(){ui.controls.clock(ui.controls._beat)},clock(e){ui.controls._beat=e,(env.clockSteps?ui.controls._clockBeat:ui.controls._clockSec)(e)},title(e){document.title=(gs.isCompositionNeedSave()?"*":"")+(e||"GridSound")},_clockSec(e){e=60*e/gs.currCmp.bpm,dom.clockMin.textContent=common.time.secToMin(e),dom.clockSec.textContent=common.time.secToSec(e),dom.clockMs.textContent=common.time.secToMs(e)},_clockBeat(e){dom.clockMin.textContent=common.time.beatToBeat(e),dom.clockSec.textContent=common.time.beatToStep(e,gs.currCmp.stepsPerBeat),dom.clockMs.textContent=common.time.beatToMStep(e,gs.currCmp.stepsPerBeat)},_onclickTogglePlay:()=>(gs.controls.focusOn("main"===gs.controls._grid?"pattern":"main"),!1),_onclickPlay:()=>("playing"===gs.controls.status?gs.controls.pause():gs.controls.play(),!1),_onclickStop:()=>(gs.controls.stop(),!1)},ui.mainGrid={init(){var e=new gsuiGridSamples,t=e.rootElement.querySelector(".gsuigs-grid .gsuigs-content");ui.mainGridSamples=e,ui.mainGrid.elGridCnt=t,ui.mainGrid.blocks={},e.loadTrackList(),e.offset(0,40),e.onchange=ui.mainGrid._onchangeGrid,e.onchangeCurrentTime=gs.controls.currentTime.bind(null,"main"),e.onchangeLoop=gs.controls.loop.bind(null,"main"),e.rootElement.onfocus=gs.controls.askFocusOn.bind(null,"main"),e.fnSampleCreate=function(e,t){var i=gs.currCmp,s=i.patterns[t.data.pattern];ui.mainGrid.blocks[e]=t,t.name(s.name),t.updateData(ui.keysToRects(i.keys[s.keys])),t.rootElement.ondblclick=gs.openPattern.bind(null,t.data.pattern)},e.fnSampleUpdate=function(e,t){var i=gs.currCmp,s=i.blocks[e],o=i.keys[i.patterns[s.pattern].keys];t.updateData(ui.keysToRects(o),s.offset,s.duration)},e.fnSampleDelete=function(e,t){delete ui.mainGrid.blocks[e]},dom.mainGridWrap.append(e.rootElement),t.ondrop=ui.mainGrid._ondrop,t.ondragenter=function(e){e.dataTransfer.dropEffect="copy"},e.resized()},empty(){ui.mainGridSamples.empty(),ui.mainGrid.blocks={}},change(e){e.tracks&&ui.mainGridSamples.change(e),e.blocks&&ui.mainGridSamples.change(e.blocks)},getPatternBlocks(e){var t,i=[],s=ui.mainGrid.blocks;for(t in s)s[t].data.pattern===e&&i.push(s[t]);return i},_onchangeGrid(e){e.tracks||(e={blocks:e}),gs.pushCompositionChange(e)},_ondrop(e){var t=e.target,i=ui.mainGridSamples,s=e.dataTransfer.getData("text"),o=i.rootElement.getBoundingClientRect(),n=e.pageX-o.left-i._panelWidth;if(s){for(e.stopPropagation();!t.classList.contains("gsui-row");)t=t.parentNode;return gs.dropPattern(e.dataTransfer.getData("text"),t.dataset.track,i.uiTimeLine._round(n/i._pxPerBeat+i._timeOffset)),!1}}},ui.cmps={init(){dom.newComposition.onclick=gs.loadNewComposition,dom.openComposition.onclick=ui.openPopup.show,dom.cmpMenu.onclick=ui.cmps._clickMenu,ui.cmps._exportTextWAV=dom.exportCompositionWAV.textContent},push(e){var t=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),n=document.createElement("div"),a=document.createElement("span"),r=document.createElement("span");t.className="cmp",i.className="save",s.className="info",o.className="menu",n.className="name",a.className="bpm",r.className="duration",s.append(n,a,r),t.append(i,s,o),i.onclick=gs.saveCurrentComposition,s.onclick=gs.loadCompositionById.bind(null,e),o.onclick=ui.cmps._showMenu.bind(null,e),ui.cmps._html[e]={root:t,name:n,bpm:a,duration:r},dom.cmps.append(t)},remove(e){var t=ui.cmps._html;t[e]&&(t[e].root.remove(),delete t[e])},update(e,t){var i=ui.cmps._html[e];i.name.textContent=t.name,ui.controls.title(t.name),i.bpm.textContent=t.bpm,i.duration.textContent=common.time.beatToMin(t.duration,t.bpm)+":"+common.time.beatToSec(t.duration,t.bpm)},load(e){var t=ui.cmps._html[e];ui.cmps._loadOne=t,t.root.classList.add("loaded"),ui.controls.title(gs.currCmp.name),dom.cmps.prepend(t.root)},saved(e){ui.controls.title(gs.currCmp.name),ui.cmps._loadOne.root.classList.toggle("notSaved",!e)},unload(){ui.cmps._loadOne.root.classList.remove("loaded"),delete ui.cmps._loadOne},_html:{},_showMenu(e,t){var i=t.target.parentNode.getBoundingClientRect();ui.cmps._cmpId=e,dom.cmpMenu.style.top=i.top+(i.bottom-i.top)/2+"px",dom.cmpMenu.classList.remove("hidden"),t.stopPropagation()},_hideMenu(){ui.cmps._cmpId&&(delete ui.cmps._cmpId,delete ui.cmps._wavReady,dom.exportCompositionWAV.textContent=ui.cmps._exportTextWAV,dom.exportCompositionWAV.download=dom.exportCompositionWAV.href="",dom.cmpMenu.classList.add("hidden"))},_clickMenu(e){var t,i=ui.cmps._cmpId,s=gs.currCmp,o=i===s.id,n=e.target,a=!0;if(e.stopPropagation(),"deleteComposition"===n.id?(s=o?s:gs.localStorage.get(i),gsuiPopup.confirm("Warning",`Are you sure you want to delete "${s.name}" ? (no undo possible)`).then(function(e){e&&gs.deleteComposition(i)})):"exportCompositionJSON"!==n.id&&"exportCompositionWAV"!==n.id||(t=(s=o?s:gs.localStorage.get(i)).name||"untitled","exportCompositionJSON"===n.id?(n.download=t+".gs",n.href=gs.exportCompositionToJSON(s)):o?(a=2===ui.cmps._wavReady,ui.cmps._wavReady||(ui.cmps._wavReady=1,n.download=t+".wav",n.textContent+=" (please wait...)",gs.exportCurrentCompositionToWAV().then(function(e){ui.cmps._wavReady=2,n.href=e,n.textContent=ui.cmps._exportTextWAV+" (re-click to download)"}))):gsuiPopup.alert("Error",`You have to open "${t}" before exporting it in WAV.`)),a&&setTimeout(ui.cmps._hideMenu,200),!n.download||1===ui.cmps._wavReady)return!1}},ui.patterns={init(){ui.patterns.audioBlocks={},dom.patNew.onclick=gs.newPattern,dom.patClone.onclick=ui.patterns._onclickClone,dom.patRemove.onclick=ui.patterns._onclickRemove,dom.patterns.oncontextmenu=ui.patterns._oncontextmenu},empty(){for(var e in ui.patterns.audioBlocks)ui.patterns._remove(e)},change(e,t){t?ui.patterns.audioBlocks[e]?ui.patterns._update(e,t):ui.patterns._add(e,t):ui.patterns._remove(e)},select(e){var t=ui.patterns._selectedPattern,i=ui.patterns.audioBlocks[e];t&&t.rootElement.classList.remove("selected"),ui.patterns._selectedPattern=i,i.rootElement.classList.add("selected")},updateContent(e,t){ui.patterns.audioBlocks[e].updateData(t),ui.mainGrid.getPatternBlocks(e).forEach(function(e){var i=gs.currCmp.blocks[e.id];i.durationEdited||(e.duration(i.duration),e.contentWidthFixed()),e.updateData(t,i.offset,i.duration)})},_add(e,t){var i=new gsuiAudioBlock,s=i.rootElement;i.data=t,i.name(t.name),i.datatype("keys"),s._patId=e,s.setAttribute("draggable","true"),s.onclick=ui.patterns._onclickPattern.bind(null,e),s.ondblclick=ui.patterns._ondblclickPattern.bind(null,e),s.ondragstart=ui.patterns._ondragstartPattern.bind(null,e),ui.patterns.audioBlocks[e]=i,dom.patterns.prepend(s),gs.openPattern(e)},_remove(e){var t,i=ui.patterns.audioBlocks[e].rootElement;e===gs.currCmp.patternOpened&&(delete gs.currCmp.patternOpened,(t=i.nextSibling||i.previousSibling)&&gs.openPattern(t._patId)),delete ui.patterns.audioBlocks[e],i.remove()},_update(e,t){if("name"in t){var i=t.name;ui.patterns.audioBlocks[e].name(i),ui.mainGrid.getPatternBlocks(e).forEach(function(e){e.name(i)}),e===gs.currCmp.patternOpened&&ui.pattern.name(i)}},_oncontextmenu:e=>(e&&e.target===dom.patterns||ui.patterns._uiBlockPlaying&&(wa.patterns.stop(),ui.patterns._uiBlockPlaying.stop(),delete ui.patterns._uiBlockPlaying),!1),_onclickClone(){gs.clonePattern(gs.currCmp.patternOpened)},_onclickRemove(){var e=gs.currCmp.patternOpened,t=ui.patterns.audioBlocks[e].rootElement;t.nextSibling||t.previousSibling?gs.removePattern(e):gsuiPopup.alert("Error","You can not delete the only pattern")},_onclickPattern(e,t){var i=ui.patterns.audioBlocks[e];ui.patterns._oncontextmenu(),ui.patterns._uiBlockPlaying=i,i.start(gs.currCmp.bpm),wa.patterns.play(e)},_ondblclickPattern(e){e!==gs.currCmp.patternOpened&&(ui.patterns._oncontextmenu(),gs.openPattern(e))},_ondragstartPattern(e,t){t.dataTransfer.setData("text",e)}},ui.pattern={init(){var e=new gsuiGridSamples;ui.keysGridSamples=e,e.loadKeys(1,7),e.offset(0,120),e.setFontSize(20),dom.keysGridWrap.append(e.rootElement),e.contentY(24),dom.pianorollName.onclick=ui.pattern._onclickName,e.onchange=ui.pattern._onchangeGrid,e.onchangeCurrentTime=gs.controls.currentTime.bind(null,"pattern"),e.onchangeLoop=gs.controls.loop.bind(null,"pattern"),e.rootElement.onfocus=gs.controls.askFocusOn.bind(null,"pattern"),e.uiKeys.onkeydown=ui.pattern._onkeydown,e.uiKeys.onkeyup=ui.pattern._onkeyup,e.resized()},empty(){ui.pattern.name(""),ui.keysGridSamples.empty()},name(e){dom.pianorollName.textContent=e},load(e){ui.keysGridSamples.empty(),ui.keysGridSamples.change(e),ui.keysGridSamples.scrollToSamples()},_onkeydown(e,t){wa.synth.simpleStart((e+t).toUpperCase())},_onkeyup(){wa.synth.stop()},_onchangeGrid(e){gs.pushCompositionChange({keys:{[gs.currCmp.patterns[gs.currCmp.patternOpened].keys]:e}})},_onclickName(){var e=gs.currCmp.patternOpened,t=gs.currCmp.patterns[e],i=prompt("Name pattern :",t.name);null!=i&&(i=i.trim())!==t.name&&gs.pushCompositionChange({patterns:{[e]:{name:i}}})}},ui.synth={init(){dom.synthOsc.remove(),dom.synthOscAdd.onclick=ui.synth._onclickAddOsc,ui.synth._oscHTML={},ui.synth.change({oscillators:{"000":{order:0,type:"sine",detune:0,pan:0,gain:1},"001":{order:1,type:"triangle",detune:-10,pan:-.3,gain:.6},"002":{order:2,type:"square",detune:10,pan:.6,gain:.3}}})},empty(){},load(e){var t=gs.currCmp.synths[e];ui.synth.id=e,ui.synth.empty(),ui.synth.name(t.name),ui.synth.change(t)},name(e){dom.synthName.textContent=e},change(e){Object.entries(e.oscillators).forEach(function([e,t]){t?this._oscHTML[e]?this._updateOsc(e,t):this._createOsc(e,t):this._deleteOsc(e)},ui.synth)},_createOsc(e,t){var i=dom.synthOsc.cloneNode(!0),s=ui.synth._initSlider.bind(null,e,t,i),o=new gsuiWave;i.removeAttribute("id"),i.querySelector(".synthOsc-curve").prepend(o.rootElement),i.querySelector(".synthOsc-remove").onclick=ui.synth._onclickRemoveOsc.bind(null,e),dom.synthOscsList.append(i),o.setResolution(150,20),o.amplitude=.5,o.frequency=3,ui.synth._oscHTML[e]={root:i,curveWave:o,curveType:i.querySelector(".synthOsc-curveValue"),detune:s({min:-100,max:100,step:.01,scrollStep:1},"detune"),gain:s({min:0,max:1,step:.01,scrollStep:.03},"gain"),pan:s({min:-1,max:1,step:.01,scrollStep:.03},"pan")},ui.synth._updateOsc(e,t)},_deleteOsc(e){ui.synth._oscHTML[e].root.remove(),delete ui.synth._oscHTML[e]},_updateOsc(e,t){var i=ui.synth._oscHTML[e];t.type&&(i.curveType.textContent=t.type,i.curveWave.type=t.type,i.curveWave.draw()),"detune"in t&&i.detune.setValue(t.detune),"gain"in t&&i.gain.setValue(t.gain),"pan"in t&&i.pan.setValue(t.pan)},_initSlider(e,t,i,s,o){var n=new gsuiSlider;return s.type="circular",s.value=t[o],n.options(s),i.querySelector(`.synthOsc-${o} .synthOsc-sliderWrap`).append(n.rootElement),n.oninput=ui.synth._oninputSlider.bind(null,e,n),n.onchange=ui.synth._onchangeSlider.bind(null,e,o),n.oninput(s.value),n.resized(),n},_onclickName(){var e=gs.currCmp.synths[ui.synth.id],t=prompt("Name synthesizer :",e.name);null!=t&&(t=t.trim())!==e.name&&gs.pushCompositionChange({synths:{[ui.synth.id]:{name:t}}})},_oninputSlider(e,t,i){t.rootElement.parentNode.previousElementSibling.textContent=i},_onchangeSlider(e,t,i){gs.pushCompositionChange({synths:{[ui.synth.id]:{oscillators:{[e]:{[t]:i}}}}})},_onclickAddOsc:()=>(gs.pushCompositionChange({synths:{[ui.synth.id]:{oscillators:{[common.uuid()]:{curve:"sine",detune:0,gain:1,pan:0}}}}}),!1),_onclickRemoveOsc:e=>(gs.pushCompositionChange({synths:{[ui.synth.id]:{oscillators:{[e]:null}}}}),!1)},ui.openPopup={init(){var e=dom.openPopupContent.querySelectorAll("input");dom.openPopupContent.remove(),ui.openPopup.inputURL=e[0],ui.openPopup.inputFile=e[1]},show:()=>(ui.openPopup.inputFile.value=ui.openPopup.inputURL.value="",gsuiPopup.custom("Open",dom.openPopupContent,ui.openPopup._onsubmit),!1),_onsubmit(){var e=ui.openPopup.inputURL.value,t=ui.openPopup.inputFile.files[0];e?gs.loadCompositionByURL(e):t&&gs.loadCompositionByBlob(t)}},ui.settingsPopup={init(){dom.settingsPopupContent.remove(),dom.settings.onclick=ui.settingsPopup.show,ui.settingsPopup.inputs=dom.settingsPopupContent.querySelectorAll("input")},show(){var e=gs.currCmp,t=ui.settingsPopup.inputs,i=dom.bpmTap;return t[+env.clockSteps].checked=!0,t[2].value=e.name,t[3].value=e.bpm,t[4].value=e.beatsPerMeasure,t[5].value=e.stepsPerBeat,i.timeBefore=0,i.bpmStack=[],i.nbBpmToAverage=10,i.onclick=ui.settingsPopup._bpmTap.bind(null,t[3],i),gsuiPopup.custom("Settings",dom.settingsPopupContent,ui.settingsPopup._onsubmit),!1},_onsubmit(){var e,t={},i={},s=gs.currCmp,o=ui.settingsPopup.inputs;o[+env.clockSteps].checked||(t.clockSteps=!env.clockSteps),(e=o[2].value)!==s.name&&(i.name=e),(e=+o[3].value)!==s.bpm&&(i.bpm=e),(e=+o[4].value)!==s.beatsPerMeasure&&(i.beatsPerMeasure=e),(e=+o[5].value)!==s.stepsPerBeat&&(i.stepsPerBeat=e);for(e in t){gs.changeSettings(t);break}for(e in i){gs.pushCompositionChange(i);break}},_bpmTap(e,t){var i=(new Date).getTime();if(t.timeBefore){var s,o=6e4/(i-t.timeBefore),n=t.bpmStack.length?t.bpmStack[t.bpmStack.length-1]:0;if(n&&(o<n/1.5||o>1.5*n))t.timeBefore=t.bpmStack.length=0,e.value="0";else{for(t.bpmStack.push(o),s=o=0;s<t.bpmStack.length&&s<t.nbBpmToAverage;++s)o+=t.bpmStack[t.bpmStack.length-1-s];e.value=Math.floor(o/s)}}return t.timeBefore=i,!1}},ui.shortcutsPopup={init(){dom.shortcutsPopupContent.remove(),dom.shortcuts.onclick=ui.shortcutsPopup.show},show:()=>(gsuiPopup.custom("Keyboard / mouse shortcuts",dom.shortcutsPopupContent),!1)},ui.init(),wa.init(),gs.init(),gs.loadNewComposition(),navigator.serviceWorker&&navigator.serviceWorker.register("serviceWorker.js",{scope:"/daw/"}).then(function(e){console.log("Service worker "+(e.installing?"installing":e.waiting?"installed":e.active?"active":""))},console.log.bind(console,"Service worker registration failed")),setTimeout(function(){fetch("https://gridsound.github.io/daw/VERSION?"+Math.random()).then(e=>e.text()).then(e=>{dom.version.classList.add(e===env.version?"ok":"ko")})},2e3),function(e,t,i,s,o,n,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,n=t.createElement(i),a=t.getElementsByTagName(i)[0],n.async=1,n.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(n,a)}(window,document,"script",0,"ga"),ga("create","UA-418864-6","auto"),ga("send","pageview");
</script></body></html>
