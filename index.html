<!DOCTYPE html><html lang='en'><head><title>GridSound</title><meta charset='UTF-8'/><meta name='viewport' content='width=device-width, user-scalable=no'/><meta name='description' content='A free and Open-Source DAW (digital audio workstation)'/><meta name='google' content='notranslate'/><meta property='og:type' content='website'/><meta property='og:title' content='GridSound (an open-source digital audio workstation)'/><meta property='og:url' content='https://gridsound.github.io/'/><meta property='og:image' content='https://gridsound.github.io/assets/og-image.jpg'/><meta property='og:image:width' content='800'/><meta property='og:image:height' content='400'/><meta name='theme-color' content='#3a5158'/><link rel='manifest' href='manifest.json'/><link rel='shortcut icon' href='assets/favicon.png'/><style>:root{--gsuiAudioBlock-color: #5ac;--gsuiAudioBlock-bg: #223;--gsuiAudioBlock-selected-color: #f88;--gsuiAudioBlock-selected-bg: #844}.gsuiAudioBlock{position:absolute;display:flex;flex-direction:column;box-sizing:border-box;overflow:hidden;top:0;height:100%;border-style:solid;border-width:0;color:var(--gsuiAudioBlock-color);cursor:default;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;transition:opacity .2s}.gsuiAudioBlock .gsuiab-bg{position:absolute;width:100%;height:100%;background-color:var(--gsuiAudioBlock-bg);opacity:.8}.gsuiAudioBlock .gsuiab-head{display:flex;position:relative;z-index:1;line-height:20px;padding:0 4px;font-size:12px;background-color:rgba(0,0,0,.4)}.gsuiAudioBlock .gsuiab-name{flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-weight:700}.gsuiAudioBlock .gsuiab-name:empty:before{content:"Untitled";font-style:italic;opacity:.6}.gsuiAudioBlock .gsuiab-content{position:relative;overflow:hidden;flex:1}.gsuiAudioBlock .gsuiab-crop{position:absolute;z-index:2;top:0;width:50%;max-width:8px;height:100%;background-color:currentColor;opacity:0;transition:opacity .2s}.gsuiAudioBlock .gsuiab-crop.hover,.gsuiAudioBlock .gsuiab-crop:hover{opacity:.3}.gsuiAudioBlock .gsuiab-cropB{right:0}.gsui-nocrop .gsuiab-crop,.gsui-noleftcrop .gsuiab-cropA{display:none!important}.gsuiAudioBlock .gsuiab-cursor{position:absolute;height:100%;width:1px;background-color:#ff0;box-shadow:-2px 0 6px 3px rgba(255,255,0,.2);animation-name:gsuiab-cursor-frames;animation-fill-mode:forwards;animation-timing-function:linear}@keyframes gsuiab-cursor-frames{0%{opacity:1;left:0}95%{opacity:1}to{opacity:0;left:100%}}.gsuiAudioBlock[data-type=key] .gsuiab-head{background-color:transparent}.gsuiAudioBlock svg{position:absolute;top:0;width:100%;height:100%;fill:currentColor}.gsui-mute .gsuiAudioBlock{opacity:.5}.gs-row-tiny .gsuiAudioBlock .gsuiab-head{display:flex;align-items:center;padding-top:0;padding-bottom:0;height:100%;background-color:transparent}.gs-row-tiny .gsuiAudioBlock .gsuiab-content{position:absolute;top:0;width:100%;height:100%;opacity:.3}.gsuiAudioBlock.gsuiab-selected{--gsuiAudioBlock-color: var( --gsuiAudioBlock-selected-color );--gsuiAudioBlock-bg: var( --gsuiAudioBlock-selected-bg )}.gs-row-tiny .gsuiAudioBlock,.gsuiAudioBlock-reversedColors,.gsuiAudioBlock[data-type=key]{color:var(--gsuiAudioBlock-bg)}.gs-row-tiny .gsuiAudioBlock .gsuiab-bg,.gsuiAudioBlock-reversedColors .gsuiab-bg,.gsuiAudioBlock[data-type=key] .gsuiab-bg{background-color:var(--gsuiAudioBlock-color)}.gsuiAudioBlock-reversedColors .gsuiab-head{background-color:rgba(255,255,255,.3)}.gsuiBeatLines{fill:#000;color:#ff5}.gsuiBeatLines rect{fill:inherit}.gsuiBeatLines .gsui-step{opacity:.2}.gsuiBeatLines .gsui-beat{opacity:.5}.gsuiBeatLines .gsui-measure{opacity:.6}.gsuiBeatLines .gsui-currentTime{fill:currentColor;stroke:currentColor;stroke-opacity:.1;stroke-width:5px}.gsuiBeatLines .gsui-hlEnd,.gsuiBeatLines .gsui-hlStart{opacity:.25}.gsuiGridSamples{--timeline-height: 32px;--panel-min-width: 24px;--panel-max-width: 320px;--grid-bg: #3a5158;--panel-bg: #3a3a3a;--border-color: #111;position:relative;width:100%;height:100%;cursor:default;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.gsuiGridSamples .gsuigs-grid,.gsuiGridSamples .gsuigs-panel{position:absolute;overflow:hidden;top:var(--timeline-height);bottom:0}.gsuiGridSamples .gsuigs-grid{right:0;border-top:1px solid var(--border-color)}.gsuiGridSamples .gsuigs-panel{box-sizing:border-box;min-width:var(--panel-min-width);max-width:var(--panel-max-width);border:0 solid var(--border-color);border-width:1px 1px 0 0;background-color:var(--panel-bg)}.gsuiGridSamples .gsuigs-extend{position:absolute;z-index:1;top:0;right:0;width:6px;height:100%;transition:background-color .2s}.gsuiGridSamples .gsuigs-extend.gsui-hover,.gsuiGridSamples .gsuigs-extend:hover{background-color:rgba(128,128,128,.5)}.gsuiGridSamples .gsuiTimeLine{position:absolute;z-index:1;height:var(--timeline-height);top:0;right:0;border-left:1px solid var(--border-color)}.gsuiGridSamples .gsuiBeatLines{position:absolute;width:100%;height:100%;background-color:var(--grid-bg)}.gsuiGridSamples .gsuigs-content,.gsuiKeys{position:relative}.gsuiGridSamples .gsuigs-grid .gsuigs-content{position:absolute;right:0}.gsuiGridSamples .gsuigs-select{position:absolute;box-sizing:border-box;margin:-1px 0 0 -1px;border:2px solid #f55;border-radius:4px;background-color:rgba(216,26,26,.3);transition:.2s;transition-property:opacity,visibility}.gsuiGridSamples .gsuigs-select.hidden{opacity:0;visibility:hidden}.gsuiKeys{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.gsuiKey,.gsuiKey-row{position:relative;box-sizing:border-box;height:1em}.gsuiKey-row[data-key$="#"]{background-color:rgba(0,0,0,.1)}.gsuiKey-row[data-key$=c],.gsuiKey-row[data-key$=f]{border-bottom:1px solid rgba(0,0,0,.2)}.gsuiKey-row>div{position:absolute;top:0;bottom:0;width:100%}.gsuiKey{height:1.5em;background-image:linear-gradient(90deg,#888,#eee);cursor:default}.gsuiKey[data-key$="#"]{position:absolute;z-index:1;width:65%;height:1em;margin-top:-.5em;border-radius:0 .1em .1em 0;background-image:linear-gradient(90deg,#111,#444)}.gsuiKey[data-key=c]{background-image:linear-gradient(90deg,#888,#ccc)}.gsuiKey[data-key=c]:after{counter-increment:octave -1;content:"C" counter(octave);position:absolute;right:.25em;bottom:0;color:#000;font-size:calc(6px + .25em);font-family:monospace}.gsuiKey.gsui-active{background-image:linear-gradient(90deg,#353b52,#7886bd)}.gsuiKey[data-key=c],.gsuiKey[data-key=f]{border-bottom:1px solid rgba(0,0,0,.2)}.gsuiKey:last-child{border-bottom:0}.gsuiKey[data-key=a],.gsuiKey[data-key=d],.gsuiKey[data-key=g]{height:2em}:root{--gsuiPanels-bd: 1px solid #222;--gsuiPanels-extendSize: 5px;--gsuiPanels-extendColor: #888}.gsuiPanels-x,.gsuiPanels-y{display:flex}.gsuiPanels-y{flex-direction:column}.gsuiPanels-x>div:not(.gsuiPanels-extend),.gsuiPanels-y>div:not(.gsuiPanels-extend){position:relative;flex:1}.gsuiPanels-x>div,.gsuiPanels-y>div{box-sizing:border-box}.gsuiPanels-x>div+div:not(.gsuiPanels-extend){border-left:var(--gsuiPanels-bd)}.gsuiPanels-y>div+div:not(.gsuiPanels-extend){border-top:var(--gsuiPanels-bd)}.gsuiPanels-noselect{user-select:none;-ms-user-select:none;-moz-user-select:none;-webkit-user-select:none}.gsuiPanels-extend{position:absolute;z-index:999;top:0;left:0;width:100%;height:100%;transition:background-color .2s}.gsuiPanels-extend.gsui-hover,.gsuiPanels-extend:hover{background-color:var(--gsuiPanels-extendColor)}.gsuiPanels-x>div>.gsuiPanels-extend{width:var(--gsuiPanels-extendSize);margin-left:calc(var(--gsuiPanels-extendSize)/-2)}.gsuiPanels-y>div>.gsuiPanels-extend{height:var(--gsuiPanels-extendSize);margin-top:calc(var(--gsuiPanels-extendSize)/-2)}#gsuiPopup{--dur: .2s;--dark-bg: rgba( 0, 0, 0, .6 );--bg: #555;--btn-bg: #999;--btn-ok-bg: #67a;--padding: 10px;--min-width: 250px;--radius: 4px;--header-bg: #333;display:flex;align-items:center;justify-content:center;position:fixed;z-index:2147483647;left:0;right:0;top:0;bottom:0;color:#fff;background-color:var(--dark-bg);visibility:hidden;opacity:0;transition:var(--dur);transition-property:visibility,opacity}#gsuiPopup.gsui-show{visibility:visible;opacity:1}#gsuipp-window{overflow:hidden;min-width:var(--min-width);border-radius:var(--radius);font-family:sans-serif;background-color:var(--bg);box-shadow:0 0 50px #000}#gsuipp-window.gsui-nocancel #gsuipp-inpCancel,#gsuipp-window.gsui-notext #gsuipp-inpText,.gsuiSlider input,.gsuiSlider.gsui-circular .gsui-line,.gsuiSlider.gsui-linear svg{display:none}#gsuipp-head{background-color:var(--header-bg)}#gsuipp-body,#gsuipp-head{padding:var(--padding)}#gsuipp-cnt:not(:empty)+#gsuipp-msg,#gsuipp-cnt:not(:empty)~input{display:none}#gsuipp-inpText{border:0;border-radius:2px;box-sizing:border-box;margin-top:var(--padding);padding:.6em;width:100%;font-size:18px}#gsuipp-btns input{padding:.6em 1.25em;border:0;border-radius:2px;color:#fff;font-weight:700;background-color:var(--btn-bg);cursor:pointer}#gsuipp-btns{margin-top:var(--padding);text-align:center}#gsuipp-btns input+input{margin-left:var(--padding)}#gsuipp-btns #gsuipp-inpOk{background-color:var(--btn-ok-bg)}#gsuipp-window input[type=text]{color:#fff;background-color:rgba(255,255,255,.1)}:root{--gsuiSlider-lineColor: #fff;--gsuiSlider-lineBgColor: #000}.gsuiSlider{position:relative;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.gsuiSlider .gsui-eventCatcher{position:absolute;top:-10px;left:-10px;right:-10px;bottom:-10px;border-radius:9999px}.gsuiSlider.gsui-x .gsui-lineColor{height:100%!important;top:0!important}.gsuiSlider.gsui-y .gsui-lineColor{width:100%!important;left:0!important}.gsuiSlider.gsui-x .gsui-thumb{bottom:50%!important}.gsuiSlider.gsui-y .gsui-thumb{left:50%!important}.gsuiSlider .gsui-line{position:absolute;left:0;right:0;top:0;bottom:0;background-color:var(--gsuiSlider-lineBgColor)}.gsuiSlider .gsui-lineColor{position:absolute;background-color:var(--gsuiSlider-lineColor)}.gsuiSlider,.gsuiSlider svg{width:100%;height:100%}.gsuiSlider .gsui-svgLine,.gsuiSlider .gsui-svgLineColor{fill:none;transform-origin:center}.gsuiSlider .gsui-svgLine{stroke:var(--gsuiSlider-lineBgColor)}.gsuiSlider .gsui-svgLineColor{stroke:var(--gsuiSlider-lineColor)}.gsuiSpanEditable{--placeholder-opacity: .3;display:flex;align-items:center;overflow:hidden;transition-duration:.2s}.gsuiSpanEditable span{display:inline-block;width:100%;color:inherit;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;min-width:1em;opacity:1;transition:opacity;transition-duration:inherit}.gsuiSpanEditable input{display:none;box-sizing:border-box;width:100%;outline:0;border:0;font-size:1em;color:inherit;background:0 0}.gsuiSpanEditable.gsui-empty span{font-style:italic;opacity:var(--placeholder-opacity)}.gsuiSpanEditable.gsui-editing span{display:none}.gsuiSpanEditable.gsui-editing input{display:block}.gsuiTimeLine{--cursor-color: #fdfd70;--cursor-dur: .1s;--loop-color: #656586;--loop-brd-color: #fff;position:relative;overflow:hidden;font:14px monospace;color:#fff;background:#222;cursor:default;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.gsuiTimeLine .gsui-loopLine{position:absolute;z-index:1;width:100%;height:100%}.gsuiTimeLine .gsui-loop{position:absolute;z-index:1;top:0;height:22%}.gsuiTimeLine .gsui-loopBg{position:absolute;width:100%;height:100%;background:var(--loop-color);transition:filter .2s}.gsuiTimeLine .gsui-loopBg.gsui-hover,.gsuiTimeLine .gsui-loopBg:hover{filter:brightness(1.2)}.gsuiTimeLine .gsui-loopExt{position:absolute;z-index:2;width:25%;min-width:5px;max-width:10px;height:250%}.gsuiTimeLine .gsui-loopA{left:-5px}.gsuiTimeLine .gsui-loopB{right:-5px}.gsuiTimeLine .gsui-loopBrd{position:absolute;z-index:0;width:2px;height:100%;background:var(--loop-color);transition:.2s;transition-property:height,background,z-index}.gsuiTimeLine .gsui-loopBrdA{left:-1px}.gsuiTimeLine .gsui-loopBrdB{right:-1px}.gsuiTimeLine .gsui-loopA:hover~.gsui-loopBrdA,.gsuiTimeLine .gsui-loopB:hover~.gsui-loopBrdB,.gsuiTimeLine .gsui-loopBrd.gsui-hover{z-index:1;height:150%;background:var(--loop-brd-color)}.gsuiTimeLine .gsui-currentTime{position:absolute;z-index:1;bottom:0;width:100%;height:50%}.gsuiTimeLine .gsui-cursorLine{position:absolute;bottom:0;width:100%;height:1px;color:var(--cursor-color);opacity:0;transition:.2s;transition-property:opacity,background}.gsuiTimeLine .gsui-currentTime:hover .gsui-cursorLine{opacity:.8}.gsuiTimeLine .gsui-cursor{position:absolute;margin-left:-10px;bottom:1px;transition:left}.gsuiTimeLine .gsui-trans{transition-duration:var(--cursor-dur)}.gsuiTimeLine .gsui-cursor polygon{fill:var(--cursor-color);stroke:var(--cursor-color);stroke-width:4;stroke-linejoin:round}.gsuiTimeLine .gsui-beat,.gsuiTimeLine .gsui-measure,.gsuiTimeLine .gsui-step{position:absolute;display:flex;top:0;bottom:0;width:4em;margin-left:-2em;align-items:center;justify-content:center}.gsuiTimeLine .gsui-measure{font-weight:700}.gsuiTimeLine .gsui-step{opacity:.2}.gsuiTimeLine .gsui-beat,.gsuiTimeLine.gsui-measure .gsui-measure{opacity:.5}.gsuiTimeLine.gsui-beat .gsui-step,.gsuiTimeLine.gsui-measure .gsui-beat,.gsuiTimeLine.gsui-measure .gsui-step{opacity:0}.gsuiToggle{--radius: 8px;--border: 1px solid rgba( 255, 255, 255, .25 );--color: #222;--color-on: #87bd42;--boxshadow: 0 2px 1px rgba( 0, 0, 0, .3 );--boxshadow-on: 0 0 10px #87bd42;--dur: .2s;position:relative;font-size:var(--radius);cursor:pointer}.gsuiToggle .gsui-circle{position:absolute;box-sizing:border-box;width:1em;height:1em;top:50%;left:50%;margin:-.5em 0 0 -.5em;border-radius:50%;border:var(--border);box-shadow:var(--boxshadow);background:var(--color);transition:var(--dur);transition-property:background,box-shadow}.gsuiToggle .gsui-on{box-shadow:var(--boxshadow-on);background:var(--color-on)}.gsuiTrack,.gsuiTrack-row{--head-bg: #444;--head-bg-mute: #393939;--body-bg-mute: rgba( 0, 0, 0, .25 );--text-color: #eee;--border-top-color: rgba( 255, 255, 255, .07 );--border-bottom-color: rgba( 0, 0, 0, .4 );box-sizing:border-box;display:flex;height:1em;border:0 solid;border-width:1px 0;border-top-color:var(--border-top-color);border-bottom-color:var(--border-bottom-color);background-color:var(--head-bg);transition:background-color .2s}.gsuiTrack-row{position:relative;display:block;background-color:transparent}.gsuiTrack-row>div{position:absolute;top:0;bottom:0;width:100%}.gsuiTrack .gsuiToggle{--radius: 6px;min-width:24px}.gsuiTrack .gsuiSpanEditable{flex:1;padding-right:10px;font-size:14px;color:var(--text-color)}.gsuiTrack.gsui-mute{background-color:var(--head-bg-mute)}.gsuiTrack-row.gsui-mute{background-color:var(--body-bg-mute)}.gsuiTrack.gsui-mute .gsuiSpanEditable{opacity:.5}.gsuiTrackList{height:100%;background:#333}@font-face{font-family:"Inconsolata";src:url(assets/inconsolata-regular.ttf)}@font-face{font-family:"Oswald";src:url(assets/oswald-regular.ttf)}@font-face{font-family:"FontAwesome";src:url(assets/fontawesome-solid-900.woff) format("woff")}@font-face{font-family:"FontAwesomeBrands";src:url(assets/fontawesome-brands-900.woff) format("woff")}.icon{position:relative;display:inline-block;font-family:"FontAwesome";font-weight:400;font-style:normal;text-align:center;text-indent:0;width:1.25em}.ico-brand{font-family:"FontAwesomeBrands"}.icon:after{position:absolute;left:10px;top:-3px;font-size:8px}.ico--plus:after{content:"\f067"}.ico--minus:after{content:"\f068"}.ico-times:before{content:"\f2d3"}.ico-caret-up:before{content:"\f0d8"}.ico-caret-down:before{content:"\f0d7"}.ico-caret-left:before{content:"\f0d9"}.ico-caret-right:before{content:"\f0da"}.ico-3dots:before{content:"\f142"}.ico-play:before{content:"\f04b"}.ico-pause:before{content:"\f04c"}.ico-stop:before{content:"\f04d"}.ico-undo:before{content:"\f2ea"}.ico-redo:before{content:"\f2f9"}.ico-mute:before{content:"\f026"}.ico-unmute:before{content:"\f028"}.ico-name:before{content:"\f040"}.ico-paint:before{content:"\f1fc"}.ico-clock:before{content:"\f017"}.ico-move:before{content:"\f0b2"}.ico-crop:before{content:"\f125"}.ico-history:before{content:"\f1da"}.ico-synth:before{content:"\f3f1"}.ico-pattern:before{content:"\f38a"}.ico-new:before{content:"\f067"}.ico-clone:before{content:"\f24d"}.ico-remove:before{content:"\f1f8"}.ico-erase:before{content:"\f12d"}.ico-param:before{content:"\f3f1"}.ico-toggle-off:before{content:"\f204"}.ico-toggle-on:before{content:"\f205"}.ico-add:before{content:"\f067"}.ico-selection:before{content:"\f245"}.ico-keyboard:before{content:"\f11c"}.ico-arrows-v:before{content:"\f338"}.ico-tint:before{content:"\f043"}.ico-cmd:before{content:"⌘";font-family:sans-serif}.ico-chrome:before{content:"\f268"}.ico-edge:before{content:"\f282"}.ico-firefox:before{content:"\f269"}.ico-iexplorer:before{content:"\f26b"}.ico-opera:before{content:"\f26a"}.ico-safari:before{content:"\f267"}.ico-patreon:before{content:"\f3d9"}.ico-facebook:before{content:"\f09a"}.ico-github:before{content:"\f09b"}.ico-twitter:before{content:"\f099"}.ico-youtube:before{content:"\f167"}.ico-pattern{transform:scale(-1,1)}body,html{height:100%;margin:0;overflow:hidden;font-family:sans-serif;background-color:#555}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background-color:#555}::-webkit-scrollbar-thumb{background-color:#888}a{color:inherit;text-decoration:none}#app{--app-bg: #555;--gsuiPanels-bd: 2px solid #222;--gsuiPanels-extendSize: 4px;--small-bd-radius: 2px;--ctrl-height: 44px;--ctrl-padding: 4px;--col1-low: #345;--col1-middle: #67a;--col1-high: #bbf;--col2-middle: #d44;--monospace: "Inconsolata", "consolas", monospace;width:100%;height:100%;overflow:hidden;background-color:var(--app-bg);user-select:none;-ms-user-select:none;-moz-user-select:none;-webkit-user-select:none}.popup{width:500px}.popup fieldset{border:2px solid #444;border-radius:4px;margin-bottom:10px}.popup legend{font-size:11px;font-weight:700;opacity:.5}.popup .param{display:flex;align-items:center;font-size:14px}.popup .param+.param{margin-top:5px}.popup .param-title{flex:1}.popup .param-values{flex:1;font-family:var(--monospace)}.popup [type=radio]:checked+label{font-weight:700}.popup input{border-radius:2px;border:0;color:inherit;font-size:inherit}.popup input::placeholder{color:#aaa;font-style:italic}.popup input[type=file],.popup input[type=number],.popup input[type=text],.popup input[type=url]{width:150px;padding:.2em .5em;font-family:inherit;background:rgba(255,255,255,.1)}.popup input[type=file]{width:200px}#settingsPopupContent fieldset:nth-child(2) .param-values{display:flex;align-items:center}#settingsPopupContent .btn{padding:.2em;margin-left:10px;border:0;border-radius:2px;font-size:inherit;background-color:rgba(255,255,255,.1)}#settingsPopupContent .btn:hover{background-color:rgba(255,255,255,.2)}#shortcutsPopupContent{width:540px}#shortcutsPopupContent .param{padding:4px}#shortcutsPopupContent .param:nth-child(even){background-color:rgba(255,255,255,.05)}#shortcutsPopupContent .param-values{max-width:190px}#shortcutsPopupContent .param-title{font-size:13px}#shortcutsPopupContent .shortcuts{display:inline-block;margin:0 6px;border-radius:4px;border-bottom:3px solid #333;padding:.3em .5em;font-weight:700;white-space:nowrap;color:#fff;background-color:#444}#shortcutsPopupContent .shortcuts .icon{width:auto}.absoluteMenu{position:absolute;z-index:2;border:2px solid #111;border-radius:4px;background-color:#333;transition:.2s;transition-property:opacity,visibility}.absoluteMenu.hidden{opacity:0;visibility:hidden}.absoluteMenu a{display:block;white-space:nowrap;font-size:13px;line-height:2em;padding:0 .5em;color:#ddd;cursor:default;transition:.2s;transition-property:color,background-color}.absoluteMenu a:hover{color:#fff;background-color:#222}#pan-leftside{min-width:250px;max-width:400px;width:300px;flex:none}#pan-maingrid,#pan-pianoroll,#pan-synth,.panel-left{display:flex;flex-direction:column}.panel-menu,.panel-title{box-sizing:border-box;padding:4px 10px;font-size:13px;border-bottom:1px solid #111}.panel-title{display:flex;align-items:center;min-height:24px;color:#222;font-weight:700;background-color:#666}.panel-title .icon{margin-right:4px}.panel-menu{color:#ddd;background-color:#505050}.panel-btn{padding:4px;font-size:14px;border-radius:2px;transition:background .2s}.panel-btn+.panel-btn{margin-left:.5em}.panel-btn:hover{background-color:rgba(0,0,0,.2)}.panel-body{flex:1;overflow:auto;background-color:#555}#pan-maingrid{min-height:150px;height:215px;flex:none}#keysGridWrap,#mainGridWrap,#synthOscs{flex:1}#mainGridWrap .gsuiTrack-row>div{top:-1px}.gsuiGridSamples{background-color:#2f2f2f}.gsuiBeatLines{transition:background-color .2s}.focus .gsuiBeatLines{background-color:#456168}#keysGridWrap .gsuiAudioBlock,#mainGridWrap .gsuiAudioBlock{border-radius:2px}#pan-cmps{min-height:114px;height:200px;flex:none;position:relative}#pan-cmps .panel-title{display:flex;align-items:baseline;height:var(--ctrl-height);padding-top:0;padding-bottom:0;color:#fff;font-weight:400;cursor:default;background-color:#444}#title:before{display:block;margin-top:3px;content:"GridSound";font-family:"Oswald";font-size:28px}#appGainWrap{width:4px;height:35px;align-self:flex-end;margin:0 0 4px auto;--gsuiSlider-lineColor: #ff9;--gsuiSlider-lineBgColor: #222}#cmpMenu{left:100%;margin-left:5px}#pan-cmps .panel-btn,.action{box-sizing:border-box;align-items:center}#pan-cmps .panel-btn{display:inline-flex;padding:0 6px;border:1px solid rgba(255,255,153,.2);border-radius:8px;transition-property:background-color;font-size:11px;color:#ff9;height:24px;transition:.5s}#pan-cmps .panel-btn::before{margin-right:4px;font-family:"FontAwesome"}#pan-cmps .panel-btn:hover{color:#505050;background-color:#ff9}#pan-cmps #newComposition{border-style:dashed}#newComposition::before{content:"\f067"}#openComposition::before{content:"\f019"}#pan-history{min-height:57px;height:65px;flex:none}.action{display:flex;cursor:default;height:28px;padding-right:.4em;color:#bbb;font-size:13px;font-family:var(--monospace);background-color:#333;transition:background-color .2s}.action+.action{border-top:1px solid #222}.action:hover{background-color:#444}.action:before{content:"";display:block;width:4px;height:100%;background-color:var(--col1-middle);transition:inherit}.action.undone:before{background-color:#000}.actionIcon{margin:0 .4em}.actionText{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition-property:opacity;transition-duration:inherit}.action:not(:hover).undone .actionIcon,.action:not(:hover).undone .actionText{opacity:.5}#synthMenu{left:100%;margin-left:5px}.pan-synth-pianoroll .pan-menu{position:relative;display:flex;align-items:center;padding:4px 6px;font-size:12px;color:#ddd;border-bottom:1px solid #111;background-color:#444}.pan-synth-pianoroll .pan-menu::before{font-style:italic;font-weight:700;font-size:11px;text-shadow:1px 1px 0 #000;opacity:.35}.pan-synth-pianoroll .pan-name{margin-left:.75em;padding:4px 8px;border-radius:4px;font-family:var(--monospace);cursor:default;transition:filter .2s}.pan-synth-pianoroll .pan-name:empty:before{content:"Untitled";font-style:italic}.pan-synth-pianoroll .pan-name:hover{color:#fff;filter:brightness(1.1)}#pan-synth{min-width:280px;max-width:400px;width:350px;flex:none}#pan-synth .pan-menu::before{content:"Synthesizer\A0:"}#synthName{background-color:#696}#synthOscs{overflow:auto;counter-reset:count-osc}#synthOscsHead{display:flex;justify-content:space-between;padding:4px 12px 4px 8px;font-size:11px;font-family:"inconsolata";color:#aaa;border-bottom:1px solid #111;background-color:#444}#synthOscsHead div{width:40px;margin-left:14px;text-align:center;text-transform:capitalize}#synthOscsHead div:first-child{width:auto;opacity:.5;margin-left:0;text-align:left}#synthOscsHeadCurve{flex:1}#synthOscAdd{display:block;margin:10px;padding:1em;border-radius:4px;font-size:12px;font-weight:700;color:var(--app-bg);text-align:center;background-color:rgba(255,255,255,.4);opacity:.3;transition:opacity .2s}#synthOscAdd:hover{opacity:.6}#pan-pianoroll .pan-menu::before{content:"Pattern\A0:"}#pianorollName,.cmp{background-color:var(--col1-middle)}#pianorollBlock{display:flex;overflow:hidden;align-items:center;justify-content:center;position:absolute;z-index:2;width:100%;height:100%;background-color:rgba(0,0,0,.7);opacity:0;visibility:hidden;transition:.2s;transition-property:opacity,visibility}#pianorollBlock.show{opacity:1;visibility:visible}#pianorollBlock::before{content:"No pattern selected...";display:block;padding:18px;border-radius:4px;font-size:12px;font-weight:700;font-style:italic;background-color:rgba(255,255,255,.1);color:#ddd}.cmp{box-sizing:border-box;display:flex;color:#bbb;font-size:12px;cursor:pointer;filter:brightness(.9)}.cmp+.cmp{border-top:1px solid rgba(0,0,0,.2)}.cmp.loaded{filter:none}.cmp .save{display:flex;overflow:hidden;align-items:center;justify-content:center;width:0;background-color:var(--col2-middle)}.cmp.notSaved .save{min-width:30px}.cmp .save:before{content:"\f0a0";font:20px "FontAwesome";color:#ddd}.cmp .info{flex:1;padding:4px;overflow:hidden;transition:padding-left .2s}.cmp .info:hover{padding-left:8px}.cmp .menu{display:flex;align-items:center;justify-content:center;min-width:20px}.cmp .menu:before{content:"\f142";font:18px "FontAwesome"}.cmp .menu:hover{color:#fff}.cmp .name{overflow:hidden;color:#ddd;font-size:13px;font-weight:700;white-space:nowrap;text-overflow:ellipsis}.cmp.notSaved .name:before{content:"*"}.cmp .name:empty:after{font-style:italic;content:"Untitled"}.cmp .bpm{margin-right:1em}.cmp .bpm:before,.cmp .duration:before{font-family:"FontAwesome";margin-right:.4em}.cmp .bpm:before{content:"\f001"}.cmp .duration:before{content:"\f017"}.synth{display:flex;flex-direction:column;color:#333;border-bottom:1px solid rgba(0,0,0,.3);background-color:#777;opacity:.9;transition:.2s;transition-property:border-bottom-color,background-color,opacity}.synth-show{opacity:1;border-bottom-width:2px;border-bottom-color:rgba(255,255,255,.1)}.synth-selected{color:#333;background-color:#696}.synth-head{display:flex;height:36px;line-height:36px;font-size:14px}.synth-head a{overflow:hidden;opacity:.5;transition:.1s;transition-property:width,color,opacity}.synth-head a:hover,.synth-show .synth-showBtn{opacity:1}.synth:not(.synth-selected) .synth-head a:hover{color:#7b7}a.synth-name{flex:1;opacity:1;overflow:hidden;padding-left:8px;white-space:nowrap;text-overflow:ellipsis;font-weight:700}.synth-name:empty::after{content:"Untitled";font-style:italic;opacity:.8}.synth-hoverBtn{width:0}.synth:hover .synth-hoverBtn{width:24px}.synth-showBtn{background-color:rgba(0,0,0,.1)}.synth-showBtn::before{display:block;transition:.2s;transition-property:transform}.synth-show .synth-showBtn::before{transform:rotate(90deg)}.synth-patterns{flex:1;overflow:auto;max-height:250px;padding-left:10px;background-color:rgba(0,0,0,.4)}.synth-patterns:empty{padding:0}.synth-patterns:empty::before{content:"This synthesizer contains no pattern";display:flex;align-items:center;justify-content:center;width:220px;height:24px;margin:-24px auto 0;border-radius:4px;font-size:11px;font-style:italic;text-align:center;white-space:nowrap;background-color:rgba(255,255,255,.1)}.synth-show .synth-patterns:empty::before{margin:4px auto}.synth-patterns .gsuiAudioBlock,.synth-patterns:empty::before{transition:.3s;transition-property:margin-top,margin-bottom}.synth-patterns .gsuiAudioBlock{position:relative;width:100%;height:64px;margin-top:-64px;border-radius:4px 0 0 4px}.synth-show .gsuiAudioBlock{margin:4px 0}.synth-patterns .gsuiAudioBlock.selected .gsuiab-head::before{content:"\f07c";font-family:"FontAwesome";margin-right:.5em}.synth-patterns .gsuiAudioBlock .gsuiab-head a{width:0;opacity:.5;overflow:hidden;transition:.1s;transition-property:width,opacity}.synth-patterns .gsuiAudioBlock:hover .gsuiab-head a{width:20px}.synth-patterns .gsuiAudioBlock .gsuiab-head a:hover{opacity:1}#controls,#version,.ctrl-item{display:flex;align-items:center}#version{margin-left:.8em;font-family:"Inconsolata";font-style:italic;opacity:.5;transition:.2s;transition-property:opacity,text-shadow}#version:hover{opacity:.8;text-shadow:0 0 10px}#version.ko{color:#f94}#version.ok{color:#8fb}#version.ko,#version.ok{font-weight:700;font-style:normal;opacity:1}#version.ko::after{content:"\f071"}#version.ok::after{content:"\f00c"}#version::after{font-size:11px;font-weight:400;font-family:"FontAwesome";margin-left:4px}#controls,.ctrl-item{box-sizing:border-box}#controls{height:var(--ctrl-height);padding:var(--ctrl-padding);border-bottom:1px solid #000;background-color:#444}.ctrl-item{justify-content:center;color:#ddd;height:100%;border-radius:var(--small-bd-radius);cursor:default;transition:filter .1s}.ctrl-item+.ctrl-item{margin-left:6px}.ctrl-item:hover{filter:brightness(1.2)}.ctrl-btn{font-size:14px;border:1px solid rgba(0,0,0,.7);min-width:calc(var(--ctrl-height) - 2*var(--ctrl-padding))}.ctrl-btn:active{padding-top:4px;box-shadow:inset 0 3px 0 rgba(0,0,0,.25)}#togglePlay{flex-direction:column;justify-content:space-between;min-width:8px;height:100%}#togglePlay::after,#togglePlay::before{box-sizing:border-box;content:"";width:100%;height:40%;border:1px solid rgba(0,0,0,.7);border-radius:2px;background-color:var(--col1-low)}#togglePlay.after::after,#togglePlay:not(.after)::before{background-color:var(--col1-middle)}#play{background-color:var(--col1-middle)}#stop{background-color:#888}#bpm,#clock{font-size:30px;font-family:var(--monospace);padding:0 .3em;border:3px solid rgba(0,0,0,.3);background-color:#222;filter:none}#bpmText:before{content:"bpm";font-size:calc(9px + .1em);margin-left:.5em;opacity:.5}#clock{align-items:baseline;line-height:1em}#clockSec:before{content:":"}#clockMs:before{content:"."}#clockMs{font-size:.5em}#settings{min-width:46px;font-family:"FontAwesome";background-color:var(--col2-middle)}#settings:before{content:"\f001";margin-right:.4em}#settings:after{content:"\f013"}#shortcuts{border:0;font-size:21px;margin-left:auto;background-color:rgba(255,255,255,.1)}#patreon{border:2px solid #f6685275;color:#f66852;font-size:20px}.synthOsc{display:flex;justify-content:space-between;position:relative;border-bottom:1px solid #111;padding:8px 12px 8px 8px;color:#ddd;background-color:#3a3a3a}.synthOsc-order{display:flex;align-items:center}.synthOsc-order::before{counter-increment:count-osc;content:counter(count-osc);font-size:11px;font-weight:700;opacity:.2}.synthOsc-attr{position:relative;width:40px;margin-left:14px}.synthOsc-sliderWrap{position:relative;width:100%;height:40px;--gsuiSlider-lineBgColor: #555}.synthOsc-sliderWrap .gsuiSlider{margin:auto}.synthOsc-detune{--gsuiSlider-lineColor: #f9f}.synthOsc-gain{--gsuiSlider-lineColor: #ff9}.synthOsc-sliderValue{position:absolute;display:flex;align-items:center;justify-content:center;top:0;width:100%;height:100%;font:10px "inconsolata";color:var(--gsuiSlider-lineColor)}.synthOsc-curve{flex:1;position:relative}.synthOsc-curve .gsuiWave,.synthOsc-curveValue{width:100%;height:100%}.synthOsc-curve .gsuiWave polyline{stroke:#fff;stroke-width:2px;stroke-opacity:.1;fill:none;transition:stroke-opacity .2s}.synthOsc-curve:hover .gsuiWave polyline{stroke-opacity:.2}.synthOsc-curveValue{position:absolute;display:flex;left:6px;top:0;align-items:center;text-transform:capitalize;text-align:center;font:12px "inconsolata";opacity:.8;transition:.2s;transition-property:color,opacity}.synthOsc-curve:hover .synthOsc-curveValue{opacity:1;color:#fff}.synthOsc-curveValue::before{content:"\f0d7\A0";font-family:"FontAwesome";opacity:.5}.synthOsc-curveSelect{width:100%;height:100%;border:0;color:inherit;font-size:12px;font-family:"inconsolata";-webkit-appearance:none;-moz-appearance:none;background:0 0}.synthOsc-curveSelect:focus{outline:0}.synthOsc-curveSelect option{background:#444}.synthOsc-remove{position:absolute;top:0;right:0;width:auto;opacity:.1;font-size:12px;transition:opacity .2s}.synthOsc:only-child .synthOsc-remove{display:none}.synthOsc-remove:hover{opacity:.8}
</style></head><body><noscript>GridSound needs JavaScript to run</noscript><div id="app" class="gsuiPanels-x"><div class="gsuiPanels-y" id="pan-leftside"><div class="panel-left" id="pan-cmps"></div><div class="panel-left" id="pan-history"></div><div class="panel-left" id="pan-patterns"></div></div><div class="gsuiPanels-y" id="pan-rightside"><div id="pan-maingrid"></div><div class="gsuiPanels-x"><div class="pan-synth-pianoroll" id="pan-synth"></div><div class="pan-synth-pianoroll" id="pan-pianoroll"></div></div></div></div><div data-panel="pan-cmps"><div class="panel-title"><div id="title"></div><a tabindex="1" id="version" aria-label="Read the changelog"href="https://github.com/gridsound/daw/wiki/changelog" target="_blank" rel="noopener"title="Click to see the changelog"></a><div id="appGainWrap" title="Main app volume (this parameter will not affect the rendering)"></div></div><div class="panel-menu"><a href id="newComposition" class="panel-btn" title="Create a new composition (Alt + N)">New</a><a href id="openComposition" class="panel-btn" title="Open a composition (Alt + O)">Open</a></div><div id="cmps" class="panel-body"></div><div id="cmpMenu" class="absoluteMenu hidden"><a href id="exportCompositionJSON">Export to JSON</a><a href id="exportCompositionWAV">Export to WAV</a><a href id="deleteComposition">Delete</a></div></div><div data-panel="pan-history"><div class="panel-title"><span class="icon ico-history"></span><span>History</span></div><div class="panel-menu"><a id="undo" class="icon ico-undo panel-btn" title="Undo the previous action (Alt + Z)"></a><a id="redo" class="icon ico-redo panel-btn" title="Redo the next action (Alt + Shift + Z)"></a></div><div id="history" class="panel-body"></div></div><div data-panel="pan-patterns"><div class="panel-title"><span class="icon ico-synth"></span><span>Synthesizers</span></div><div class="panel-menu"><a id="synthNew" class="icon ico-new panel-btn" title="Create a new synthesizer"></a></div><div id="patterns" class="panel-body gsui-nocrop"></div></div><div data-panel="pan-maingrid"><div id="controls"><a tabindex="2" href id="togglePlay" aria-label="Switch grid focus" class="ctrl-item"></a><a tabindex="3" href id="play" aria-label="Play" class="ctrl-item ctrl-btn icon ico-play"></a><a tabindex="4" href id="stop" aria-label="Stop" class="ctrl-item ctrl-btn icon ico-stop"></a><div id="clock" class="ctrl-item"><div id="clockMin"></div><div id="clockSec"></div><div id="clockMs"></div></div><div id="bpm" class="ctrl-item"><span id="bpmNumber"></span><span id="bpmText"></span></div><a tabindex="5" href id="settings" aria-label="Settings" class="ctrl-item ctrl-btn"></a><a tabindex="6" href id="shortcuts" aria-label="Shortcuts" class="ctrl-item ctrl-btn icon ico-keyboard"></a><a tabindex="7" id="patreon" aria-label="Patreon" class="ctrl-item ctrl-btn icon ico-brand ico-patreon"href="https://www.patreon.com/gridsound" target="_blank" rel="noopener"title="Visit our Patreon page"></a></div><div id="mainGridWrap"></div></div><div data-panel="pan-synth"><div class="pan-menu"><div class="pan-name" id="synthName"></div></div><div id="synthOscsHead"><div>#</div><div id="synthOscsHeadCurve">curve</div><div>detune</div><div>pan</div><div>gain</div></div><div id="synthOscs"><div id="synthOscsList"></div><a href id="synthOscAdd"><i class="icon ico-add"></i><span> New oscillator</span></a></div></div><div data-panel="pan-pianoroll"><div class="pan-menu"><div class="pan-name" id="pianorollName"></div></div><div id="keysGridWrap"></div><div id="pianorollBlock"></div></div><div class="popup" id="openPopupContent"><fieldset><legend>Open and load a new composition</legend><div class="param"><div class="param-title">With an URL</div><div class="param-values"><input type="url" placeholder="http://"/></div></div><div class="param"><div class="param-title">With a local file<br/><small>(Please notice that you can also drop a file into the app)</small></div><div class="param-values"><input type="file"/></div></div></fieldset></div><div class="popup" id="settingsPopupContent"><fieldset><legend>GridSound's DAW settings</legend><div class="param"><div class="param-title">Clock display</div><div class="param-values"><input id="radioClSec" name="clock" type="radio"/> <label for="radioClSec">min:sec.ms</label><br/><input id="radioClBeat" name="clock" type="radio"/> <label for="radioClBeat">beats:steps.milisteps</label></div></div></fieldset><fieldset><legend>Composition settings</legend><div class="param"><div class="param-title">Title</div><div class="param-values"><input type="text" placeholder="untitled"/></div></div><div class="param"><div class="param-title">BPM</div><div class="param-values"><input type="number" min="1" max="999"/><span id="bpmTap" class="btn icon ico-tint"></span></div></div><div class="param"><div class="param-title">Beats per measure</div><div class="param-values"><input type="number" min="1" max="16"/></div></div><div class="param"><div class="param-title">Steps per beat</div><div class="param-values"><input type="number" min="1" max="16"/></div></div></fieldset></div><div class="popup" id="shortcutsPopupContent"><fieldset><legend>Global shortcuts</legend><div class="param"><div class="param-title">Open a composition</div><div class="param-values"><span class="shortcuts">Alt</span>+<span class="shortcuts">O</span></div></div><div class="param"><div class="param-title">Open a new composition</div><div class="param-values"><span class="shortcuts">Alt</span>+<span class="shortcuts">N</span></div></div><div class="param"><div class="param-title">Play / pause the selected grid</div><div class="param-values"><span class="shortcuts">Space</span></div></div><div class="param"><div class="param-title">Undo the previous action</div><div class="param-values"><span class="shortcuts">Alt</span>+<span class="shortcuts">Z</span></div></div><div class="param"><div class="param-title">Redo the next action</div><div class="param-values"><span class="shortcuts">Alt</span>+<span class="shortcuts">Shift</span>+<span class="shortcuts">Z</span></div></div></fieldset><fieldset><legend>Grids shortcuts</legend><div class="param"><div class="param-title">Select all the blocks of the focused grid</div><div class="param-values"><span class="shortcuts">Alt</span>+<span class="shortcuts">A</span></div></div><div class="param"><div class="param-title">Deselect all the blocks of the focused grid</div><div class="param-values"><span class="shortcuts">Alt</span>+<span class="shortcuts">D</span></div></div><div class="param"><div class="param-title">Delete all the selected blocks of the focused grid</div><div class="param-values"><span class="shortcuts">Delete</span></div></div><div class="param"><div class="param-title">Move vertically inside the grids</div><div class="param-values"><span class="shortcuts">Scroll <i class="icon ico-arrows-v"></i></span></div></div><div class="param"><div class="param-title">Move horizontally inside the grids</div><div class="param-values"><span class="shortcuts">Shift</span>+<span class="shortcuts">Scroll <i class="icon ico-arrows-v"></i></span></div></div><div class="param"><div class="param-title">Zoom-in / zoom-out<br/>Zoom X by scrolling above the grid<br/>Zoom Y by scrolling above the keys<br/></div><div class="param-values"><span class="shortcuts">Ctrl</span>or<span class="shortcuts"><i class="icon ico-cmd"></i></span>+<span class="shortcuts">Scroll <i class="icon ico-arrows-v"></i></span></div></div></fieldset></div><div id="synth" class="synth"><div class="synth-head"><a class="synth-showBtn icon ico-caret-right"></a><a class="synth-name"></a><a class="synth-hoverBtn synth-newPatternBtn icon ico-new" title="Create a new pattern with this synthesizer"></a><a class="synth-hoverBtn synth-deleteBtn icon ico-remove" title="Delete the synthesizer and its patterns"></a></div><div class="synth-patterns"></div></div><div id="synthOsc" class="synthOsc"><div class="synthOsc-order"></div><div class="synthOsc-attr synthOsc-curve"><div class="synthOsc-curveValue"><select class="synthOsc-curveSelect"><option value="sine">Sine</option><option value="triangle">Triangle</option><option value="sawtooth">Sawtooth</option><option value="square">Square</option></select></div></div><div class="synthOsc-attr synthOsc-detune"><div class="synthOsc-sliderValue"></div><div class="synthOsc-sliderWrap"></div></div><div class="synthOsc-attr synthOsc-pan"><div class="synthOsc-sliderValue"></div><div class="synthOsc-sliderWrap"></div></div><div class="synthOsc-attr synthOsc-gain"><div class="synthOsc-sliderValue"></div><div class="synthOsc-sliderWrap"></div></div><a href class="synthOsc-remove icon ico-times" title="Remove the oscillator"></a></div><template id="gsuiAudioBlock"><div class="gsuiAudioBlock"><div class="gsuiab-bg"></div><div class="gsuiab-head"><span class="gsuiab-name"></span></div><div class="gsuiab-content"></div><div class="gsuiab-crop gsuiab-cropA"></div><div class="gsuiab-crop gsuiab-cropB"></div></div></template><template id="gsuiGridSamples"><div class="gsuiGridSamples" tabindex="-1"><div class="gsuigs-panel"><div class="gsuigs-extend"></div><div class="gsuigs-content"></div></div><div class="gsuigs-grid"><div class="gsuigs-content"></div><div class="gsuigs-select hidden"></div></div></div></template><template id="gsuiKeys-octave"><div class="gsuiKey" data-key="b" ><div data-key="b"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="a#"><div data-key="a#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="a" ><div data-key="a"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="g#"><div data-key="g#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="g" ><div data-key="g"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="f#"><div data-key="f#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="f" ><div data-key="f"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="e" ><div data-key="e"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="d#"><div data-key="d#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="d" ><div data-key="d"  class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="c#"><div data-key="c#" class="gsui-row gsuiKey-row"><div></div></div></div><div class="gsuiKey" data-key="c" ><div data-key="c"  class="gsui-row gsuiKey-row"><div></div></div></div></template><div id="gsuiPopup"><div id="gsuipp-window" tabindex="0"><div id="gsuipp-head"></div><form id="gsuipp-body"><div id="gsuipp-cnt"></div><div id="gsuipp-msg"></div><input type="text" id="gsuipp-inpText"/><div id="gsuipp-btns"><input type="button" id="gsuipp-inpCancel" value="Cancel"/><input type="submit" id="gsuipp-inpOk" value="Ok"/></div></form></div></div><template id="gsuiSlider"><div class="gsuiSlider"><input type="range"/><div class="gsui-line"><div class="gsui-lineColor"></div></div><svg><circle class="gsui-svgLine"/><circle class="gsui-svgLineColor"/></svg><div class="gsui-eventCatcher"></div></div></template><template id="gsuiTimeLine"><div class="gsuiTimeLine"><div class="gsui-loopLine"></div><div class="gsui-loop"><div class="gsui-loopExt gsui-loopA"></div><div class="gsui-loopExt gsui-loopB"></div><div class="gsui-loopBrd gsui-loopBrdA"></div><div class="gsui-loopBrd gsui-loopBrdB"></div><div class="gsui-loopBg"></div></div><svg class="gsui-cursor" width="20" height="10"><polygon points="2,2 10,8 18,2"/></svg><div class="gsui-currentTime"><div class="gsui-cursorLine"></div></div></div></template><template id="gsuiToggle"><div class="gsuiToggle"><div class="gsui-circle"></div></div></template><template id="gsuiTrack"><div class="gsuiTrack"><div class="gsui-row gsuiTrack-row"><div></div></div></div></template><template id="gsuiTrackList"><div class="gsuiTrackList"></div></template><template id="gsuiSpanEditable"><div class="gsuiSpanEditable"><span></span><input type="text"/></div></template><script>"use strict";function gsuiAudioBlock(){var e=this._clone();e.gsuiAudioBlock=this,e.querySelectorAll("*").forEach(function(e){e.gsuiAudioBlock=this},this),this.rootElement=e,this._elName=e.querySelector(".gsuiab-name"),this._elCnt=e.querySelector(".gsuiab-content"),this._elCropA=e.querySelector(".gsuiab-cropA"),this._elCropB=e.querySelector(".gsuiab-cropB"),this._elCropA.onmousedown=this._elCropB.onmousedown=this._evmdCrop.bind(this),e.onmousedown=this._evmdRoot.bind(this),this.selected=!1}function gsuiBeatLines(e){this.rootElement=e=e||document.createElementNS(SVGURL,"svg"),e.setAttribute("preserveAspectRatio","none"),e.classList.add("gsuiBeatLines"),this.elTime=this._newRect(),this._elLoopA=this._newRect(),this._elLoopB=this._newRect(),this.elTime.setAttribute("class","gsui-currentTime"),this._elLoopA.setAttribute("class","gsui-hlStart"),this._elLoopB.setAttribute("class","gsui-hlEnd"),this._elLoopA.setAttribute("x",0),this._elLoopB.setAttribute("width","10000%"),this._offset=0,this._pxPerBeat=32,this._beatsPerMeasure=this._stepsPerBeat=4,this.steps=[],this.currentTime(0),this.loop(!1)}function gsuiGridSamples(){var e=this._clone();this.rootElement=e,this._onMac=navigator.platform.startsWith("Mac"),this._onFirefox=navigator.userAgent.includes("Firefox"),this._elPanel=e.querySelector(".gsuigs-panel"),this._elGrid=e.querySelector(".gsuigs-grid"),this._elPanelExt=this._elPanel.querySelector(".gsuigs-extend"),this._elPanelCnt=this._elPanel.querySelector(".gsuigs-content"),this._elGridCnt=this._elGrid.querySelector(".gsuigs-content"),this._elSelection=this._elGrid.querySelector(".gsuigs-select"),this.uiTimeLine=new gsuiTimeLine,this.uiBeatLines=new gsuiBeatLines,e.prepend(this.uiTimeLine.rootElement),this._elGrid.prepend(this.uiBeatLines.rootElement),this.rows=this._elGridCnt.childNodes,this._rowsById={},e.oncontextmenu=function(){return!1},e.onkeydown=this._evkdRoot.bind(this),this._elPanelExt.onmousedown=this._evmdPanelEx.bind(this),this._elGrid.onmousedown=this._evmdGrid.bind(this),this._elGrid.onwheel=this._evowGrid.bind(this),this._elPanel.onwheel=this._evowPanel.bind(this),this.uiTimeLine.onchangeCurrentTime=this._evocCurrentTime.bind(this),this.uiTimeLine.oninputLoop=this._evoiLoop.bind(this),this.uiTimeLine.onchangeLoop=this._evocLoop.bind(this),this._panelMaxWidth=1/0,this._panelMinWidth=this._contentY=this._timeOffset=0,this._pxPerBeat=80,this._fontSizeTiny=48,this._bcInit(),this.panelWidth(100)}function gsuiKeys(){var e=document.createElement("div");this._init(),this.rootElement=e,this.rowElements=[],this._nlKeys=e.childNodes,this._nbOct=0,e.className="gsuiKeys",e.onmousedown=this._evmdRoot.bind(this)}function gsuiPanels(e){this.rootElement=e,this.init(e),gsuiPanels.bodyEventsInit&&gsuiPanels.bodyEventsInit()}function gsuiRectMatrix(){var e=document.createElementNS(SVGURL,"svg");this.rootElement=e,e.setAttribute("preserveAspectRatio","none"),e.classList.add("gsuiRectMatrix")}function gsuiSlider(){var e=this._clone();this.rootElement=e,this._elInput=e.querySelector("input"),this._elLine=e.querySelector(".gsui-line"),this._elLineColor=e.querySelector(".gsui-lineColor"),this._elSvg=e.querySelector("svg"),this._elSvgLine=e.querySelector(".gsui-svgLine"),this._elSvgLineColor=e.querySelector(".gsui-svgLineColor"),e.onwheel=this._wheel.bind(this),e.onmousedown=this._mousedown.bind(this),e.onmouseleave=this._mouseleave.bind(this)}function gsuiSpanEditable(){this.rootElement=this._clone(),this.span=this.rootElement.querySelector("span"),this.input=this.rootElement.querySelector("input"),this.rootElement.ondblclick=this._dblclick.bind(this),this.input.onblur=this._blur.bind(this),this.input.onkeydown=this._keydown.bind(this),this.setPlaceholder(""),this.setValue("")}function gsuiTimeLine(){var e=this._clone(),t=e.querySelector(".gsui-currentTime"),s=e.querySelector(".gsui-loopBg");this.rootElement=e,this._elTime=e.querySelector(".gsui-cursor"),this._elTimeLine=e.querySelector(".gsui-cursorLine"),this._elLoop=e.querySelector(".gsui-loop"),this._elLoopBgCL=s.classList,this._elLoopBrdACL=e.querySelector(".gsui-loopBrdA").classList,this._elLoopBrdBCL=e.querySelector(".gsui-loopBrdB").classList,this._offset=0,this._pxPerBeat=32,this._beatsPerMeasure=this._stepsPerBeat=4,this._steps=[],this.stepRound=1,this.currentTime(0),this.loop(0,0),t.onmousedown=this._mousedownTime.bind(this),t.onmousemove=this._mousemoveTime.bind(this),s.onmousedown=this._mousedownLoop.bind(this,"ab"),e.querySelector(".gsui-loopA").onmousedown=this._mousedownLoop.bind(this,"a"),e.querySelector(".gsui-loopB").onmousedown=this._mousedownLoop.bind(this,"b"),e.querySelector(".gsui-loopLine").onmousedown=this._mousedownLoopLine.bind(this)}function gsuiToggle(){var e=this._clone();e.querySelector("input");this.rootElement=e,this._circCL=e.querySelector(".gsui-circle").classList,this.checked=!1,e.oncontextmenu=function(){return!1},e.onmousedown=this._mousedown.bind(this)}function gsuiTrack(){var e=this._clone();this.rootElement=e,this.rowElement=e.querySelector(".gsui-row"),this.rowElement.remove(),this.uiToggle=new gsuiToggle,this.uiSpan=new gsuiSpanEditable,e.append(this.uiToggle.rootElement),e.append(this.uiSpan.rootElement),this.data={},this.uiToggle.onchange=this._evocToggle.bind(this),this.uiSpan.onchange=this._evocSpan.bind(this),this.toggle(!0)}function gsuiTrackList(){var e=this._clone();this.data={},this.rootElement=e,this._uiTracks={}}function gsuiWave(e){this.rootElement=e||document.createElementNS(SVGURL,"svg"),this.rootElement.setAttribute("preserveAspectRatio","none"),this.rootElement.classList.add("gsuiWave"),this.polyline=this.rootElement.querySelector("polyline"),this.polyline||(this.polyline=document.createElementNS(SVGURL,"polyline"),this.rootElement.appendChild(this.polyline)),this.type="sine",this.frequency=1,this.attack=this.amplitude=0}function gswaScheduler(){}gsuiAudioBlock.typeToCmp={buffer:"gsuiWaveform",keys:"gsuiRectMatrix"},gsuiAudioBlock.prototype={setResolution(e,t){this.resW=e,this.resH=t,this._uiContentCmp&&this._uiContentCmp.setResolution(e,t)},name(e){this._elName.textContent=e},select(e){this.rootElement.classList.toggle("gsuiab-selected",this.selected=!!e)},when(e){this.rootElement.style.left=e+"em"},whenOffset(e){this._elCnt.style.left=parseFloat(this._elCnt.style.left||0)-e+parseFloat(this.rootElement.style.left||0)+"em",this.when(e)},duration(e){this.rootElement.style.width=this.width=e+"em"},contentWidthFixed(){this._elCnt.style.width=this.width},contentWidthExtendable(){this._elCnt.style.width="100%"},datatype(e){e!==this._datatype&&(this._datatype=this.rootElement.dataset.type=e,this._uiContentCmp&&(this._uiContentCmp.remove(),delete this._uiContentCmp))},updateData(e,t,s){var i=this._uiContentCmp;this._dataDur=e.duration,this._elCnt.style.left=0,i||(this._uiContentCmp=i=new window[gsuiAudioBlock.typeToCmp[this._datatype]],this._elCnt.append(i.rootElement),this.resW?this.setResolution(this.resW,this.resH):this.setResolution(i.rootElement.getBoundingClientRect().width,32)),i.render(e,t,s)},start(e){var t=document.createElement("div");this.stop(),t.className="gsuiab-cursor",t.style.animationDuration=60*this._dataDur/(e||60)+"s",this._elCursor=t,this._elCnt.append(t)},stop(){this._elCursor&&(this._elCursor.remove(),delete this._elCursor)},_clone(){var e=document.createElement("div");return gsuiAudioBlock.template=gsuiAudioBlock.template||this._init(),e.appendChild(document.importNode(gsuiAudioBlock.template.content,!0)),e.removeChild(e.querySelector("*"))},_init:()=>(document.body.addEventListener("mousemove",function(e){gsuiAudioBlock._focused&&gsuiAudioBlock._focused._evmmBody(e)}),document.body.addEventListener("mouseup",function(e){gsuiAudioBlock._focused&&gsuiAudioBlock._focused._evmuBody(e)}),document.getElementById("gsuiAudioBlock")),_evmdRoot(e){0===e.button&&(this._isDragging=!0),this.onmousedown&&!1!==this.onmousedown(this,e)&&(gsuiAudioBlock._focused=this)},_evmmBody(e){gsuiAudioBlock._focused&&(this._elCropping?this.onmousemoveCrop&&this.onmousemoveCrop(this,+this._cropSide,e):this._isDragging&&this.onmousemove&&this.onmousemove(this,e))},_evmuBody(e){gsuiAudioBlock._focused&&(this._elCropping?(this._elCropping.classList.remove("hover"),this.onmouseupCrop&&this.onmouseupCrop(this,+this._cropSide,e),delete this._elCropping):this._isDragging&&(this.onmouseup&&this.onmouseup(this,e),delete this._isDragging),delete gsuiAudioBlock._focused)},_evmdCrop(e){0===e.button&&(e.stopPropagation(),this._elCropping=e.target,this._cropSide=e.target===this._elCropB,e.target.classList.add("hover"),this.onmousedownCrop&&this.onmousedownCrop(this,+this._cropSide,e),gsuiAudioBlock._focused=this)}},window.SVGURL="http://www.w3.org/2000/svg",gsuiBeatLines.prototype={resized(){var e=this.rootElement;this.width=e.getBoundingClientRect().width,e.setAttribute("viewBox","0 0 "+this.width+" 1")},currentTime(e){this._currentTime=e,this._timeUpdate()},offset(e,t){this._offset=Math.max(0,e),this._pxPerBeat=Math.max(0,t),this._render()},timeSignature(e,t){this._beatsPerMeasure=Math.max(1,~~e),this._stepsPerBeat=Math.min(Math.max(1,~~t),16),this._render()},loop(e,t){(this._loop=!1!==e)&&(this._loopA=e,this._loopB=t,this._updateLoop()),this._elLoopA.style.display=this._elLoopB.style.display=this._loop?"block":"none"},render(){this._render()},_render(){for(var e,t,s=this.steps,i=this._pxPerBeat,o=this._stepsPerBeat,n=o*this._beatsPerMeasure,a=i/o,r=1/o,l=0,c=Math.ceil(this.width/a),u=1+~~(this._offset*o),h=-this._offset%r+r;s.length<c;)s.push(this._newRect());for(;l<c;++l)e="gsui-"+(u%n?u%o?"step":"beat":"measure"),(t=s[l]).style.display="block",t.setAttribute("x",h*i+"px"),t.setAttribute("class",e),t.setAttribute("width","gsui-measure"!==e?"1px":"2px"),++u,h+=r;for(;(t=s[l++])&&"none"!==t.style.display;)t.style.display="none";this._timeUpdate(),this._loop&&this._updateLoop()},_newRect(){var e=document.createElementNS(SVGURL,"rect");return e.setAttribute("y",0),e.setAttribute("height","1px"),e.setAttribute("width","1px"),e.style.display="none",this.rootElement.prepend(e),e},_timeUpdate(){var e=this._currentTime-this._offset;this.elTime.style.display=e>0?"block":"none",this.elTime.setAttribute("x",e*this._pxPerBeat+"px")},_updateLoop(){this._elLoopA.setAttribute("width",Math.max(0,this._loopA-this._offset)*this._pxPerBeat+"px"),this._elLoopB.setAttribute("x",(this._loopB-this._offset)*this._pxPerBeat+"px")}},gsuiGridSamples.prototype={empty(){this.uiTrackList&&(this.uiTrackList.empty(),this._rowsById={}),this._bcEmpty()},change(e){e.tracks?(this.uiTrackList.change(e.tracks),this.uiTrackList.newRowElements.forEach(this._rowInit,this)):this._bcChange(e)},resized(){var e=getComputedStyle(this._elPanel);this.width=this.rootElement.clientWidth,this._panelMinWidth=parseFloat(e.minWidth),this._panelMaxWidth=parseFloat(e.maxWidth)||this.width,this._resizeGrid(),this._updateGrid()},setFontSize(e){var t=this._fontSize;(e=~~Math.min(Math.max(16,e),256))!==t&&(this._fontSize=e,this.rootElement.style.fontSize=e+"px",e<this._fontSizeTiny!=t<this._fontSizeTiny&&this.rows.forEach(this._rowUpdateSizeClass,this))},offset(e,t){this._timeOffset=e,this._pxPerBeat=t||this._pxPerBeat,this._updateGrid(!!t)},timeSignature(e,t){this.uiTimeLine.timeSignature(e,t),this.uiBeatLines.timeSignature(e,t)},currentTime(e){this.uiTimeLine.currentTime(e),this.uiBeatLines.currentTime(e)},loop(e,t){this.uiTimeLine.loop(e,t),this.uiBeatLines.loop(e,t)},panelWidth(e){e=Math.max(this._panelMinWidth,Math.min(e,this._panelMaxWidth)),this._timeOffset>0&&(this._timeOffset+=(e-this._panelWidth)/this._pxPerBeat),this._panelWidth=e,this._updatePanelSize()},contentY(e){var t=(this.uiTrackList||this.uiKeys).rootElement.clientHeight;t=Math.max(0,t-this._elGrid.clientHeight)/this._fontSize,this._contentY=e=Math.min(Math.max(0,e),t),this._elGridCnt.style.marginTop=this._elPanelCnt.style.marginTop=-e+"em"},scrollToSamples(){var e=this._elGridCnt.querySelector(".gsuiAudioBlock");e&&this.contentY((e.getBoundingClientRect().top-this._elGridCnt.getBoundingClientRect().top)/this._fontSize-3)},loadKeys(e,t){this._loadPanelCmp("uiKeys","uiTrackList"),this._elGridCnt.classList.add("gsui-noleftcrop"),this.uiKeys.octaves(e,t),this.uiKeys.newRowElements.forEach(this._rowInit,this)},loadTrackList(){this._loadPanelCmp("uiTrackList","uiKeys"),this._elGridCnt.classList.remove("gsui-noleftcrop"),this.uiTrackList.onchange=(e=>this.onchange({tracks:e}))},_clone(){var e=document.createElement("div");return gsuiGridSamples.template=gsuiGridSamples.template||this._init(),e.appendChild(document.importNode(gsuiGridSamples.template.content,!0)),e.removeChild(e.querySelector("*"))},_init:()=>(document.body.addEventListener("mousemove",function(e){gsuiGridSamples._focused&&gsuiGridSamples._focused._evmmRoot(e)}),document.body.addEventListener("mouseup",function(e){gsuiGridSamples._focused&&gsuiGridSamples._focused._evmuRoot(e)}),document.getElementById("gsuiGridSamples")),_callOnchange(e){for(var t in e){this.onchange(e);break}},_loadPanelCmp(e,t){var s=this[e],i=this[t];i?(i.remove(),this.setFontSize(this._fontSize*("uiKeys"===e?.5:2)),delete this[t]):this.setFontSize("uiKeys"===e?20:40),s||(this[e]=s="uiKeys"===e?new gsuiKeys:new gsuiTrackList,this._elPanelCnt.prepend(s.rootElement))},_resizeGrid(){this.uiTimeLine.resized(),this.uiBeatLines.resized()},_deltaY(e,t,s){return this._onMac?e:e>0?t:s||-t},_contentScroll(e){var t,s=this._pxPerBeat;Math.abs(e.deltaY)>Math.abs(e.deltaX)?this.contentY(this._contentY+this._deltaY(e.deltaY,20,-20)/this._fontSize):(t=e.deltaX/s*2,this.offset(Math.max(0,this._timeOffset+t)))},_getMouseBeat(e){return this._elGridCntBCR=this._elGridCnt.getBoundingClientRect(),(e-this._elGridCntBCR.left)/this._pxPerBeat},_updateGrid(e){var t=this._pxPerBeat;this.uiTimeLine.offset(this._timeOffset,t),this.uiBeatLines.offset(this._timeOffset,t),this._timeOffset=this.uiTimeLine._offset,this._pxPerBeat=t=this.uiTimeLine._pxPerBeat,this._elGridCnt.style.left=-this._timeOffset*t+"px",e&&this.rows.forEach(this._rowUpdateFontSize,this)},_updatePanelSize(){this._elPanel.style.width=this._elGrid.style.left=this._panelWidth+"px",this.uiTimeLine.rootElement.style.left=this._panelWidth-1+"px",this._resizeGrid(),this._updateGrid()},_findTrack(e){var t=~~((e-this._elGridCntBCR.top)/this._fontSize);return this.rows[Math.max(0,Math.min(t,this.rows.length-1))]},_rowInit(e,t){var s=this.uiKeys;s&&(e.dataset.octave=s._octStart+s._nbOct-1-~~(t/12)),e.onmousedown=this._evmdRow.bind(this,e),this._rowsById[e.dataset.track]=e,this._rowUpdateFontSize(e),this._rowUpdateSizeClass(e),this._elGridCnt.append(e)},_rowUpdateFontSize(e){e.firstChild.style.fontSize=this._pxPerBeat+"px"},_rowUpdateSizeClass(e){e.classList.toggle("gs-row-tiny",this._fontSize<this._fontSizeTiny)},_rowByValue(e){var t=this.uiKeys;return t?this.rows[t.rowElements.length-1-t.keyToIndex(e)]:this._rowsById[e]},_rowIndexByData(e){return e.track?this._rowIndexByElement(this._rowsById[e.track]):this.uiKeys.rowElements.length-this.uiKeys.keyToIndex(e.key)-1},_rowIndexByElement(e){return e.dataset.rowid?+e.dataset.rowid:Array.from(this.rows).indexOf(e)},_evocCurrentTime(e){this.uiBeatLines.currentTime(e),this.onchangeCurrentTime&&this.onchangeCurrentTime(e)},_evoiLoop(e,t,s){this.uiBeatLines.loop(e&&t,s),this.oninputLoop&&this.oninputLoop(e,t,s)},_evocLoop(e,t,s){this.onchangeLoop&&this.onchangeLoop(e,t,s)},_evmdGrid(e){this._mdPageX=e.pageX,this._mdPageY=e.pageY,this._mdBeat=this.uiTimeLine.beatRound(this._getMouseBeat(e.pageX)),gsuiGridSamples._focused=this,e.shiftKey?this._selectionIsStarting=!0:e.altKey&&(this._gridDragging=!0,this._mouseOffset=this._timeOffset,this._mouseContentY=this._contentY)},_evmdPanelEx(e){this._rootLeft=this.rootElement.getBoundingClientRect().left,this._panelResizing=this._elPanelExt.clientWidth-e.layerX,this._elPanelExt.classList.add("gsui-hover"),gsuiGridSamples._focused=this},_evmdRow(e,t){if(!(this._bcClicked||t.shiftKey||t.ctrlKey||t.altKey))if(2===t.button)this._deletionStarted();else if(0===t.button&&this.uiKeys){var s=gsuiGridSamples.getNewId(),i=this._bcUnselectAll(),o={key:e.dataset.key+e.dataset.octave,when:this.uiTimeLine.beatFloor(this._getMouseBeat(t.pageX)),offset:0,duration:this._bcLastDur||1};i[s]=o,this._bcCreate(s,o),this.onchange(i)}},_evowGrid(e){if(e.shiftKey||e.ctrlKey||e.metaKey){var t,s,i=this._metaKeyOnMac(e)||this._onPinchAndZoom(e),o=this._pxPerBeat;if(i)t=e.pageX-this._elGrid.getBoundingClientRect().left,o*=this._onMac&&!this._onFirefox?e.deltaY>0?.975:1.025:e.deltaY>0?.9:1.1,o=Math.min(Math.max(8,o),512),s=t/this._pxPerBeat*(o-this._pxPerBeat)/o;else{if(!e.shiftKey)return!1;s=this._deltaY(e.deltaY,20,-20)/o}this.offset(Math.max(0,this._timeOffset+s),i?o:void 0)}else this._contentScroll(e);return!1},_evowPanel(e){if(e.ctrlKey||this._metaKeyOnMac(e)){var t=e.pageY-this._elPanel.getBoundingClientRect().top,s=this._fontSize,i=s*(e.deltaY>0?.9:1.1);this.setFontSize(i),i=this._fontSize,this.contentY(this._contentY+t/s*(i-s)/i)}else e.shiftKey||this._contentScroll(e);return!1},_evmmRoot(e){var t=e.pageX-this._mdPageX,s=e.pageY-this._mdPageY;this._gridDragging?(this.offset(this._mouseOffset-t/this._pxPerBeat),this.contentY(this._mouseContentY-s/this._fontSize)):null!=this._panelResizing?this.panelWidth(e.pageX-this._rootLeft+this._panelResizing):this._deletionObj?this._deletionPush(e.target.gsuiAudioBlock&&e.target.gsuiAudioBlock.id):this._selectionIsStarted?this._selectionStarted(e):this._selectionIsStarting&&this._selectionStarting(e,t,s)},_evmuRoot(){this._selectionEnd(),this._deletionEnd(),this._elPanelExt.classList.remove("gsui-hover"),delete this._bcClicked,delete this._gridDragging,delete this._panelResizing,delete gsuiGridSamples._focused},_evkdRoot(e){switch(e.code){case"KeyA":e.altKey&&this._callOnchange(this._bcSelectAll());break;case"KeyD":if(e.altKey)return this._callOnchange(this._bcUnselectAll()),!1;break;case"Delete":this._deletionObj={};for(var t in this._bcSelected)this._deletionPush(t);this._deletionEnd()}},_metaKeyOnMac(e){return this._onMac&&e.metaKey},_onPinchAndZoom:e=>e.ctrlKey&&Math.abs(e.deltaY)>Math.abs(e.deltaX)},Object.assign(gsuiGridSamples.prototype,{_bcInit(){this._bcAll={},this._bcSelected={},this._bcLastDur=1},_bcEmpty(){for(var e in this._bcAll)this._bcAll[e].rootElement.remove(),delete this._bcAll[e],delete this._bcSelected[e]},_bcChange(e){for(var t in e)e[t]?this._bcAll[t]?this._bcUpdate(t,e[t]):this._bcCreate(t,e[t]):this._bcDelete(t)},_bcCreate(e,t){var s=new gsuiAudioBlock;return this._bcAll[e]=s,s.id=e,s.data=t,t.key?(s.datatype("key"),s.name(t.key)):s.datatype("keys"),s.onmousedown=this._bcBodyDown.bind(this),s.onmousemove=this._bcBodyMove.bind(this),s.onmouseup=this._bcBodyUp.bind(this),s.onmousedownCrop=this._bcCropDown.bind(this),s.onmousemoveCrop=this._bcCropMove.bind(this),s.onmouseupCrop=this._bcCropUp.bind(this),this.__bcUpdate(e,t),this.fnSampleCreate&&this.fnSampleCreate(e,s),this.fnSampleUpdate&&this.fnSampleUpdate(e,s),s},_bcUpdate(e,t){var s=this.__bcUpdate(e,t);this.fnSampleUpdate&&this.fnSampleUpdate(e,s)},__bcUpdate(e,t){var s=this._bcAll[e];return"when"in t&&s.when(t.when),"selected"in t&&this._bcSelect(e,t.selected),"duration"in t&&(this._bcLastDur=t.duration,s.duration(t.duration),s.contentWidthFixed(),s.setResolution(t.duration*this._pxPerBeat,this._fontSize)),("key"in t||"track"in t)&&("key"in t&&s.name(t.key),this._rowByValue(t.key||t.track).firstChild.append(s.rootElement)),s},_bcDelete(e){var t=this._bcAll[e];t&&(t.rootElement.remove(),delete this._bcAll[e],delete this._bcSelected[e],this.fnSampleDelete&&this.fnSampleDelete(e,t))},_bcForEach(e,t){if(e.data.selected)for(var s in this._bcSelected)t(this._bcSelected[s]);else t(e)},_bcSelect(e,t){var s=this._bcAll[e];s.select(t),t?this._bcSelected[e]=s:delete this._bcSelected[e]},_bcSelectAll(){return Object.keys(this._bcAll).reduce((e,t)=>(this._bcAll[t].data.selected||(this._bcSelect(t,!0),e[t]={selected:!0}),e),{})},_bcUnselectAll(){return Object.keys(this._bcSelected).reduce((e,t)=>(this._bcSelect(t,!1),e[t]={selected:!1},e),{})},_bcCropDown(e,t,s){var i,o=e.data.when,n=e.data.offset,a=e.data.duration,r=this._bcSelected,l=1/this.uiTimeLine._stepsPerBeat;if(e.data.selected)for(i in r)o=Math.min(o,r[i].data.when),n=Math.min(n,r[i].data.offset),a=Math.min(a,r[i].data.duration);this._cropPageX=s.pageX,this._cropWhenMin=o,this._cropOffMin=n,this._cropDurMin=a>l?a-l:0,this._cropWhenRel=this._cropOffRel=this._cropDurRel=0},_bcCropMove(e,t,s){var i,o,n,a=this.uiTimeLine.beatRound((s.pageX-this._cropPageX)/this._pxPerBeat);1===t?(i=o=0,n=a>=0?a:Math.max(-this._cropDurMin,a)):a<0?(n=-(o=i=Math.max(-this._cropWhenMin,a)),i+=(a=Math.max(-this._cropOffMin,o))-o,n-=a-o,o=a):o=i=-(n=Math.max(-this._cropDurMin,-a)),this._cropWhenRel=i,this._cropOffRel=o,this._cropDurRel=n,this._bcForEach(e,this.__bcCropMove.bind(this,t,i,n))},__bcCropMove(e,t,s,i){e||i.whenOffset(i.data.when+t),i.duration(i.data.duration+s)},_bcCropUp(e){if(delete this._cropPageX,Math.abs(this._cropWhenRel)>1e-4||Math.abs(this._cropDurRel)>1e-4){var t={};this._bcForEach(e,this.__bcCropUp.bind(this,t,this._cropWhenRel,this._cropOffRel,this._cropDurRel)),this.onchange(t)}},__bcCropUp(e,t,s,i,o){var n={};Math.abs(t)>1e-4&&(n.when=o.data.when+t,n.offset=o.data.offset+s),Math.abs(i)>1e-4&&(n.duration=o.data.duration+i,o.data.durationEdited||(n.durationEdited=!0)),e[o.id]=n},_bcBodyDown(e,t){var s,i,o,n,a,r=this._bcSelected,l=e.id;if(this._bcClicked=e,2===t.button)return this._deletionStarted(l),!1;if(t.shiftKey)return s=!r[l],this._bcSelect(l,s),this.onchange({[l]:{selected:s}}),!1;if(t.altKey)return!1;if(this._movePageX=t.pageX,this._moveTrack=n=o=this._rowIndexByData(e.data),i=e.data.when,e.data.selected)for(l in r)e=r[l],a=this._rowIndexByData(e.data),i=Math.min(i,e.data.when),o=Math.min(o,a),n=Math.max(n,a);this._moveWhenMin=i,this._moveTrackMin=o,this._moveTrackMax=this.rows.length-n-1,this._moveWhenRel=this._moveTrackRel=0},_bcBodyMove(e,t){var s=this.uiTimeLine.beatRound((t.pageX-this._movePageX)/this._pxPerBeat),i=this._findTrack(t.pageY),o=this._rowIndexByElement(i)-this._moveTrack;s<0&&(s=Math.max(-this._moveWhenMin,s)),o<0?o=Math.max(-this._moveTrackMin,o):o>0&&(o=Math.min(this._moveTrackMax,o)),this._moveWhenRel=s,this._moveTrackRel=o,this._bcForEach(e,this.__bcBodyMove.bind(this,s,o))},__bcBodyMove(e,t,s){s.when(s.data.when+e),s._gsuigsTrackRel!==t&&(s._gsuigsTrackRel=t,this.rows[this._rowIndexByData(s.data)+t].firstChild.append(s.rootElement))},_bcBodyUp(e,t){if(delete this._movePageX,this._moveTrackRel||Math.abs(this._moveWhenRel)>1e-4){var s={};this._bcForEach(e,this.__bcBodyUp.bind(this,s,this._moveWhenRel,this._moveTrackRel)),this.onchange(s)}},__bcBodyUp(e,t,s,i){var o,n={};s&&((o=i.rootElement.parentNode.parentNode.dataset).track?n.track=o.track:n.key=o.key+o.octave),Math.abs(t)>1e-4&&(n.when=i.data.when+t),e[i.id]=n}}),Object.assign(gsuiGridSamples.prototype,{_deletionStarted(e){this._deletionObj=e?{}:this._bcUnselectAll(),e&&this._deletionPush(e)},_deletionPush(e){e&&(this._deletionObj[e]=null,this._bcDelete(e))},_deletionEnd(){this._callOnchange(this._deletionObj),delete this._deletionObj}}),Object.assign(gsuiGridSamples.prototype,{_selectionStarting(e,t,s){Math.max(Math.abs(t),Math.abs(s))>6&&(this._mdTrack=this._mmTrack=this._findTrack(e.pageY),this._selectionCalc(e.pageX),this._elSelection.classList.remove("hidden"),this._selectionIsStarted=!0,delete this._selectionIsStarting)},_selectionStarted(e){this._mmTrack=this._findTrack(e.pageY),this._selectionCalc(e.pageX)},_selectionCalc(e){var t=this._mdTrack,s=this._mmTrack,i=this._mdBeat,o=this.uiTimeLine.beatRound(this._getMouseBeat(e));2&t.compareDocumentPosition(s)&&(t=s,s=this._mdTrack),this._selectionDraw(t,s,Math.min(i,o),Math.max(i,o))},_selectionDraw(e,t,s,i){if(e!==this._selectionTrkA||t!==this._selectionTrkB||s!==this._selectionBeatA||i!==this._selectionBeatB){var o=this._elSelection.style,n=e.getBoundingClientRect().top;this._selectionBeatA=s,this._selectionBeatB=i,this._selectionTrkA=e,this._selectionTrkB=t,o.left=(s-this._timeOffset)*this._pxPerBeat+"px",o.width=(i-s)*this._pxPerBeat+"px",o.top=n-this._elGridCntBCR.top-this._contentY*this._fontSize+"px",o.height=t.getBoundingClientRect().bottom-n+"px",this._selectionSelect()}},_selectionSelect(e,t,s,i){var o,n,a,r,l=this._selectionTrkA,c=this._selectionTrkB,u=this._selectionBeatA,h=this._selectionBeatB,d=this._bcAll,p=this._bcSelected;this._selectionList=[];for(o in d)n=d[o],p[o]||((a=u<n.data.when+n.data.duration&&n.data.when<h)&&(a=2&(r=n.rootElement.compareDocumentPosition(l))||8&r)&&(a=4&(r=n.rootElement.compareDocumentPosition(c))||8&r),a&&this._selectionList.push(n),n.select(a))},_selectionEnd(){this._selectionIsStarted&&(this._elSelection.classList.add("hidden"),delete this._selectionTrkA,delete this._selectionTrkB,delete this._selectionIsStarted,this._selectionList.length>0&&this.onchange(this._selectionList.reduce((e,t)=>(this._bcSelected[t.id]=t,e[t.id]={selected:!0},e),{}))),delete this._selectionIsStarting}}),gsuiKeys.keyIds={b:11,"a#":10,a:9,"g#":8,g:7,"f#":6,f:5,e:4,"d#":3,d:2,"c#":1,c:0},gsuiKeys.prototype={remove(){this.rootElement.remove(),this.rowElements.forEach(function(e){e.remove()}),this.rowElements.length=0},octaves(e,t){var s,i=this.rootElement,o=t-this._nbOct;if((o||this._octStart!==e)&&(this._octStart=e,i.style.counterReset="octave "+(e+t)),o){if(o>0){for(;o-- >0;)i.append(document.importNode(gsuiKeys.octaveTemplate.content,!0));s=12*this._nbOct,this.newRowElements=i.querySelectorAll(".gsui-row"),this.newRowElements.forEach(function(e){e.remove(),e.dataset.rowid=s++}),Array.prototype.push.apply(this.rowElements,this.newRowElements)}else for(o*=12;o<0;++o)i.lastChild.remove(),this.rowElements[this.rowElements.length-1].remove(),this.rowElements.pop();this._nbOct=t}},keyToIndex(e){var t=e.substr(0,"#"!==e[1]?1:2);return 12*e.substr(t.length)+gsuiKeys.keyIds[t]-12*this._octStart},_init(){gsuiKeys.octaveTemplate||(gsuiKeys.octaveTemplate=document.getElementById("gsuiKeys-octave"),document.body.addEventListener("mousemove",function(e){gsuiKeys._focused&&gsuiKeys._focused._evmmRoot(e)}),document.body.addEventListener("mouseup",function(e){gsuiKeys._focused&&gsuiKeys._focused._evmuRoot(e)}))},_isBlack:e=>1===e||3===e||5===e||8===e||10===e,_keydown(e){var t=this._nlKeys[e];t&&(this._keyup(),this._keyInd=e,this._elKey=t,this._octNum=this._octStart+this._nbOct-1-~~(e/12),t.classList.add("gsui-active"),this.onkeydown&&this.onkeydown(t.dataset.key,this._octNum,this._gain))},_keyup(){this._elKey&&(this._elKey.classList.remove("gsui-active"),this.onkeyup&&this.onkeyup(this._elKey.dataset.key,this._octNum,this._gain))},_evmdRoot(e){if(this._nbOct){var t=this.rootElement.childNodes[1].getBoundingClientRect();this._rootTop=this.rootElement.getBoundingClientRect().top,this._blackKeyR=t.right,this._blackKeyH=t.height,this._gain=Math.min(e.layerX/(e.target.clientWidth-1),1),gsuiKeys._focused=this,this._evmmRoot(e)}},_evmuRoot(e){this._keyup(),delete this._elKey,delete this._keyInd,delete gsuiKeys._focused},_evmmRoot(e){var t=(e.clientY-this._rootTop)/this._blackKeyH,s=~~t;e.clientX>this._blackKeyR&&this._isBlack(~~(s%12))&&(s+=t-s<.5?-1:1),this._keyInd!==s&&this._keydown(s)}},gsuiPanels.bodyEventsInit=function(){document.body.addEventListener("mousemove",function(e){gsuiPanels._focused&&gsuiPanels._focused._onmousemove(e)}),document.body.addEventListener("mouseup",function(e){gsuiPanels._focused&&gsuiPanels._focused._onmouseup(e)}),delete gsuiPanels.bodyEventsInit},gsuiPanels.prototype={init(e){e.style.overflow="hidden",e.querySelectorAll(".gsuiPanels-extend").forEach(e=>e.remove()),e.classList.contains("gsuiPanels-x")?this._convertFlex("width",e):e.classList.contains("gsuiPanels-y")&&this._convertFlex("height",e),e.querySelectorAll(".gsuiPanels-x").forEach(this._convertFlex.bind(this,"width")),e.querySelectorAll(".gsuiPanels-y").forEach(this._convertFlex.bind(this,"height")),e.querySelectorAll(".gsuiPanels-x > div + div").forEach(this._addExtend.bind(this,"width")),e.querySelectorAll(".gsuiPanels-y > div + div").forEach(this._addExtend.bind(this,"height"))},_convertFlex(e,t){var s=Array.from(t.children),i=t.getBoundingClientRect()[e],o=s.map(t=>t.getBoundingClientRect()[e]);s.forEach(function(t,s){t.style[e]=o[s]/i*100+"%",t.style.flex="none"}),s[s.length-1].style.flex=1},_addExtend(e,t){var s=document.createElement("div"),i=t.parentNode,o=Array.from(i.children),n=o.filter(function(e){return!e.classList.contains("gsuiPanels-extend")&&t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING}).reverse(),a=o.filter(function(e){return!e.classList.contains("gsuiPanels-extend")&&(t===e||t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)});s.className="gsuiPanels-extend",s.onmousedown=this._onmousedownExtend.bind(this,e,s,n,a),t.append(s)},_incrSizePans(e,t,s){var i=this._parentSize;return s.reduce(function(t,s){if(Math.abs(t)>.1){var o=getComputedStyle(s),n=s.getBoundingClientRect()[e],a=parseFloat(o["min-"+e])||10,r=parseFloat(o["max-"+e])||1/0,l=Math.max(a,Math.min(n+t,r));Math.abs(l-n)>=.1&&(s.style.flex="none",s.style[e]=l/i*100+"%",t-=l-n,s.onresizing&&s.onresizing(s))}return t},t)},_onmouseup(){this._extend.classList.remove("gsui-hover"),this.rootElement.classList.remove("gsuiPanels-noselect"),this._panAfter[this._panAfter.length-1].style.flex=1,delete gsuiPanels._focused},_onmousemove(e){var t=this._dir,s=("width"===t?e.pageX:e.pageY)-this._pageN;s-=this._incrSizePans(t,s,this._panBefore),Math.abs(s)>.1&&this._incrSizePans(t,-s,this._panAfter),this._pageN+=s},_onmousedownExtend(e,t,s,i,o){gsuiPanels._focused=this,t.classList.add("gsui-hover"),this.rootElement.classList.add("gsuiPanels-noselect"),this._dir=e,this._extend=t,this._pageN="width"===e?o.pageX:o.pageY,this._panBefore=s,this._panAfter=i,this._parent=t.parentNode.parentNode,this._parentSize=this._parent.getBoundingClientRect()[e]}},window.gsuiPopup={alert:(e,t)=>(gsuiPopup._init(),gsuiPopup._emptyCnt(),gsuiPopup._open("alert",e,t)),confirm:(e,t)=>(gsuiPopup._init(),gsuiPopup._emptyCnt(),gsuiPopup._open("confirm",e,t)),prompt:(e,t,s)=>(gsuiPopup._init(),gsuiPopup._emptyCnt(),gsuiPopup._open("prompt",e,t,s)),custom(e,t,s){var i;return gsuiPopup._init(),gsuiPopup._emptyCnt(),gsuiPopup._fnSubmit=s,i=gsuiPopup.elCnt,t.length?i.append.apply(i,t):i.append(t),gsuiPopup._open("custom",e)},close(){gsuiPopup.isOpen&&gsuiPopup.elCancel.click()},_emptyCnt(){for(var e=gsuiPopup.elCnt;e.firstChild;)e.firstChild.remove()},_init(){var e,t=gsuiPopup;t._ready||(e=t.elRoot=document.getElementById("gsuiPopup"),t.elWindow=e.querySelector("#gsuipp-window"),t.elHeader=e.querySelector("#gsuipp-head"),t.elCnt=e.querySelector("#gsuipp-cnt"),t.elMsg=e.querySelector("#gsuipp-msg"),t.elText=e.querySelector("#gsuipp-inpText"),t.elCancel=e.querySelector("#gsuipp-inpCancel"),t.elOk=e.querySelector("#gsuipp-inpOk"),t.elForm=e.querySelector("form"),e.onclick=t.elCancel.onclick=t._cancelClick,t.elForm.onsubmit=t._submit,t.elText.onkeypress=t.elText.onkeydown=t.elText.onkeyup=t.elWindow.onclick=function(e){e.stopPropagation()},t.elWindow.onkeydown=function(e){27===e.keyCode&&t._cancelClick(),e.stopPropagation()},t._ready=!0)},_open(e,t,s,i){var o=gsuiPopup;return o.isOpen=!0,o.elHeader.textContent=t,o.elMsg.innerHTML=s||"",o.elText.value=arguments.length>3?i:"",o.elWindow.dataset.gsuiType=o.type=e,o.elWindow.classList.toggle("gsui-nocancel","prompt"!==e&&"confirm"!==e),o.elWindow.classList.toggle("gsui-notext","prompt"!==e),o.elRoot.classList.add("gsui-show"),setTimeout(function(){"prompt"===e?o.elText.select():o.elOk.focus()},250),new Promise(function(e){o.resolve=e}).then(function(e){return o.isOpen=!1,o.elRoot.classList.remove("gsui-show"),e})},_cancelClick(){gsuiPopup.resolve("confirm"!==gsuiPopup.type&&("prompt"===gsuiPopup.type?null:void 0))},_submit:e=>("custom"===gsuiPopup.type&&gsuiPopup._fnSubmit&&gsuiPopup._fnSubmit(e),gsuiPopup.resolve("confirm"===gsuiPopup.type||("prompt"===gsuiPopup.type?gsuiPopup.elText.value:void 0)),!1)},window.SVGURL="http://www.w3.org/2000/svg",gsuiRectMatrix.prototype={remove(){this.empty(),this.rootElement.remove()},empty(){for(var e=this.rootElement;e.childNodes.length;)e.lastChild.remove()},setResolution(e,t){this.width=e,this.height=t,this.rootElement.setAttribute("viewBox","0 0 "+e+" "+t)},render(e,t,s){var i,o,n,a,r=this.width,l=this.height/e.nbRows,c=this.rootElement;t=t||0,s=s||e.duration,a=r/s,this.empty(),e.samples.forEach(function(e){o=(e.when-t)*a,n=e.duration*a,o+n>0&&o<r&&((i=document.createElementNS(SVGURL,"rect")).setAttribute("x",o+"px"),i.setAttribute("width",n+"px"),i.setAttribute("y",e.row*l+"px"),i.setAttribute("height",l+"px"),c.append(i))})}},gsuiSlider.prototype={options(e){var t=this._elInput,s=this.rootElement.classList;this._circ="circular"===e.type,this._axeX="linear-x"===e.type,this._options=e=Object.assign({},e),e.step=Math.max(0,e.step)||(e.max-e.min)/10,e.scrollStep=Math.max(e.step,e.scrollStep||e.step),e.startFrom=Math.max(e.min,Math.min(e.startFrom||0,e.max)),t.min=e.min,t.max=e.max,t.step=e.step,t.value=e.value,this._previousval=t.value,this._circ?(s.remove("gsui-linear","gsui-x","gsui-y"),s.add("gsui-circular")):(s.remove("gsui-circular","gsui-x","gsui-y"),s.add("gsui-linear",this._axeX?"gsui-x":"gsui-y")),this._updateVal()},setValue(e,t){var s=this._elInput,i=s.value;s.value=e,s.value!==i&&(this._updateVal(),t&&this.oninput&&this.oninput(+s.value)),t||(this._previousval=s.value)},resized(){var e=this.rootElement.getBoundingClientRect();this.resize(e.width,e.height)},resize(e,t){if(this.rootElement.style.width=e+"px",this.rootElement.style.height=t+"px",e!==this.width||t!==this.height){this._axeX;var s=Math.min(e,t),i=s/2,o=~~(s/10),n=~~((s-o)/2);this.width=e,this.height=t,this._circ&&(this._elSvg.setAttribute("viewBox","0 0 "+s+" "+s),this._elSvgLine.setAttribute("cx",i),this._elSvgLine.setAttribute("cy",i),this._elSvgLine.setAttribute("r",n),this._elSvgLineColor.setAttribute("cx",i),this._elSvgLineColor.setAttribute("cy",i),this._elSvgLineColor.setAttribute("r",n),this._elSvgLine.style.strokeWidth=this._elSvgLineColor.style.strokeWidth=o,this._svgLineLen=2*n*Math.PI),this._updateVal()}},_clone(){var e=document.createElement("div");return gsuiSlider.template=gsuiSlider.template||this._init(),e.appendChild(document.importNode(gsuiSlider.template.content,!0)),e.removeChild(e.querySelector("*"))},_init:()=>(document.body.addEventListener("mousemove",function(e){gsuiSlider._focused&&gsuiSlider._focused._mousemove(e)}),document.body.addEventListener("mouseup",function(e){gsuiSlider._focused&&gsuiSlider._focused._mouseup(e)}),document.getElementById("gsuiSlider")),_updateVal(){if(this.value=+this._elInput.value,this.rootElement.parentNode){var e,t=this._options,s=t.max-t.min,i=(this.value-t.min)/s,o=(t.startFrom-t.min)/s,n=Math.abs(i-o),a=Math.min(i,o);this._circ?((e=this._elSvgLineColor.style).strokeDasharray=n*this._svgLineLen+", 999999",e.transform="rotate("+(90+360*a)+"deg)"):(e=this._elLineColor.style,this._axeX?(e.left=100*a+"%",e.width=100*n+"%"):(e.bottom=100*a+"%",e.height=100*n+"%"))}},_onchange(){var e=this._elInput.value;this._previousval!==e&&(this.onchange&&this.onchange(+e),this._previousval=e)},_wheel(e){var t=e.deltaY>0?-1:1;return this.setValue(+this._elInput.value+this._options.scrollStep*t,!0),!1},_mousedown(e){var t=this._options,s=this._elLine.getBoundingClientRect(),i=this._circ?this._svgLineLen:this._axeX?s.width:s.height;this._onchange(),this._pxval=(t.max-t.min)/i,this._pxmoved=0,gsuiSlider._focused=this,this.rootElement.requestPointerLock()},_mouseup(e){document.exitPointerLock(),delete gsuiSlider._focused,this._onchange()},_mousemove(e){var t=this._options,s=this._circ||!this._axeX?-e.movementY:e.movementX,i=(t.max-t.min)/5,o=+this._previousval+(this._pxmoved+s)*this._pxval;t.min-i<o&&o<t.max+i&&(this._pxmoved+=s),this.setValue(o,!0)},_mouseleave(){this._onchange()}},gsuiSpanEditable.prototype={setValue(e,t){(e=e?e.trim():"")!==this.value&&(this.value=e,this.rootElement.classList.toggle("gsui-empty",!e),this.span.textContent=e||this.placeholder,t&&this.onchange&&this.onchange(e))},setPlaceholder(e){this.placeholder=e.trim(),this.value||(this.span.textContent=this.placeholder)},_clone(){var e=document.createElement("div"),t=gsuiSpanEditable.template;return gsuiSpanEditable.template=t=t||document.getElementById("gsuiSpanEditable"),e.appendChild(document.importNode(t.content,!0)),e.removeChild(e.querySelector("*"))},_dblclick(e){this.input.value=this.value,this.rootElement.classList.add("gsui-editing"),this.input.focus(),this.input.select()},_blur(e){this._esc||(this.setValue(e.target.value,!0),this.rootElement.classList.remove("gsui-editing")),this._esc=!1},_keydown(e){e.stopPropagation(),13!==e.keyCode&&27!==e.keyCode||(this._esc=27===e.keyCode,this._esc||this.setValue(e.target.value,!0),this.rootElement.classList.remove("gsui-editing"))}},gsuiTimeLine.prototype={resized(){var e=this.rootElement.getBoundingClientRect();this.width=e.width,this.height=e.height},currentTime(e,t){this._currentTime=e,this._updateTime(t),t&&this.onchangeCurrentTime&&this.onchangeCurrentTime(e)},offset(e,t){this._offset=Math.max(0,+e||0),this._pxPerBeat=+t,this._render()},timeSignature(e,t){this._beatsPerMeasure=Math.max(1,~~e),this._stepsPerBeat=Math.min(Math.max(1,~~t),16),this._render()},beatRound(e){return this._round(e,"round")},beatFloor(e){return this._round(e,"floor")},loop(e,t,s){var i,o,n,a=this._loop;!1===e?this._loop=e:(this._loopA=Math.max(0,Math.min(e,t)),this._loopB=Math.max(0,e,t)),o=this.beatRound(this._loopA),n=this.beatRound(this._loopB),this._loop=n-o>1/this._stepsPerBeat/8,s?this.oninputLoop&&(a&&this._loop&&(i=this._serialAB(o,n)),a===this._loop&&this._loopSerialInp===i||(this._loopSerialInp=i,this.oninputLoop(this._loop,o,n))):(this._loopWas=this._loop,this._loopSerial=this._serialAB(this._loopAWas=o,this._loopBWas=n)),this._updateLoop()},_clone(){var e=document.createElement("div");return gsuiTimeLine.template=gsuiTimeLine.template||this._init(),e.appendChild(document.importNode(gsuiTimeLine.template.content,!0)),e.removeChild(e.querySelector("*"))},_init:()=>(document.body.addEventListener("mousemove",function(e){gsuiTimeLine._focused&&gsuiTimeLine._focused._mousemove(e)}),document.body.addEventListener("mouseup",function(e){gsuiTimeLine._focused&&gsuiTimeLine._focused._mouseup(e)}),document.getElementById("gsuiTimeLine")),_round(e,t){if(this.stepRound){var s=1/this._stepsPerBeat*this.stepRound;e=Math[t](e/s)*s}return e},_layerX(e){return e.pageX-this.rootElement.getBoundingClientRect().left},_serialAB:(e,t)=>e.toFixed(4)+" "+t.toFixed(4),_mousemove(e){if(this._lock){var t=this._lockA,s=this._lockB,i=this._loopA,o=this._loopB,n=e.movementX/this._pxPerBeat;t||s?(t?i+=n:o+=n,i>o&&(this._lockA=s,this._lockB=t,this._elLoopBrdACL.toggle("gsui-hover",s),this._elLoopBrdBCL.toggle("gsui-hover",t))):(i+n<0&&(n=-i),i+=n,o+=n),this.loop(i,o,!0)}},_mouseup(e){var t,s=this._loop,i=this.beatRound(this._loopA),o=this.beatRound(this._loopB);this._loopA=i,this._loopB=o,this._lock=this._lockA=this._lockB=!1,this._elLoopBgCL.remove("gsui-hover"),this._elLoopBrdACL.remove("gsui-hover"),this._elLoopBrdBCL.remove("gsui-hover"),delete gsuiTimeLine._focused,this.onchangeLoop&&(s?(t=this._serialAB(i,o),this._loopWas===this._loop&&this._loopSerial===t||(this._loopSerial=t,this.onchangeLoop(this._loopWas=s,this._loopAWas=i,this._loopBWas=o))):this._loopWas&&this.onchangeLoop(this._loopWas=s,this._loopAWas,this._loopBWas))},_mousedownTime(e){this.currentTime(this.beatRound(this._offset+this._layerX(e)/this._pxPerBeat),!0)},_mousemoveTime(e){var t=this._layerX(e)/this.width*100;this._elTimeLine.style.backgroundImage="linear-gradient(90deg,transparent "+(t-15)+"%,currentColor "+t+"%,transparent "+(t+15)+"%)"},_mousedownLoop(e){this._lock=!0,this._lockA="a"===e,this._lockB="b"===e,this._elLoopBgCL.toggle("gsui-hover","ab"===e),this._elLoopBrdACL.toggle("gsui-hover",this._lockA),this._elLoopBrdBCL.toggle("gsui-hover",this._lockB),gsuiTimeLine._focused=this},_mousedownLoopLine(e){var t=Date.now(),s=this._offset+this._layerX(e)/this._pxPerBeat;!this._loopClick||t-this._loopClick>500?this._loopClick=t:(this.loop(!1,0,!0),this.loop(s,s,!0),this._mousedownLoop("b"))},_updateTime(e){this._elTime.classList.toggle("gsui-trans",!!e),this._elTime.style.left=(this._currentTime-this._offset)*this._pxPerBeat+"px"},_updateLoop(){var e=this._elLoop.style;if(this._loop){var t=this._pxPerBeat,s=this._offset,i=this.beatRound(this._loopA),o=this.beatRound(this._loopB);e.left=(i-s)*t+"px",e.right=this.width-(o-s)*t+"px"}e.display=this._loop?"block":"none"},_render(){var e,t,s=this.rootElement.classList,i=this._steps,o=this._pxPerBeat,n=this._stepsPerBeat,a=n*this._beatsPerMeasure,r=o/n,l=1/n,c=0,u=Math.ceil(this.width/r+2),h=(this.width,~~(this._offset*n)),d=-this._offset%l;for(s.remove("gsui-step","gsui-beat","gsui-measure"),s.add("gsui-"+(o>24?o>72?"step":"beat":"measure"));i.length<u;)t=document.createElement("div"),i.push(t);for(;c<u;++c)e=h%n,(t=i[c]).style.left=d*o+"px",t.className="gsui-"+(h%a?e?"step":"beat":"measure"),t.textContent="gsui-step"!==t.className?~~(1+h/n):".",t.parentNode||this.rootElement.append(t),++h,d+=l;for(;c<i.length&&(t=i[c]).parentNode;++c)t.remove();this._updateTime(),this._updateLoop()}},gsuiToggle.prototype={check(){this._set(!0)},uncheck(){this._set(!1)},toggle(e){this._set(arguments.length?!!e:!this.checked)},_clone(){var e=document.createElement("div");return gsuiToggle.template=gsuiToggle.template||document.getElementById("gsuiToggle"),e.appendChild(document.importNode(gsuiToggle.template.content,!0)),e.removeChild(e.querySelector("*"))},_set(e,t){e!==this.checked&&(this.checked=e,this._circCL.toggle("gsui-on",e),t&&this.onchange&&this.onchange(e))},_mousedown(e){0===e.button?this._set(!this.checked,!0):2===e.button&&this.onmousedownright&&this.onmousedownright()}},gsuiTrack.prototype={remove(){this.rootElement.remove(),this.rowElement.remove()},change(e){"toggle"in e&&this.toggle(e.toggle),"name"in e&&this.name(e.name)},toggle(e){this._evocToggle(e,!1)},name(e){this._evocSpan(e,!1)},setPlaceholder(e){this.uiSpan.setPlaceholder(e)},_clone(){var e=document.createElement("div");return gsuiTrack.template=gsuiTrack.template||document.getElementById("gsuiTrack"),e.appendChild(document.importNode(gsuiTrack.template.content,!0)),e.removeChild(e.querySelector("*"))},_evocToggle(e,t){this.rootElement.classList.toggle("gsui-mute",!e),this.rowElement.classList.toggle("gsui-mute",!e),!1===t?this.uiToggle.toggle(e):this.onchange({toggle:e}),this.data.toggle=e},_evocSpan(e,t){!1===t?this.uiSpan.setValue(e):this.onchange({name:e}),this.data.name=e}},gsuiTrackList.prototype={remove(){this.empty(),this.rootElement.remove()},empty(){for(var e in this._uiTracks)this._delTrack(e)},change(e){var t,s=[];this.newRowElements=[];for(t in e)s.push({id:t,obj:e[t]});s.sort(function(e,t){return e.obj.order>t.obj.order}),s.forEach(function({id:e,obj:t}){t?(this.data[e]||this._newTrack(e),this._uiTracks[e].change(t)):this._delTrack(e)},this)},_clone(){var e=document.createElement("div");return gsuiTrackList.template||this._init(),e.appendChild(document.importNode(gsuiTrackList.template.content,!0)),e.removeChild(e.querySelector("*"))},_init(){gsuiTrackList.template=document.getElementById("gsuiTrackList")},_newTrack(e){var t=new gsuiTrack;t.uiToggle.onmousedownright=this._muteAll.bind(this,e),t.onchange=this._evocTrack.bind(this,e),t.setPlaceholder("Track "+(this.rootElement.childNodes.length+1)),t.rootElement.dataset.track=t.rowElement.dataset.track=e,this.data[e]=t.data,this._uiTracks[e]=t,this.rootElement.append(t.rootElement),this.newRowElements.push(t.rowElement)},_delTrack(e){this._uiTracks[e].remove(),delete this._uiTracks[e],delete this.data[e]},_evocTrack(e,t){this.onchange({[e]:t})},_muteAll(e){var t,s,i={},o=this._uiTracks,n=o[e],a=!0;for(e in o)if((t=o[e]).data.toggle&&t!==n){a=!1;break}for(e in o)t=o[e],(s=a||t===n)!==t.data.toggle&&(t.toggle(s),i[e]={toggle:s});this.onchange(i)}},window.SVGURL="http://www.w3.org/2000/svg",gsuiWave.sine=function(e){return Math.sin(e)},gsuiWave.square=function(e){return Math.sin(e)>0?1:-1},gsuiWave.sawtooth=function(e){return 2*((e/=2*Math.PI)-Math.floor(e+.5))},gsuiWave.triangle=function(e){return 2*Math.abs(gsuiWave.sawtooth(e+Math.PI/2))-1},gsuiWave.prototype={setResolution(e,t){this.width=e,this.height=t,this.rootElement.setAttribute("viewBox","0 0 "+e+" "+t)},draw(){for(var e=0,t=this.width,s=this.height/2,i=-this.amplitude*s,o=t*this.attack,n=2*Math.PI/t*this.frequency,a=gsuiWave[this.type],r=new Float32Array(2*t);e<t;++e)r[2*e]=e,r[2*e+1]=s+a(e*n)*i*(e<o?e/o:1);this.polyline.setAttribute("points",r.join(" "))}},function(){function e(e,t){for(var s=0,i=0,o=e.length+t.length,n=new Float32Array(o);s<o;)n[s++]=e[i],n[s++]=t[i++];return n}function t(e,t,s){for(var i=0;i<s.length;++i)e.setUint8(t+i,s.charCodeAt(i))}function s(e,t,s){for(var i,o=0;o<s.length;++o,t+=2)i=Math.max(-1,Math.min(s[o],1)),e.setInt16(t,i<0?32768*i:32767*i,!0)}function i(e,t,s){for(var i=0;i<s.length;++i,t+=4)e.setFloat32(t,s[i],!0)}window.gswaEncodeWAV=function(o,n){var a=o.numberOfChannels,r=o.sampleRate,l=n&&n.float32?3:1,c=3===l?32:16,u=c/8,h=a*u,d=2===a?e(o.getChannelData(0),o.getChannelData(1)):o.getChannelData(0),p=d.length*u,m=new ArrayBuffer(44+p),g=new DataView(m);return t(g,0,"RIFF"),g.setUint32(4,36+p,!0),t(g,8,"WAVE"),t(g,12,"fmt "),g.setUint32(16,16,!0),g.setUint16(20,l,!0),g.setUint16(22,a,!0),g.setUint32(24,r,!0),g.setUint32(28,r*h,!0),g.setUint16(32,h,!0),g.setUint16(34,c,!0),t(g,36,"data"),g.setUint32(40,p,!0),(1===l?s:i)(g,44,d),m}}(),gswaScheduler.prototype={setContext(e){this.ctx=e},setBPM(e){this.bps=e/60,this._updateDur()},setData(e){this.data=e,this._updateDur()},currentTime(){var e=this._currentTime();return this._loop&&e>this._loopB*this.bps?this._loopA*this.bps+(e-this._loopB*this.bps)%(this._loopDur*this.bps):e},stop(){this.started&&(this._loop?clearInterval(this._timeID):clearTimeout(this._timeID),delete this._loop,this.onstop&&this._smps.forEach(this.onstop),this._onended())},startBeat(e,t,s,i,o){return this.start(this.ctx.currentTime+(null==e?0:e/this.bps),null==t?0:t/this.bps,null==s?null:s/this.bps,null==i?null:i/this.bps,null==o?null:o/this.bps)},start(e,t,s,i,o){if(e=e||this.ctx.currentTime,t=t||0,s=Number.isFinite(s)?s:this.duration-t,this.started=!0,this._startedWhen=e,this._startedOffset=t,this._loop=Number.isFinite(i),this._loop){var n=o-i;this._loopA=i,this._loopDur=n,this._loopB=o,this._whenLoopStop=o-this._startedOffset+this._startedWhen,this._scheduleLoop(i,n),this._timeID=setInterval(this._scheduleLoop.bind(this,i,n),1e3),s=o-t}else this._timeID=setTimeout(this._onended.bind(this),1e3*s);this._start(e,t,s)},_start(e,t,s){this._smps=[],this.data.forEach(i=>{var o=this._sWhn(i)-t,n=this._sOff(i),a=this._sDur(i),r=o+a;o<0&&(n-=o,a+=o,o=0),r>s&&(a-=r-s),a>0&&(this._smps.push(i),this.onstart(i,e+o,n,a))})},_currentTime(){return this.started?(this.ctx.currentTime-this._startedWhen+this._startedOffset)*this.bps:0},_updateDur(){this.duration=this.data.reduce((e,t)=>Math.max(e,this._sWhn(t)+this._sDur(t)),0)},_scheduleLoop(e,t){for(;this._whenLoopStop<this.ctx.currentTime+2;)this._start(this._whenLoopStop,e,t),this._whenLoopStop+=t},_sWhn(e){return"whenBeat"in e?e.whenBeat/this.bps:e.when},_sOff(e){return"offsetBeat"in e?e.offsetBeat/this.bps:e.offset||0},_sDur(e){return"durationBeat"in e?e.durationBeat/this.bps:e.duration},_onended(){delete this.started,delete this._smps,this.onended&&this.onended(this.data)}},window.gswaSynth=function(){this._currId=0,this.simplePlayStack=[],this.data={oscillators:{}}},gswaSynth.prototype={setContext(e){this.stop(),this.disconnect(),this.ctx=e,Object.values(this.data.oscillators).forEach(e=>{this._oscCreateMainNodes(e,e)})},connect(e){this.connectedTo=e,Object.values(this.data.oscillators).forEach(t=>t._gain.connect(e))},disconnect(){this.connectedTo=null,Object.values(this.data.oscillators).forEach(e=>e._gain.disconnect())},simpleStart(e){var t,s;for(t in this.data.oscillators)(s=this._oscCreateNode(this.data.oscillators[t],e))&&(this.simplePlayStack.push(s),s.start(0))},start(e,t,s,i){var o,n,a;for(n in this.data.oscillators)o=this.data.oscillators[n],(a=this._oscCreateNode(o,e))&&(a._when=t,a._duration=i,a._key=e,o._nodeStack[this._currId]=a,a.onended=this._oscDeleteNode.bind(this,o,this._currId),++this._currId,++o._nodeStackLength,a.start(t||0),arguments.length>3&&a.stop(t+i))},stop(){this._forEachNode(e=>e.stop()),this.simplePlayStack.length=0},change(e){var t=this.data.oscillators;e.oscillators&&Object.entries(e.oscillators).forEach(([e,s])=>{s?t[e]?this._oscUpdate(e,s):this._oscCreate(e,s):this._oscDelete(e)})},_forEachNode(e){this.simplePlayStack.forEach(e),Object.values(this.data.oscillators).forEach(t=>{Object.values(t._nodeStack).forEach(e)})},_oscCreateNode(e,t){var s=this.ctx.createOscillator();return s.type=e.type,s.detune.value=e.detune,s.frequency.value=gswaSynth.keyToHz[t],s.connect(e._pan),s},_oscDeleteNode(e,t){delete e._nodeStack[t],--e._nodeStackLength},_oscCreate(e,t){var s,i=this.data.oscillators,o=Object.values(i)[0],n=Object.assign({_nodeStack:{},_nodeStackLength:0},t);this._oscCreateMainNodes(n,t),n._gain.connect(this.connectedTo),i[e]=n,o&&o._nodeStackLength>0&&Object.values(o._nodeStack).forEach(t=>{s=this._oscCreateNode(n,t._key),e=n._nodeStackLength++,n._nodeStack[e]=s,s._when=t._when,s._duration=t._duration,s.onended=this._oscDeleteNode.bind(this,n,e),s.start(t._when),s.stop(t._when+t._duration)})},_oscUpdate(e,t){var s=this.data.oscillators[e];Object.assign(s,t),"gain"in t&&(s._gain.gain.value=t.gain),"pan"in t&&(s._pan.pan.value=t.pan),Object.values(s._nodeStack).forEach(e=>{"type"in t&&(e.type=t.type),"detune"in t&&(e.detune.value=t.detune)})},_oscDelete(e){var t=this.data.oscillators;Object.values(t[e]._nodeStack).forEach(e=>{e.stop()}),delete t[e]},_oscCreateMainNodes(e,t){e._gain=this.ctx.createGain(),e._pan=this.ctx.createStereoPanner(),e._pan.pan.value=t.pan,e._gain.gain.value=t.gain,e._pan.connect(e._gain)}},gswaSynth.keyToHz={A0:27.5,"A#0":29.1353,B0:30.8677,C1:32.7032,"C#1":34.6479,D1:36.7081,"D#1":38.8909,E1:41.2035,F1:43.6536,"F#1":46.2493,G1:48.9995,"G#1":51.913,A1:55,"A#1":58.2705,B1:61.7354,C2:65.4064,"C#2":69.2957,D2:73.4162,"D#2":77.7817,E2:82.4069,F2:87.3071,"F#2":92.4986,G2:97.9989,"G#2":103.826,A2:110,"A#2":116.541,B2:123.471,C3:130.813,"C#3":138.591,D3:146.832,"D#3":155.563,E3:164.814,F3:174.614,"F#3":184.997,G3:195.998,"G#3":207.652,A3:220,"A#3":233.082,B3:246.942,C4:261.626,"C#4":277.183,D4:293.665,"D#4":311.127,E4:329.628,F4:349.228,"F#4":369.994,G4:391.995,"G#4":415.305,A4:440,"A#4":466.164,B4:493.883,C5:523.251,"C#5":554.365,D5:587.33,"D#5":622.254,"F#5":739.989,E5:659.255,F5:698.456,G5:783.991,"G#5":830.609,A5:880,"A#5":932.328,B5:987.767,C6:1046.5,"C#6":1108.73,D6:1174.66,"D#6":1244.51,E6:1318.51,F6:1396.91,"F#6":1479.98,G6:1567.98,"G#6":1661.22,A6:1760,"A#6":1864.66,B6:1975.53,C7:2093,"C#7":2217.46,D7:2349.32,"D#7":2489.02,E7:2637.02,F7:2793.83,"F#7":2959.96,G7:3135.96,"G#7":3322.44,A7:3520,"A#7":3729.31,B7:3951.07,C8:4186.01},window.jsonActions={},window.common={},window.gs={},window.wa={},window.ui={},window.dom={},window.env={version:"0.13.0",def_appGain:1,def_bpm:120,def_beatsPerMeasure:4,def_stepsPerBeat:4,def_nbTracks:21,sampleRate:44100,clockSteps:!1,audioFileExt:["mp3","wav","ogg"]},jsonActions.newSynth=function(){return{synths:{[common.smallId()]:{name:gs.nameUniqueFrom("synth","synths"),oscillators:{[common.smallId()]:{order:0,type:"sine",detune:0,pan:0,gain:1}}}}}},jsonActions.removeSynth=function(e){var t=0,s=0,i={},o={},n={},a=gs.currCmp,r=Object.entries(a.blocks),l={synths:{[e]:null}};return Object.entries(a.patterns).forEach(([a,l])=>{l.synth===e&&(i[l.keys]=n[a]=null,++t,r.forEach(([e,t])=>{t.pattern===a&&(o[e]=null,++s)}))}),t&&(l.keys=i,l.patterns=n,s&&(l.blocks=o)),l},jsonActions.newPattern=function(e){var t=common.smallId();return{keys:{[t]:{}},patterns:{[common.smallId()]:{name:gs.nameUniqueFrom("pat","patterns"),type:"keys",keys:t,synth:e,duration:gs.currCmp.beatsPerMeasure}}}},jsonActions.clonePattern=function(e){var t={},s=common.smallId(),i=gs.currCmp.patterns[e],o=gs.currCmp.keys[i.keys];return Object.keys(o).forEach(function(e){t[common.smallId()]=Object.assign({},o[e])}),{keys:{[s]:t},patterns:{[common.smallId()]:{name:gs.nameUniqueFrom(i.name,"patterns"),type:"keys",keys:s,synth:i.synth,duration:i.duration}}}},jsonActions.removePattern=function(e){var t,s,i={keys:{[gs.currCmp.patterns[e].keys]:null},patterns:{[e]:null}};return s=Object.entries(gs.currCmp.blocks).reduce((s,[i,o])=>(o.pattern===e&&(s[i]=null,t=!0),s),{}),t&&(i.blocks=s),i},jsonActions.patternChangeSynth=function(e,t){return{patterns:{[e]:{synth:t}}}},common.deepKeys=function(e){return Object.keys(common.deepKeys._rec(e,{}))},common.deepKeys._rec=function(e,t){return e&&Object.entries(e).forEach(([e,s])=>{t[e]=!0,"object"==typeof s&&common.deepKeys._rec(s,t)}),t},common.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},common.smallId_i=0,common.smallId=function(){var e="i"+common.smallId_i.toString(16);return++common.smallId_i,e},common.smallIdRegex=/^i[\da-fA-F]+$/,common.smallIdParse=function(e){return common.smallIdRegex.test(e)?parseInt(e.substr(1),16):-1},common.trim2=function(e){return e.trim().replace(/\s+/g," ")},common.nameUnique=function(e,t){var s,i,o;return e=common.trim2(e),t.indexOf(e)>-1?(/\(\d+\)$/.test(e)&&(e=e.substr(0,e.lastIndexOf("(")).trim()),s=new RegExp("^"+e+" \\((\\d+)\\)$"),o=t.reduce(function(e,t){return(i=s.exec(t))?Math.max(e,+i[1]):e},1),`${e} (${o+1})`):e},common.time={beatToMin:(e,t)=>~~(e/t),beatToSec:(e,t)=>common.time._padZero(60*e/t%60),beatToBeat:e=>""+~~(e+1),beatToStep:(e,t)=>common.time._padZero(e%1*t+1),beatToMStep:(e,t)=>common.time._getMil(e%1*t),secToMin:e=>""+~~(e/60),secToSec:e=>common.time._padZero(e%60),secToMs:e=>common.time._getMil(e),_getMil:e=>((e=~~(1e3*e%1e3))<10?"00":e<100?"0":"")+e,_padZero:e=>(e<10?"0":"")+~~e},common.composeUndo=function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){var s,i={};for(s in t)e[s]!==t[s]&&(i[s]=common.composeUndo(e[s],t[s]));return i}return e},common.assignDeep=function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){var s,i;for(s in t)null!=(i=common.assignDeep(e[s],t[s]))?e[s]=i:delete e[s];return e}return t},gs.init=function(){gs.history=[],gs.historyInd=0,gs.currCmp=null,gs.currCmpSaved=!0,gs.controls.init(),gs.localStorage.getAll().forEach(function(e){ui.cmps.push(e.id),ui.cmps.update(e.id,e)})},gs.undo=function(){if(gs.historyInd>0){var e=gs.history[--gs.historyInd],t=gs.history[gs.historyInd-1];gs.currCmpSaved=!!(t?t.saved:!gs.historyActionSaved&&(gs.currCmp.savedAt||localStorage[gs.currCmp.id])),gs.changeComposition(e.undo),ui.history.undo(e),ui.cmps.saved(gs.currCmpSaved)}},gs.redo=function(){if(gs.historyInd<gs.history.length){var e=gs.history[gs.historyInd++];gs.currCmpSaved=!!e.saved,gs.changeComposition(e.redo),ui.history.redo(e),ui.cmps.saved(gs.currCmpSaved)}},gs.localStorage={put(e,t){localStorage[e]=JSON.stringify(t)},delete(e){delete localStorage[e]},get(e){try{var t=JSON.parse(localStorage[e]);return e===t.id&&t.stepsPerBeat?t:null}catch(e){return null}},getAll(){var e,t,s=[];for(e in localStorage)(t=gs.localStorage.get(e))&&s.push(t);return s.sort(function(e,t){return e.savedAt<t.savedAt}),s}},gs.changeSettings=function(e){"clockSteps"in e&&(env.clockSteps=e.clockSteps,ui.controls.switchClock())},gs.loadComposition=function(e){return gs.unloadComposition().then(function(){var t=gs.localStorage.get(e.id);common.smallId_i=gs.getMaxCompositionInnerId(e)+1,gs.handleOldComposition(e),gs.currCmp=e,gs.currCmpSaved=!(!e.savedAt||!t||t.savedAt!==e.savedAt),null!=e.savedAt&&t||(ui.cmps.push(e.id),ui.cmps.update(e.id,e)),Object.entries(e.synths).forEach(([e,t])=>{wa.synths.create(e,t),ui.synths.create(e,t)}),Object.entries(e.patterns).forEach(([e,t])=>{ui.patterns.create(e,t),gs.updatePatternContent(e)}),ui.controls.currentTime("main",0),ui.controls.currentTime("pattern",0),ui.controls.bpm(e.bpm),ui.mainGrid.empty(),ui.mainGridSamples.timeSignature(e.beatsPerMeasure,e.stepsPerBeat),ui.keysGridSamples.timeSignature(e.beatsPerMeasure,e.stepsPerBeat),ui.mainGrid.change(e),ui.cmps.load(e.id),ui.cmps.saved(!gs.isCompositionNeedSave()),e.patternOpened&&gs.openPattern(e.patternOpened),e.synthOpened&&(gs.openSynth(e.synthOpened),ui.synths.show(e.synthOpened,!0))},console.log.bind(console))},gs.handleOldComposition=function(e){if(!e.synths){var t=common.smallId();e.synths={[t]:{name:"synth",oscillators:{[common.smallId()]:{type:"sine",detune:0,pan:0,gain:1}}}},e.synthOpened=t,Object.values(e.patterns).forEach(e=>e.synth=t)}},gs.loadNewComposition=function(){var e,t,s,i=0,o={};for(common.smallId_i=0,e=common.smallId(),t=common.smallId(),s=common.smallId();i<env.def_nbTracks;++i)o[common.smallId()]={order:i,toggle:!0,name:""};return gs.loadComposition({id:common.uuid(),bpm:env.def_bpm,stepsPerBeat:env.def_stepsPerBeat,beatsPerMeasure:env.def_beatsPerMeasure,name:"",duration:0,patterns:{[t]:{name:"pat",type:"keys",keys:s,synth:e,duration:env.def_beatsPerMeasure}},synths:{[e]:{name:"synth",oscillators:{[common.smallId()]:{order:0,type:"sine",detune:0,pan:0,gain:1},[common.smallId()]:{order:1,type:"triangle",detune:-15,pan:-.2,gain:.75},[common.smallId()]:{order:2,type:"square",detune:15,pan:.2,gain:.33}}}},tracks:o,blocks:{},keys:{[s]:{}}}).then(function(){gs.openPattern(t),gs.openSynth(e),ui.synths.show(e,!0)},console.log.bind(console)),!1},gs.loadCompositionById=function(e){var t=gs.localStorage.get(e);return t?gs.loadComposition(t):gs.loadNewComposition(),!1},gs.loadCompositionByBlob=function(e){return new Promise(function(t,s){var i,o=new FileReader;o.onload=function(){try{i=JSON.parse(o.result)}catch(e){return void s()}gs.loadComposition(i).then(t,s)},o.readAsText(e)})},gs.loadCompositionByURL=function(e){return fetch(e).then(e=>e.json()).then(gs.loadComposition,console.log.bind(console))},gs.exportCompositionToJSON=function(e){var t,s,i,o,n={tracks:3,patterns:3,blocks:3,keys:4,synths:5},a=/^\t"(\w*)": {$/,r=JSON.stringify(e,null,"\t").split("\n");return gs._blobDL&&URL.revokeObjectURL(gs._blobDL),r.forEach((e,l)=>{(t=a.exec(e))&&(o=n[t[1]])&&(s=new RegExp(`^\\t{${o}}`),i=new RegExp(`^\\t{${o-1}}\\}`)),o&&(r[l]=r[l].replace(s,"~").replace(i,"~}"))}),gs._blobDL=URL.createObjectURL(new Blob([r.join("\n").replace(/\n~/g," ")]))},gs.exportCurrentCompositionToWAV=function(){gs.currCmp;return gs.controls.stop(),gs._blobDL&&URL.revokeObjectURL(gs._blobDL),wa.render.on(),wa.grids.play("main",0),wa.ctx.startRendering().then(function(e){return wa.render.off(),gs._blobDL=URL.createObjectURL(new Blob([gswaEncodeWAV(e,{float32:!0})]))}).catch(console.error.bind(console))},gs.getMaxCompositionInnerId=function(e){return common.deepKeys(e).reduce((e,t)=>{var s=common.smallIdParse(t);return s<0?e:Math.max(e,s)},0)},gs.pushCompositionChange=function(e){var t={redo:e,undo:common.composeUndo(gs.currCmp,e)};gs.historyInd<gs.history.length&&(gs.history.length=gs.historyInd,ui.history.cut(gs.historyInd)),gs.historyInd=gs.history.push(t),gs.currCmpSaved=!1,gs.changeComposition(e),ui.history.push(t),ui.cmps.saved(!1)},gs.changeComposition=function(e){var t,s,i=gs.currCmp,o=i.duration,n=!1;common.assignDeep(i,e),(e.tracks||e.blocks)&&(ui.mainGrid.change(e),n=!0),e.synths&&(Object.entries(e.synths).forEach(([e,s])=>{t=s?wa.synths._synths[e]?"update":"create":"delete",wa.synths[t](e,s),ui.synths[t](e,s)}),(s=e.synths[i.synthOpened])&&ui.synth.change(s)),e.patterns&&(Object.entries(e.patterns).forEach(function([e,s]){t=s?ui.patterns.audioBlocks[e]?"update":"create":"delete",ui.patterns[t](e,s)}),n=!0),e.keys&&(Object.entries(e.keys).forEach(function([e,t]){Object.entries(i.patterns).some(function([s,o]){if(o.keys===e)return gs.updatePatternContent(s),s===i.patternOpened&&ui.keysGridSamples.change(t),!0})}),n=!0),e.bpm&&(ui.controls.bpm(e.bpm),n=!0),(e.beatsPerMeasure||e.stepsPerBeat)&&(ui.mainGridSamples.timeSignature(i.beatsPerMeasure,i.stepsPerBeat),ui.keysGridSamples.timeSignature(i.beatsPerMeasure,i.stepsPerBeat),Object.keys(i.patterns).forEach(gs.updatePatternContent)),i.duration=Object.values(i.blocks).reduce(function(e,t){return Math.max(e,t.when+t.duration)},0),(null!=e.name||e.bpm||Math.ceil(i.duration)!==Math.ceil(o))&&ui.cmps.update(i.id,i),n&&wa.grids.replay()},gs.unloadComposition=function(){return new Promise(function(e,t){gs.currCmp?gs.currCmpSaved||!gs.history.length?gs._unloadCmp(!0,e,t):gsuiPopup.confirm("Warning","Are you sure you want to discard the unsaved change ?").then(function(s){gs._unloadCmp(s,e,t)}):e()})},gs._unloadCmp=function(e,t,s){var i,o=gs.currCmp;e&&(gs.currCmpSaved=!0,(i=gs.localStorage.get(o.id))?(ui.cmps.saved(!0),ui.cmps.update(o.id,i)):ui.cmps.remove(o.id)),gs.currCmpSaved?(gs.historyInd=0,gs.history.length=0,wa.synths.empty(),ui.synths.empty(),ui.history.cut(0),ui.controls.currentTime("main",0),ui.controls.currentTime("pattern",0),ui.cmps.unload(),ui.mainGrid.empty(),ui.patterns.empty(),ui.pattern.open(null),ui.synth.empty(),gs.currCmp=null,t()):s()},gs.deleteComposition=function(e){var t,s=e===gs.currCmp.id;gs.localStorage.delete(e),ui.cmps.remove(e),s&&(gs.currCmpSaved=!0,(t=gs.localStorage.getAll()[0])?gs.loadCompositionById(t.id):gs.loadNewComposition())},gs.isCompositionNeedSave=function(){return!gs.currCmpSaved&&(gs.currCmp.savedAt||gs.history.length)},gs.saveCurrentComposition=function(){return gs.currCmpSaved?Promise.resolve():new Promise(function(e,t){var s=gs.currCmp;s.savedAt=~~(Date.now()/1e3),gs.localStorage.put(s.id,s),gs.historyActionSaved&&delete gs.historyActionSaved.saved,(gs.historyActionSaved=gs.history[gs.historyInd-1])&&(gs.historyActionSaved.saved=!0),gs.currCmpSaved=!0,ui.cmps.saved(!0),e()})},gs.controls={init(){gs.controls.status="stopped",gs.controls.times={main:0,pattern:0},gs.controls.loopA={},gs.controls.loopB={},gs.controls._grid="main"},currentTime(e,t){if(null==t)return gs.controls.times[e];gs.controls.times[e]=t,ui.controls.currentTime(e,t),wa.grids.replay(t)},loop(e,t,s,i){gs.controls.loopA[e]=t?s:null,gs.controls.loopB[e]=t?i:null,ui.controls.loop(e,t,s,i),wa.grids.replay()},play(){"playing"!==gs.controls.status&&(gs.controls.status="playing",wa.grids.play(gs.controls._grid,gs.controls.times[gs.controls._grid]),ui.controls.play(),gs.controls._loopOn())},pause(){"playing"===gs.controls.status&&(gs.controls.status="paused",gs.controls.times[gs.controls._grid]=wa.grids.currentTime(),wa.grids.stop(),ui.controls.pause(),gs.controls._loopOff())},stop(){if("stopped"===gs.controls.status)gs.controls.currentTime(gs.controls._grid,0);else switch(gs.controls.status="stopped",wa.grids.stop(),ui.controls.stop(),gs.controls._loopOff(),gs.controls.currentTime(gs.controls._grid,gs.controls.loopA[gs.controls._grid]||0),document.activeElement){case ui.mainGridSamples.rootElement:gs.controls.focusOn("main");break;case ui.keysGridSamples.rootElement:gs.controls.focusOn("pattern")}},focusOn(e){e===gs.controls._grid||"main"!==e&&!gs.currCmp.patternOpened||("playing"===gs.controls.status&&(gs.controls.times[gs.controls._grid]=wa.grids.currentTime()),gs.controls._grid=e,ui.controls.focusOn(e),ui.controls.clock(gs.controls.currentTime(e)),wa.grids.replay(gs.controls.times[e]))},askFocusOn(e){"playing"!==gs.controls.status&&gs.controls._grid!==e&&gs.controls.focusOn(e)},_loopOn(){gs.controls._loop()},_loopOff(){cancelAnimationFrame(gs.controls._frameId)},_loop(){ui.controls.currentTime(gs.controls._grid,wa.grids.currentTime()),gs.controls._frameId=requestAnimationFrame(gs.controls._loop)}},gs.openPattern=function(e){var t=gs.currCmp,s=t.patterns[e];t.patternOpened=e=s?e:null,gs.controls.focusOn(s?"pattern":"main"),s&&(wa.grids.replay(),wa.synths.select(s.synth),s.synth!==t.synthOpened&&gs.openSynth(s.synth)),ui.patterns.select(e),ui.pattern.open(e)},gs.openSynth=function(e){var t=gs.currCmp,s=t.synths[e];t.synthOpened=e,ui.synths.select(e),ui.synth.open(s),gs.openPattern(ui.synths.getFirstPattern(e))},gs.nameUniqueFrom=function(e,t){return common.nameUnique(e,Object.values(gs.currCmp[t]).map(e=>e.name))},gs.dropPattern=function(e,t,s){var i=gs.currCmp;gs.pushCompositionChange({blocks:{[common.smallId()]:{pattern:e,track:t,when:s,offset:0,duration:i.patterns[e].duration}}})},gs.updatePatternContent=function(e){var t,s,i,o=gs.currCmp.patterns[e],n=ui.keysToRects(gs.currCmp.keys[o.keys]),a=n.duration;if(o.duration!==a){o.duration=a,t=gs.currCmp.blocks;for(i in t)(s=t[i]).pattern!==e||s.durationEdited||(s.duration=a)}ui.patterns.updateContent(e,n)},gs.addAudioFiles=function(e){console.log("addAudioFiles(), files: ",e),e.forEach(function(e){})},wa.init=function(){gswaSynth.assignDeep=common.assignDeep,wa.ctx=new AudioContext,wa.destination.init(wa.ctx),wa.synths.init()},wa.render={on(){var e=gs.currCmp;wa.render.isOn=!0,wa.render._ctx=wa.ctx,wa.ctx=new OfflineAudioContext(2,~~Math.max(e.duration/(e.bpm/60)*env.sampleRate,100),env.sampleRate),wa.synths.setContext(wa.ctx)},off(){wa.ctx=wa.render._ctx,wa.synths.setContext(wa.ctx),delete wa.render._ctx,delete wa.render.isOn}},wa.blocksToScheduleData=function(e){var t=gs.currCmp,s=t.tracks;return Object.keys(e).reduce(function(i,o){return(o=e[o]).track&&!s[o.track].toggle||i.push({pattern:t.patterns[o.pattern],whenBeat:o.when,offsetBeat:o.offset,durationBeat:o.duration}),i},[])},wa.destination={init(e){this._ctx=e,this._appGain=e.createGain(),this._appGain.gain.value=env.def_appGain,this._appGain.connect(e.destination)},get(){return wa.ctx===this._ctx?this._appGain:wa.ctx.destination},gain(e){this._appGain.gain.value=e}},wa.synths={init(){wa.synths._synths={}},empty(){Object.keys(wa.synths._synths).forEach(wa.synths.delete),delete wa.synths.current},create(e,t){var s=new gswaSynth;s.setContext(wa.ctx),s.connect(wa.destination.get()),s.change(t),wa.synths._synths[e]=s},update(e,t){wa.synths._synths[e].change(t)},delete(e){wa.synths._synths[e].stop(),delete wa.synths._synths[e]},setContext(e){Object.values(wa.synths._synths).forEach(t=>{t.setContext(e),t.connect(wa.destination.get())})},select(e){wa.synths.current=wa.synths._synths[e]},start(e,t,s,i){wa.synths._synths[e.synthId].start(e.key,t,s,i)},stop(){Object.values(wa.synths._synths).forEach(e=>e.stop())}},wa.grids={currentTime(){if(wa._scheduler)return wa._scheduler.currentTime()},stop(){wa._scheduler&&(delete wa._scheduler.onended,wa._scheduler.stop(),wa.synths.stop(),delete wa._scheduler)},replay(e){"playing"===gs.controls.status&&(e=null!=e?e:wa.grids.currentTime(),wa.grids.stop(),wa.grids.play(gs.controls._grid,e))},play(e,t){var s=gs.currCmp,i=new gswaScheduler;wa._scheduler=i,i.onstart=wa.grids._onstartBlock,i.onstop=wa.grids._onstopBlock,i.onended=wa.grids._onendedBlocks,i.setContext(wa.ctx),i.setData("main"===e?wa.blocksToScheduleData(s.blocks):wa.blocksToScheduleData({_:{pattern:s.patternOpened,when:0,offset:0,duration:s.patterns[s.patternOpened].duration}})),i.setBPM(s.bpm),wa.render.isOn?i.startBeat(0):i.startBeat(0,t,null,gs.controls.loopA[e],gs.controls.loopB[e]),i.setBPM(s.bpm)},_onstartBlock(e,t,s,i){var o=new gswaScheduler;e.scheduler=o,o.onstart=wa.synths.start,o.setContext(wa.ctx),o.setData(wa.keysToScheduleData(e.pattern)),o.setBPM(gs.currCmp.bpm),o.start(t,s,i)},_onstopBlock(e){e.scheduler.stop()},_onendedBlocks(e){gs.controls.stop()}},wa.keysToScheduleData=function(e){return Object.values(gs.currCmp.keys[e.keys]).map(t=>({synthId:e.synth,key:t.key.toUpperCase(),whenBeat:t.when,offsetBeat:t.offset,durationBeat:t.duration}))},wa.patterns={stop(){wa.patterns._synth&&(wa.patterns._synth.stop(),delete wa.patterns._synth)},play(e){var t=gs.currCmp,s=t.bpm/60,i=t.patterns[e],o=t.keys[i.keys],n=t.synths[i.synth],a=new gswaSynth;a.setContext(wa.ctx),a.connect(wa.destination.get()),a.change(n),Object.values(o).forEach(e=>{wa.patterns._synth=a,a.start(e.key.toUpperCase(),wa.ctx.currentTime+e.when/s,0,e.duration/s)})}},wa.patternKeys={start(e,t){wa.synths.current.simpleStart((e+t).toUpperCase())},stop(){wa.synths.current.stop()}},ui.init=function(){var e;new gsuiPanels(document.querySelector("#app"));gsuiGridSamples.getNewId=common.smallId,document.querySelectorAll("div[data-panel]").forEach(function(t){(e=document.getElementById(t.dataset.panel))&&e.append.apply(e,t.children)}),document.querySelectorAll("[id]").forEach(function(e){dom[e.id]=e}),dom.version.textContent=env.version,dom["pan-rightside"].onresizing=function(){ui.mainGridSamples.resized(),ui.keysGridSamples.resized()},dom["pan-pianoroll"].onresizing=function(){ui.keysGridSamples.resized()},ui.cmps.init(),ui.history.init(),ui.synths.init(),ui.patterns.init(),ui.controls.init(),ui.mainGrid.init(),ui.synth.init(),ui.pattern.init(),ui.openPopup.init(),ui.settingsPopup.init(),ui.shortcutsPopup.init(),ui.windowEvents(),window.onresize()},ui.keysToRects=function(e){var t,s,i,o,n=1/0,a=-1/0,r=0,l=[],c=gs.currCmp;for(t in e)s=e[t],i=ui.keysGridSamples.uiKeys.keyToIndex(s.key),n=Math.min(n,i),a=Math.max(a,i),r=Math.max(r,s.when+s.duration),l.push({row:i,when:s.when,duration:s.duration});return n-=n%12,a+=11-a%12,o=a-n,l.forEach(function(e){e.row=o-(e.row-n)}),{nbRows:o+1,samples:l,duration:Math.max(1,Math.ceil(r/c.beatsPerMeasure))*c.beatsPerMeasure}},ui.windowEvents=function(){window.onresize=function(){dom["pan-rightside"].onresizing()},window.onbeforeunload=function(){if(gs.isCompositionNeedSave())return"Data unsaved"},window.onkeydown=function(e){var t=!0;if(e.altKey)switch(e.keyCode){case 79:ui.openPopup.show();break;case 83:gs.saveCurrentComposition();break;case 90:e.shiftKey?gs.redo():gs.undo();break;case 78:gs.loadNewComposition();break;default:t=!1}else switch(e.keyCode){case 32:"playing"===gs.controls.status?gs.controls.stop():gs.controls.play();break;default:t=!1}t&&e.preventDefault()},document.body.onclick=function(e){ui.cmps._hideMenu()},document.body.ondrop=function(e){var t,s=Array.from(e.dataTransfer.files).filter(function(e){var s=e.name.substr(e.name.lastIndexOf(".")+1).toLowerCase();return"gs"!==s&&"txt"!==s&&"json"!==s||(t=e),env.audioFileExt.indexOf(s)>-1});return t?gs.loadCompositionByBlob(t).then(gs.addAudioFiles.bind(null,s),function(){}):gs.addAudioFiles(s),!1},document.body.ondragover=function(){return!1}},ui.history={init(){dom.undo.onclick=gs.undo,dom.redo.onclick=gs.redo},undo(e){e._html.classList.add("undone")},redo(e){e._html.classList.remove("undone")},cut(e){for(var t=dom.history.childNodes;e<t.length;)t[t.length-1].remove()},push(e){var t=document.createElement("div"),s=document.createElement("span"),i=document.createElement("span"),o=ui.history._nameAction(e);e._html=t,t.className="action",s.className="actionIcon icon ico-"+o.i,i.className="actionText",i.textContent=o.t,t.append(s,i),t.onclick=ui.history._onclick,dom.history.append(t),dom.history.scrollTop=1e7},_onclick(e){var t=e.target,s=t.classList.contains("action")?t:t.parentNode,i=Array.from(dom.history.childNodes).lastIndexOf(s)-gs.historyInd+1;if(i<0)for(;i++<0;)gs.undo();else if(i>0)for(;i-- >0;)gs.redo()},_nameAction(e){var t=gs.currCmp,s=e.redo,i=e.undo;return ui.history.__synth(t,s,i)||ui.history.__pattern(t,s,i)||ui.history.__tracks(t,s,i)||ui.history.__blocks(t,s,i)||ui.history.__keys(t,s,i)||(null!=s.name?{i:"name",t:`Name: "${s.name}"`}:s.bpm?{i:"clock",t:`BPM: ${s.bpm}`}:s.beatsPerMeasure||s.stepsPerBeat?{i:"clock",t:`Time signature: ${t.beatsPerMeasure}/${t.stepsPerBeat}`}:{i:"",t:""})},__synth(e,t,s){if(t.synths){var i=Object.keys(t.synths)[0],o=t.synths[i],n=s.synths[i];if(!o||!n)return o?{i:"add",t:`New synthesizer "${o.name}"`}:{i:"remove",t:`Remove synthesizer "${n.name}"`};if("name"in o)return{i:"name",t:`${n.name}: rename to "${o.name}"`};if(o.oscillators){var a,r=Object.keys(o.oscillators)[0],l=o.oscillators[r],c=n.oscillators[r],u=e.synths[i].name+": ";return l&&c?(a=Object.entries(l)[0],{i:"param",t:u+`set ${a[0]} to "${a[1]}"`}):l?{i:"add",t:u+"New oscillator"}:{i:"remove",t:u+"Remove oscillator"}}}},__blocks(e,t,s){var i,o,n,a=t.blocks;for(i in a){if(n=Object.keys(a),o=" "+n.length+" block"+(n.length>1?"s":""),!(a=a[i]))return{i:"erase",t:"Remove"+o};if(!s.blocks[i])return{i:"paint",t:"Add"+o};if("duration"in a)return{i:"crop",t:"Crop"+o};if("when"in a||"track"in a)return{i:"move",t:"Move"+o};if("selected"in a)return a.selected?{i:"selection ico--plus",t:"Select"+o}:{i:"selection ico--minus",t:"Unselect"+o}}},__tracks(e,t,s){var i,o=0,n=t.tracks;if(n){for(i in n){if(n[i].name)return{i:"name",t:`Name track: "${s.tracks[i].name}" -> "${n[i].name}"`};if(o++)break}return o>1?{i:"unmute",t:`Un/mute several tracks`}:{i:n[i].toggle?"unmute":"mute",t:(n[i].toggle?"Unmute":"Mute")+` "${e.tracks[i].name}" track`}}},__pattern(e,t,s){var i,o,n,a;for(i in t.patterns){if(o=e.patterns[i],n=t.patterns[i],a=s.patterns[i],!n||!a)return n?{i:"add",t:`New pattern "${n.name}"`}:{i:"remove",t:`Remove pattern "${a.name}"`};if(n.synth)return{i:"param",t:`${o.name}: change its synthesizer`};if("name"in n)return{i:"name",t:`${a.name}: rename to "${n.name}"`}}},__keys(e,t,s){var i,o,n,a,r,l;for(o in t.keys){i=t.keys[o];for(n in i)return a=Object.keys(i),l=e.patterns[e.patternOpened].name+": ",r=" "+a.length+" key"+(a.length>1?"s":""),!(i=i[n])&&{i:"erase",t:l+"remove"+r}||!s.keys[o][n]&&{i:"paint",t:l+"add"+r}||"duration"in i&&{i:"crop",t:l+"crop"+r}||("when"in i||"key"in i)&&{i:"move",t:l+"move"+r}||"selected"in i&&(i.selected?{i:"selection ico--plus",t:l+"select"+r}:{i:"selection ico--minus",t:l+"unselect"+r})}}},ui.controls={init(){var e=new gsuiSlider;dom.togglePlay.onclick=ui.controls._onclickTogglePlay,dom.play.onclick=ui.controls._onclickPlay,dom.stop.onclick=ui.controls._onclickStop,e.oninput=(e=>wa.destination.gain(e*e)),e.options({type:"linear-y",min:0,max:1.5,step:.01,scrollStep:.1,value:1,startFrom:0}),dom.appGainWrap.append(e.rootElement),e.resized()},focusOn(e){var t="main"===e;dom.togglePlay.classList.toggle("after",!t),dom.mainGridWrap.classList.toggle("focus",t),dom.keysGridWrap.classList.toggle("focus",!t),(t?ui.mainGridSamples:ui.keysGridSamples).rootElement.focus()},play(){dom.play.classList.add("ico-pause")},pause(){dom.play.classList.remove("ico-pause")},stop(){ui.controls.pause()},bpm(e){dom.bpmNumber.textContent=e},currentTime(e,t){gs.controls._grid===e&&ui.controls.clock(t),"main"===e?ui.mainGridSamples.currentTime(t):ui.keysGridSamples.currentTime(t)},loop(e,t,s,i){"main"===e?ui.mainGridSamples.loop(t&&s,i):ui.keysGridSamples.loop(t&&s,i)},switchClock(){ui.controls.clock(ui.controls._beat)},clock(e){ui.controls._beat=e,(env.clockSteps?ui.controls._clockBeat:ui.controls._clockSec)(e)},title(e){document.title=(gs.isCompositionNeedSave()?"*":"")+(e||"GridSound")},_clockSec(e){e=60*e/gs.currCmp.bpm,dom.clockMin.textContent=common.time.secToMin(e),dom.clockSec.textContent=common.time.secToSec(e),dom.clockMs.textContent=common.time.secToMs(e)},_clockBeat(e){dom.clockMin.textContent=common.time.beatToBeat(e),dom.clockSec.textContent=common.time.beatToStep(e,gs.currCmp.stepsPerBeat),dom.clockMs.textContent=common.time.beatToMStep(e,gs.currCmp.stepsPerBeat)},_onclickTogglePlay:()=>(gs.controls.focusOn("main"===gs.controls._grid?"pattern":"main"),!1),_onclickPlay:()=>("playing"===gs.controls.status?gs.controls.pause():gs.controls.play(),!1),_onclickStop:()=>(gs.controls.stop(),!1)},ui.mainGrid={init(){var e=new gsuiGridSamples,t=e.rootElement.querySelector(".gsuigs-grid .gsuigs-content");ui.mainGridSamples=e,ui.mainGrid.elGridCnt=t,ui.mainGrid.blocks={},e.loadTrackList(),e.offset(0,40),e.onchange=ui.mainGrid._onchangeGrid,e.onchangeCurrentTime=gs.controls.currentTime.bind(null,"main"),e.onchangeLoop=gs.controls.loop.bind(null,"main"),e.rootElement.onfocus=gs.controls.askFocusOn.bind(null,"main"),e.fnSampleCreate=function(e,t){var s=gs.currCmp,i=s.patterns[t.data.pattern];ui.mainGrid.blocks[e]=t,t.name(i.name),t.updateData(ui.keysToRects(s.keys[i.keys])),t.rootElement.ondblclick=gs.openPattern.bind(null,t.data.pattern)},e.fnSampleUpdate=function(e,t){var s=gs.currCmp,i=s.blocks[e],o=s.keys[s.patterns[i.pattern].keys];t.updateData(ui.keysToRects(o),i.offset,i.duration)},e.fnSampleDelete=function(e,t){delete ui.mainGrid.blocks[e]},dom.mainGridWrap.append(e.rootElement),t.ondrop=ui.mainGrid._ondrop,t.ondragenter=function(e){e.dataTransfer.dropEffect="copy"},e.resized()},empty(){ui.mainGridSamples.empty(),ui.mainGrid.blocks={}},change(e){e.tracks&&ui.mainGridSamples.change(e),e.blocks&&ui.mainGridSamples.change(e.blocks)},getPatternBlocks(e){var t,s=[],i=ui.mainGrid.blocks;for(t in i)i[t].data.pattern===e&&s.push(i[t]);return s},_onchangeGrid(e){e.tracks||(e={blocks:e}),gs.pushCompositionChange(e)},_ondrop(e){var t=e.target,s=ui.mainGridSamples,i=e.dataTransfer.getData("text"),o=s.rootElement.getBoundingClientRect(),n=e.pageX-o.left-s._panelWidth;if(i){for(e.stopPropagation();!t.classList.contains("gsui-row");)t=t.parentNode;return gs.dropPattern(e.dataTransfer.getData("text"),t.dataset.track,s.uiTimeLine.beatFloor(n/s._pxPerBeat+s._timeOffset)),!1}}},ui.cmps={init(){dom.newComposition.onclick=gs.loadNewComposition,dom.openComposition.onclick=ui.openPopup.show,dom.cmpMenu.onclick=ui.cmps._clickMenu,ui.cmps._exportTextWAV=dom.exportCompositionWAV.textContent},push(e){var t=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),n=document.createElement("div"),a=document.createElement("span"),r=document.createElement("span");t.className="cmp",s.className="save",i.className="info",o.className="menu",n.className="name",a.className="bpm",r.className="duration",i.append(n,a,r),t.append(s,i,o),s.onclick=gs.saveCurrentComposition,i.onclick=gs.loadCompositionById.bind(null,e),o.onclick=ui.cmps._showMenu.bind(null,e),ui.cmps._html[e]={root:t,name:n,bpm:a,duration:r},dom.cmps.append(t)},remove(e){var t=ui.cmps._html;t[e]&&(t[e].root.remove(),delete t[e])},update(e,t){var s=ui.cmps._html[e];s.name.textContent=t.name,ui.controls.title(t.name),s.bpm.textContent=t.bpm,s.duration.textContent=common.time.beatToMin(t.duration,t.bpm)+":"+common.time.beatToSec(t.duration,t.bpm)},load(e){var t=ui.cmps._html[e];ui.cmps._loadOne=t,t.root.classList.add("loaded"),ui.controls.title(gs.currCmp.name),dom.cmps.prepend(t.root)},saved(e){ui.controls.title(gs.currCmp.name),ui.cmps._loadOne.root.classList.toggle("notSaved",!e)},unload(){ui.cmps._loadOne.root.classList.remove("loaded"),delete ui.cmps._loadOne},_html:{},_showMenu(e,t){var s=t.target.parentNode.getBoundingClientRect();ui.cmps._cmpId=e,dom.cmpMenu.style.top=s.top+(s.bottom-s.top)/2+"px",dom.cmpMenu.classList.remove("hidden"),t.stopPropagation()},_hideMenu(){ui.cmps._cmpId&&(delete ui.cmps._cmpId,delete ui.cmps._wavReady,dom.exportCompositionWAV.textContent=ui.cmps._exportTextWAV,dom.exportCompositionWAV.download=dom.exportCompositionWAV.href="",dom.cmpMenu.classList.add("hidden"))},_clickMenu(e){var t,s=ui.cmps._cmpId,i=gs.currCmp,o=s===i.id,n=e.target,a=!0;if(e.stopPropagation(),"deleteComposition"===n.id?(i=o?i:gs.localStorage.get(s),gsuiPopup.confirm("Warning",`Are you sure you want to delete "${i.name}" ? (no undo possible)`).then(function(e){e&&gs.deleteComposition(s)})):"exportCompositionJSON"!==n.id&&"exportCompositionWAV"!==n.id||(t=(i=o?i:gs.localStorage.get(s)).name||"untitled","exportCompositionJSON"===n.id?(n.download=t+".gs",n.href=gs.exportCompositionToJSON(i)):o?(a=2===ui.cmps._wavReady,ui.cmps._wavReady||(ui.cmps._wavReady=1,n.download=t+".wav",n.textContent+=" (please wait...)",gs.exportCurrentCompositionToWAV().then(function(e){ui.cmps._wavReady=2,n.href=e,n.textContent=ui.cmps._exportTextWAV+" (re-click to download)"}))):gsuiPopup.alert("Error",`You have to open "${t}" before exporting it in WAV.`)),a&&setTimeout(ui.cmps._hideMenu,200),!n.download||1===ui.cmps._wavReady)return!1}},ui.patterns={init(){ui.patterns.audioBlocks={},dom.patterns.oncontextmenu=ui.patterns._oncontextmenu},empty(){Object.keys(ui.patterns.audioBlocks).forEach(ui.patterns.delete)},create(e,t){var s=new gsuiAudioBlock,i=s.rootElement,o=document.createElement("a"),n=document.createElement("a");s.data=t,s.name(t.name),s.datatype("keys"),i.dataset.id=e,i.setAttribute("draggable","true"),i.onclick=ui.patterns._onclickPattern.bind(null,e),i.ondblclick=ui.patterns._ondblclickPattern.bind(null,e),i.ondragstart=ui.patterns._ondragstartPattern.bind(null,e),o.onclick=ui.patterns._onclickClone.bind(null,e),n.onclick=ui.patterns._onclickRemove.bind(null,e),o.className="icon ico-clone",n.className="icon ico-remove",o.title="Clone this pattern",n.title="Delete this pattern",i.querySelector(".gsuiab-head").append(o,n),ui.patterns.audioBlocks[e]=s,ui.synths.addPattern(t.synth,i),gs.openPattern(e)},update(e,t){var s,i=ui.patterns.audioBlocks[e];t.synth&&ui.synths.addPattern(t.synth,i.rootElement),"name"in t&&(s=t.name,i.name(s),ui.mainGrid.getPatternBlocks(e).forEach(function(e){e.name(s)}),e===gs.currCmp.patternOpened&&ui.pattern.name(s))},delete(e){var t,s=ui.patterns.audioBlocks[e].rootElement;e===gs.currCmp.patternOpened&&(delete gs.currCmp.patternOpened,(t=s.nextSibling||s.previousSibling)&&gs.openPattern(t.dataset.id)),delete ui.patterns.audioBlocks[e],s.remove()},select(e){var t=ui.patterns._selectedPattern,s=ui.patterns.audioBlocks[e];t&&(t.rootElement.classList.remove("selected","gsuiAudioBlock-reversedColors"),delete ui.patterns._selectedPattern),s&&(ui.patterns._selectedPattern=s,s.rootElement.classList.add("selected","gsuiAudioBlock-reversedColors"))},updateContent(e,t){ui.patterns.audioBlocks[e].updateData(t),ui.mainGrid.getPatternBlocks(e).forEach(function(e){var s=gs.currCmp.blocks[e.id];s.durationEdited||(e.duration(s.duration),e.contentWidthFixed()),e.updateData(t,s.offset,s.duration)})},_oncontextmenu:e=>(e&&e.target===dom.patterns||ui.patterns._uiBlockPlaying&&(wa.patterns.stop(),ui.patterns._uiBlockPlaying.stop(),delete ui.patterns._uiBlockPlaying),!1),_onclickClone:(e,t)=>(t.stopPropagation(),gs.pushCompositionChange(jsonActions.clonePattern(e)),!1),_onclickRemove(e,t){var s=ui.patterns.audioBlocks[e].rootElement;return t.stopPropagation(),s.nextSibling||s.previousSibling?gs.pushCompositionChange(jsonActions.removePattern(e)):gsuiPopup.alert("Error","You can not delete the last pattern"),!1},_onclickPattern(e,t){var s=ui.patterns.audioBlocks[e];ui.patterns._oncontextmenu(),ui.patterns._uiBlockPlaying=s,s.start(gs.currCmp.bpm),wa.patterns.play(e)},_ondblclickPattern(e){e!==gs.currCmp.patternOpened&&(ui.patterns._oncontextmenu(),gs.openPattern(e))},_ondragstartPattern(e,t){t.dataTransfer.setData("text",e)}},ui.pattern={init(){var e=new gsuiGridSamples;ui.keysGridSamples=e,e.loadKeys(1,7),e.offset(0,120),e.setFontSize(20),dom.keysGridWrap.append(e.rootElement),e.contentY(24),dom.pianorollName.onclick=ui.pattern._onclickName,e.onchange=ui.pattern._onchangeGrid,e.onchangeCurrentTime=gs.controls.currentTime.bind(null,"pattern"),e.onchangeLoop=gs.controls.loop.bind(null,"pattern"),e.rootElement.onfocus=gs.controls.askFocusOn.bind(null,"pattern"),e.uiKeys.onkeydown=wa.patternKeys.start,e.uiKeys.onkeyup=wa.patternKeys.stop,e.resized()},name(e){dom.pianorollName.textContent=e},open(e){if(e){var t=gs.currCmp.patterns[e];ui.pattern.name(t.name),ui.pattern._load(gs.currCmp.keys[t.keys])}else ui.pattern.name(""),ui.keysGridSamples.empty();dom.pianorollBlock.classList.toggle("show",!e)},_load(e){ui.keysGridSamples.empty(),ui.keysGridSamples.change(e),ui.keysGridSamples.scrollToSamples()},_onchangeGrid(e){gs.pushCompositionChange({keys:{[gs.currCmp.patterns[gs.currCmp.patternOpened].keys]:e}})},_onclickName(){var e=gs.currCmp.patternOpened,t=gs.currCmp.patterns[e],s=prompt("Name pattern :",t.name);null!=s&&(s=s.trim())!==t.name&&gs.pushCompositionChange({patterns:{[e]:{name:s}}})}},ui.synth={init(){dom.synthOsc.remove(),dom.synthName.onclick=ui.synth._onclickName,dom.synthOscAdd.onclick=ui.synth._onclickAddOsc,ui.synth._oscHTML={}},empty(){Object.keys(ui.synth._oscHTML).forEach(this._deleteOsc)},open(e){ui.synth.empty(),ui.synth.name(e.name),ui.synth.change(e)},name(e){dom.synthName.textContent=e},change(e){"name"in e&&ui.synth.name(e.name),"oscillators"in e&&Object.entries(e.oscillators).forEach(function([e,t]){t?this._oscHTML[e]?this._updateOsc(e,t):this._createOsc(e,t):this._deleteOsc(e)},ui.synth)},_createOsc(e,t){var s=dom.synthOsc.cloneNode(!0),i=ui.synth._sliderInit.bind(null,e,t,s),o=new gsuiWave,n=s.querySelector(".synthOsc-curveSelect");s.removeAttribute("id"),s.dataset.order=t.order||0,s.querySelector(".synthOsc-curve").prepend(o.rootElement),n.onchange=ui.synth._onchangeCurve.bind(null,e),s.querySelector(".synthOsc-remove").onclick=ui.synth._onclickRemoveOsc.bind(null,e),o.setResolution(150,20),o.amplitude=.5,o.frequency=2,Array.from(dom.synthOscsList.children).some(e=>{if(t.order<=+e.dataset.order)return dom.synthOscsList.insertBefore(s,e),!0})||dom.synthOscsList.append(s),ui.synth._oscHTML[e]={root:s,curveWave:o,curveSelect:n,detune:i({min:-100,max:100,step:5,scrollStep:10},"detune"),gain:i({min:0,max:1,step:.01,scrollStep:.05},"gain"),pan:i({min:-1,max:1,step:.01,scrollStep:.1},"pan")},ui.synth._updateOsc(e,t)},_deleteOsc(e){ui.synth._oscHTML[e].root.remove(),delete ui.synth._oscHTML[e]},_updateOsc(e,t){var s=ui.synth._oscHTML[e];t.type&&(s.curveSelect.value=s.curveWave.type=t.type,s.curveWave.draw()),"detune"in t&&ui.synth._sliderSetValue(e,"detune",t.detune),"gain"in t&&ui.synth._sliderSetValue(e,"gain",t.gain),"pan"in t&&ui.synth._sliderSetValue(e,"pan",t.pan)},_sliderInit(e,t,s,i,o){var n=new gsuiSlider,a=s.querySelector(`.synthOsc-${o}`),r=a.querySelector(".synthOsc-sliderValue");return i.type="circular",i.value=t[o],n.options(i),a.querySelector(".synthOsc-sliderWrap").append(n.rootElement),n.oninput=ui.synth._oninputSlider.bind(null,e,o,n),n.onchange=ui.synth._onchangeSlider.bind(null,e,o),n._valueElement=r,r.textContent=i.value,n.resized(),n},_sliderSetValue(e,t,s){var i=ui.synth._oscHTML[e][t];i.setValue(s),i._valueElement.textContent=s},_onclickName(){var e=gs.currCmp,t=e.synths[e.synthOpened],s=prompt("Name synthesizer :",t.name);null!=s&&(s=s.trim())!==t.name&&gs.pushCompositionChange({synths:{[e.synthOpened]:{name:s}}})},_onchangeCurve(e,t){gs.pushCompositionChange({synths:{[gs.currCmp.synthOpened]:{oscillators:{[e]:{type:t.target.value}}}}})},_oninputSlider(e,t,s,i){wa.synths.update(gs.currCmp.synthOpened,{oscillators:{[e]:{[t]:i}}}),s._valueElement.textContent=i},_onchangeSlider(e,t,s){gs.pushCompositionChange({synths:{[gs.currCmp.synthOpened]:{oscillators:{[e]:{[t]:s}}}}})},_onclickAddOsc:()=>(gs.pushCompositionChange({synths:{[gs.currCmp.synthOpened]:{oscillators:{[common.uuid()]:{type:"sine",detune:0,gain:1,pan:0}}}}}),!1),_onclickRemoveOsc:e=>(gs.pushCompositionChange({synths:{[gs.currCmp.synthOpened]:{oscillators:{[e]:null}}}}),!1)},ui.synths={init(){ui.synths.elements={},dom.synth.remove(),dom.synth.removeAttribute("id"),dom.synthNew.onclick=ui.synths._onclickNew},empty(){Object.keys(ui.synths.elements).forEach(ui.synths.delete)},create(e,t){var s=dom.synth.cloneNode(!0);ui.synths.elements[e]=s,s.dataset.id=e,s.ondrop=ui.synths._ondrop.bind(null,e),s.querySelector(".synth-name").onclick=gs.openSynth.bind(null,e),s.querySelector(".synth-showBtn").onclick=ui.synths.show.bind(null,e,void 0),s.querySelector(".synth-deleteBtn").onclick=ui.synths._onclickDelete.bind(null,e),s.querySelector(".synth-newPatternBtn").onclick=ui.synths._onclickNewPattern.bind(null,e),ui.synths.update(e,t),dom.patterns.prepend(s)},update(e,t){var s=ui.synths.elements[e];"name"in t&&(s.querySelector(".synth-name").textContent=t.name)},delete(e){var t,s=ui.synths.elements[e];e===ui.synths._selected.dataset.id&&(t=s.nextElementSibling||s.previousElementSibling),delete ui.synths.elements[e],s.remove(),t&&gs.openSynth(t.dataset.id)},show:(e,t)=>(ui.synths.elements[e].classList.toggle("synth-show",t),!1),select(e){var t=ui.synths._selected;t&&t.classList.remove("synth-selected"),ui.synths._selected=ui.synths.elements[e],ui.synths._selected.classList.add("synth-selected")},getFirstPattern(e){var t=ui.synths.elements[e].querySelector(".gsuiAudioBlock");return t&&t.dataset.id},addPattern(e,t){ui.synths.elements[e].querySelector(".synth-patterns").prepend(t),ui.synths.show(e,!0),t.dataset.id===gs.currCmp.patternOpened&&gs.openSynth(e)},_ondrop(e,t){var s=t.dataTransfer.getData("text"),i=gs.currCmp.patterns[s];i&&i.synth!==e&&gs.pushCompositionChange(jsonActions.patternChangeSynth(s,e))},_onclickNew(){var e=jsonActions.newSynth();return gs.pushCompositionChange(e),gs.openSynth(Object.keys(e.synths)[0]),!1},_onclickDelete:e=>(Object.keys(gs.currCmp.synths).length>1?gs.pushCompositionChange(jsonActions.removeSynth(e)):gsuiPopup.alert("Error","You can not delete the last synthesizer"),!1),_onclickNewPattern:e=>(gs.pushCompositionChange(jsonActions.newPattern(e)),!1)},ui.openPopup={init(){var e=dom.openPopupContent.querySelectorAll("input");dom.openPopupContent.remove(),ui.openPopup.inputURL=e[0],ui.openPopup.inputFile=e[1]},show:()=>(ui.openPopup.inputFile.value=ui.openPopup.inputURL.value="",gsuiPopup.custom("Open",dom.openPopupContent,ui.openPopup._onsubmit),!1),_onsubmit(){var e=ui.openPopup.inputURL.value,t=ui.openPopup.inputFile.files[0];e?gs.loadCompositionByURL(e):t&&gs.loadCompositionByBlob(t)}},ui.settingsPopup={init(){dom.settingsPopupContent.remove(),dom.settings.onclick=ui.settingsPopup.show,ui.settingsPopup.inputs=dom.settingsPopupContent.querySelectorAll("input")},show(){var e=gs.currCmp,t=ui.settingsPopup.inputs,s=dom.bpmTap;return t[+env.clockSteps].checked=!0,t[2].value=e.name,t[3].value=e.bpm,t[4].value=e.beatsPerMeasure,t[5].value=e.stepsPerBeat,s.timeBefore=0,s.bpmStack=[],s.nbBpmToAverage=10,s.onclick=ui.settingsPopup._bpmTap.bind(null,t[3],s),gsuiPopup.custom("Settings",dom.settingsPopupContent,ui.settingsPopup._onsubmit),!1},_onsubmit(){var e,t={},s={},i=gs.currCmp,o=ui.settingsPopup.inputs;o[+env.clockSteps].checked||(t.clockSteps=!env.clockSteps),(e=o[2].value)!==i.name&&(s.name=e),(e=+o[3].value)!==i.bpm&&(s.bpm=e),(e=+o[4].value)!==i.beatsPerMeasure&&(s.beatsPerMeasure=e),(e=+o[5].value)!==i.stepsPerBeat&&(s.stepsPerBeat=e);for(e in t){gs.changeSettings(t);break}for(e in s){gs.pushCompositionChange(s);break}},_bpmTap(e,t){var s=(new Date).getTime();if(t.timeBefore){var i,o=6e4/(s-t.timeBefore),n=t.bpmStack.length?t.bpmStack[t.bpmStack.length-1]:0;if(n&&(o<n/1.5||o>1.5*n))t.timeBefore=t.bpmStack.length=0,e.value="0";else{for(t.bpmStack.push(o),i=o=0;i<t.bpmStack.length&&i<t.nbBpmToAverage;++i)o+=t.bpmStack[t.bpmStack.length-1-i];e.value=Math.floor(o/i)}}return t.timeBefore=s,!1}},ui.shortcutsPopup={init(){dom.shortcutsPopupContent.remove(),dom.shortcuts.onclick=ui.shortcutsPopup.show},show:()=>(gsuiPopup.custom("Keyboard / mouse shortcuts",dom.shortcutsPopupContent),!1)},ui.init(),wa.init(),gs.init(),gs.loadNewComposition(),navigator.serviceWorker&&navigator.serviceWorker.register("serviceWorker.js",{scope:"/daw/"}).then(function(e){console.log("Service worker "+(e.installing?"installing":e.waiting?"installed":e.active?"active":""))},console.log.bind(console,"Service worker registration failed")),setTimeout(function(){fetch("https://gridsound.github.io/daw/VERSION?"+Math.random()).then(e=>e.text()).then(e=>{dom.version.classList.add(e===env.version?"ok":"ko")})},2e3),function(e,t,s,i,o,n,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,n=t.createElement(s),a=t.getElementsByTagName(s)[0],n.async=1,n.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(n,a)}(window,document,"script",0,"ga"),ga("create","UA-418864-6","auto"),ga("send","pageview");
</script></body></html>
